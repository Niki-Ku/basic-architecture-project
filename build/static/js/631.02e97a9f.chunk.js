/*! For license information please see 631.02e97a9f.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[631],{1752:function(e,t,n){n.d(t,{Z:function(){return i}});var r=n(1120);function i(){return i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=(0,r.Z)(e)););return e}(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},i.apply(null,arguments)}},9631:function(e,t,n){n.r(t),n.d(t,{AbstractUserDataWriter:function(){return Xf},AggregateField:function(){return zh},AggregateQuerySnapshot:function(){return jh},Bytes:function(){return Gh},CACHE_SIZE_UNLIMITED:function(){return Zh},CollectionReference:function(){return mh},DocumentReference:function(){return yh},DocumentSnapshot:function(){return od},FieldPath:function(){return Kh},FieldValue:function(){return Hh},Firestore:function(){return Eh},FirestoreError:function(){return W},GeoPoint:function(){return Wh},LoadBundleTask:function(){return Th},PersistentCacheIndexManager:function(){return tv},Query:function(){return ph},QueryCompositeFilterConstraint:function(){return Rf},QueryConstraint:function(){return Cf},QueryDocumentSnapshot:function(){return sd},QueryEndAtConstraint:function(){return jf},QueryFieldFilterConstraint:function(){return Df},QueryLimitConstraint:function(){return Lf},QueryOrderByConstraint:function(){return Pf},QuerySnapshot:function(){return cd},QueryStartAtConstraint:function(){return Uf},SnapshotMetadata:function(){return ud},Timestamp:function(){return he},Transaction:function(){return jd},VectorValue:function(){return Jh},WriteBatch:function(){return Bd},_AutoId:function(){return oe},_ByteString:function(){return qt},_DatabaseId:function(){return Wt},_DocumentKey:function(){return me},_EmptyAppCheckTokenProvider:function(){return ae},_EmptyAuthCredentialsProvider:function(){return X},_FieldPath:function(){return ye},_TestingHooks:function(){return lv},_cast:function(){return lh},_debugAssert:function(){return K},_internalAggregationQueryToProtoRunAggregationQueryRequest:function(){return cv},_internalQueryToProtoQueryTarget:function(){return sv},_isBase64Available:function(){return Vt},_logWarn:function(){return B},_validateIsNotUsedTogether:function(){return uh},addDoc:function(){return xd},aggregateFieldEqual:function(){return id},aggregateQuerySnapshotEqual:function(){return ad},and:function(){return Of},arrayRemove:function(){return Wd},arrayUnion:function(){return Hd},average:function(){return nd},clearIndexedDbPersistence:function(){return Ph},collection:function(){return gh},collectionGroup:function(){return kh},connectFirestoreEmulator:function(){return vh},count:function(){return rd},deleteAllPersistentCacheIndexes:function(){return av},deleteDoc:function(){return bd},deleteField:function(){return Kd},disableNetwork:function(){return Vh},disablePersistentCacheIndexAutoCreation:function(){return iv},doc:function(){return wh},documentId:function(){return Qh},enableIndexedDbPersistence:function(){return Nh},enableMultiTabIndexedDbPersistence:function(){return Rh},enableNetwork:function(){return Lh},enablePersistentCacheIndexAutoCreation:function(){return rv},endAt:function(){return Kf},endBefore:function(){return Gf},ensureFirestoreConfigured:function(){return Ah},executeWrite:function(){return Td},getAggregateFromServer:function(){return Sd},getCountFromServer:function(){return Ed},getDoc:function(){return fd},getDocFromCache:function(){return vd},getDocFromServer:function(){return pd},getDocs:function(){return yd},getDocsFromCache:function(){return md},getDocsFromServer:function(){return gd},getFirestore:function(){return Ch},getPersistentCacheIndexManager:function(){return nv},increment:function(){return Jd},initializeFirestore:function(){return Sh},limit:function(){return Vf},limitToLast:function(){return qf},loadBundle:function(){return Uh},memoryEagerGarbageCollector:function(){return Rd},memoryLocalCache:function(){return Od},memoryLruGarbageCollector:function(){return Md},namedQuery:function(){return Bh},onSnapshot:function(){return Id},onSnapshotsInSync:function(){return _d},or:function(){return Mf},orderBy:function(){return Ff},persistentLocalCache:function(){return Pd},persistentMultipleTabManager:function(){return qd},persistentSingleTabManager:function(){return Vd},query:function(){return Af},queryEqual:function(){return xh},refEqual:function(){return bh},runTransaction:function(){return Gd},serverTimestamp:function(){return Qd},setDoc:function(){return kd},setIndexConfiguration:function(){return $d},setLogLevel:function(){return V},snapshotEqual:function(){return hd},startAfter:function(){return zf},startAt:function(){return Bf},sum:function(){return td},terminate:function(){return qh},updateDoc:function(){return wd},vector:function(){return Yd},waitForPendingWrites:function(){return Fh},where:function(){return Nf},writeBatch:function(){return Xd}});var r,i,a=n(5647),u=n(1752),o=n(1120),s=n(9439),c=n(8664),l=n(7762),h=n(4165),f=n(5861),d=n(136),v=n(9388),p=n(3433),y=n(5671),m=n(3144),g=n(7825),k=n(3258),w=n(6781),b=n(5854),x="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},I={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"===typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var a=e.g[3],u=t+(a^n&(i^a))+r[0]+3614090360&4294967295;u=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=n+(u<<7&4294967295|u>>>25))+((u=a+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|u>>>20))+((u=i+(n^a&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|u>>>15))+((u=n+(t^i&(a^t))+r[3]+3250441966&4294967295)<<22&4294967295|u>>>10))+((u=t+(a^n&(i^a))+r[4]+4118548399&4294967295)<<7&4294967295|u>>>25))+((u=a+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|u>>>20))+((u=i+(n^a&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|u>>>15))+((u=n+(t^i&(a^t))+r[7]+4249261313&4294967295)<<22&4294967295|u>>>10))+((u=t+(a^n&(i^a))+r[8]+1770035416&4294967295)<<7&4294967295|u>>>25))+((u=a+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|u>>>20))+((u=i+(n^a&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|u>>>15))+((u=n+(t^i&(a^t))+r[11]+2304563134&4294967295)<<22&4294967295|u>>>10))+((u=t+(a^n&(i^a))+r[12]+1804603682&4294967295)<<7&4294967295|u>>>25))+((u=a+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|u>>>20))+((u=i+(n^a&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|u>>>15))+((u=n+(t^i&(a^t))+r[15]+1236535329&4294967295)<<22&4294967295|u>>>10))+((u=t+(i^a&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|u>>>27))+((u=a+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|u>>>23))+((u=i+(t^n&(a^t))+r[11]+643717713&4294967295)<<14&4294967295|u>>>18))+((u=n+(a^t&(i^a))+r[0]+3921069994&4294967295)<<20&4294967295|u>>>12))+((u=t+(i^a&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|u>>>27))+((u=a+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|u>>>23))+((u=i+(t^n&(a^t))+r[15]+3634488961&4294967295)<<14&4294967295|u>>>18))+((u=n+(a^t&(i^a))+r[4]+3889429448&4294967295)<<20&4294967295|u>>>12))+((u=t+(i^a&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|u>>>27))+((u=a+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|u>>>23))+((u=i+(t^n&(a^t))+r[3]+4107603335&4294967295)<<14&4294967295|u>>>18))+((u=n+(a^t&(i^a))+r[8]+1163531501&4294967295)<<20&4294967295|u>>>12))+((u=t+(i^a&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|u>>>27))+((u=a+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|u>>>23))+((u=i+(t^n&(a^t))+r[7]+1735328473&4294967295)<<14&4294967295|u>>>18))+((u=n+(a^t&(i^a))+r[12]+2368359562&4294967295)<<20&4294967295|u>>>12))+((u=t+(n^i^a)+r[5]+4294588738&4294967295)<<4&4294967295|u>>>28))+((u=a+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|u>>>21))+((u=i+(a^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|u>>>16))+((u=n+(i^a^t)+r[14]+4259657740&4294967295)<<23&4294967295|u>>>9))+((u=t+(n^i^a)+r[1]+2763975236&4294967295)<<4&4294967295|u>>>28))+((u=a+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|u>>>21))+((u=i+(a^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|u>>>16))+((u=n+(i^a^t)+r[10]+3200236656&4294967295)<<23&4294967295|u>>>9))+((u=t+(n^i^a)+r[13]+681279174&4294967295)<<4&4294967295|u>>>28))+((u=a+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|u>>>21))+((u=i+(a^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|u>>>16))+((u=n+(i^a^t)+r[6]+76029189&4294967295)<<23&4294967295|u>>>9))+((u=t+(n^i^a)+r[9]+3654602809&4294967295)<<4&4294967295|u>>>28))+((u=a+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|u>>>21))+((u=i+(a^t^n)+r[15]+530742520&4294967295)<<16&4294967295|u>>>16))+((u=n+(i^a^t)+r[2]+3299628645&4294967295)<<23&4294967295|u>>>9))+((u=t+(i^(n|~a))+r[0]+4096336452&4294967295)<<6&4294967295|u>>>26))+((u=a+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|u>>>22))+((u=i+(t^(a|~n))+r[14]+2878612391&4294967295)<<15&4294967295|u>>>17))+((u=n+(a^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|u>>>11))+((u=t+(i^(n|~a))+r[12]+1700485571&4294967295)<<6&4294967295|u>>>26))+((u=a+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|u>>>22))+((u=i+(t^(a|~n))+r[10]+4293915773&4294967295)<<15&4294967295|u>>>17))+((u=n+(a^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|u>>>11))+((u=t+(i^(n|~a))+r[8]+1873313359&4294967295)<<6&4294967295|u>>>26))+((u=a+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|u>>>22))+((u=i+(t^(a|~n))+r[6]+2734768916&4294967295)<<15&4294967295|u>>>17))+((u=n+(a^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|u>>>11))+((a=(t=n+((u=t+(i^(n|~a))+r[4]+4149444226&4294967295)<<6&4294967295|u>>>26))+((u=a+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|u>>>22))^((i=a+((u=i+(t^(a|~n))+r[2]+718787259&4294967295)<<15&4294967295|u>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(u<<21&4294967295|u>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+a&4294967295}function a(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var a=0|e[i];r&&a==t||(n[i]=a,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,a=this.h,u=0;u<t;){if(0==a)for(;u<=r;)n(this,e,u),u+=this.blockSize;if("string"===typeof e){for(;u<t;)if(i[a++]=e.charCodeAt(u++),a==this.blockSize){n(this,i),a=0;break}}else for(;u<t;)if(i[a++]=e[u++],a==this.blockSize){n(this,i),a=0;break}}this.h=a,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var u={};function o(e){return-128<=e&&128>e?function(e,t){var n=u;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(e){return new a([0|e],0>e?-1:0)})):new a([0|e],0>e?-1:0)}function s(e){if(isNaN(e)||!isFinite(e))return c;if(0>e)return v(s(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new a(t,0)}var c=o(0),l=o(1),h=o(16777216);function f(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function d(e){return-1==e.h}function v(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new a(n,~e.h).add(l)}function p(e,t){return e.add(v(t))}function y(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function g(e,t){if(f(t))throw Error("division by zero");if(f(e))return new m(c,c);if(d(e))return t=g(v(e),t),new m(v(t.g),v(t.h));if(d(t))return t=g(e,v(t)),new m(v(t.g),t.h);if(30<e.g.length){if(d(e)||d(t))throw Error("slowDivide_ only works with positive integers.");for(var n=l,r=t;0>=r.l(e);)n=k(n),r=k(r);var i=w(n,1),a=w(r,1);for(r=w(r,2),n=w(n,2);!f(r);){var u=a.add(r);0>=u.l(e)&&(i=i.add(n),a=u),r=w(r,1),n=w(n,1)}return t=p(e,i.j(t)),new m(i,t)}for(i=c;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),u=(a=s(n)).j(t);d(u)||0<u.l(e);)u=(a=s(n-=r)).j(t);f(a)&&(a=l),i=i.add(a),e=p(e,u)}return new m(i,e)}function k(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new a(n,e.h)}function w(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],u=0;u<r;u++)i[u]=0<t?e.i(u+n)>>>t|e.i(u+n+1)<<32-t:e.i(u+n);return new a(i,e.h)}(e=a.prototype).m=function(){if(d(this))return-v(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(f(this))return"0";if(d(this))return"-"+v(this).toString(e);for(var t=s(Math.pow(e,6)),n=this,r="";;){var i=g(n,t).g,a=((0<(n=p(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(f(n=i))return a+r;for(;6>a.length;)a="0"+a;r=a+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return d(e=p(this,e))?-1:f(e)?0:1},e.abs=function(){return d(this)?v(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var u=r+(65535&this.i(i))+(65535&e.i(i)),o=(u>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=o>>>16,u&=65535,o&=65535,n[i]=o<<16|u}return new a(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(f(this)||f(e))return c;if(d(this))return d(e)?v(this).j(v(e)):v(v(this).j(e));if(d(e))return v(this.j(v(e)));if(0>this.l(h)&&0>e.l(h))return s(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var u=this.i(r)>>>16,o=65535&this.i(r),l=e.i(i)>>>16,p=65535&e.i(i);n[2*r+2*i]+=o*p,y(n,2*r+2*i),n[2*r+2*i+1]+=u*p,y(n,2*r+2*i+1),n[2*r+2*i+1]+=o*l,y(n,2*r+2*i+1),n[2*r+2*i+2]+=u*l,y(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new a(n,0)},e.A=function(e){return g(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new a(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new a(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new a(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,i=I.Md5=t,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=s,a.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return v(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=s(Math.pow(n,8)),i=c,a=0;a<t.length;a+=8){var u=Math.min(8,t.length-a),o=parseInt(t.substring(a,a+u),n);8>u?(u=s(Math.pow(n,u)),i=i.j(u).add(s(o))):i=(i=i.j(r)).add(s(o))}return i},r=I.Integer=a}).apply("undefined"!==typeof x?x:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var _,T,Z,E,S,C,A,D,N="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},R={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof N&&N];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var i=n;e=e.split(".");for(var a=0;a<e.length-1;a++){var u=e[a];if(!(u in i))break e;i=i[u]}(r=r(a=i[e=e[e.length-1]]))!=a&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return t}))}}));var r=r||{},i=this||self;function a(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function c(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function h(e,t,n){return e.call.apply(e.bind,arguments)}function f(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function p(e,t,n){return(p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?h:f).apply(null,arguments)}function g(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function k(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}function w(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function b(e,t){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(a(r)){var i=e.length||0,u=r.length||0;e.length=i+u;for(var o=0;o<u;o++)e[i+o]=r[o]}else e.push(r)}}var x=function(){function e(t,n){(0,y.Z)(this,e),this.i=t,this.j=n,this.h=0,this.g=null}return(0,m.Z)(e,[{key:"get",value:function(){var e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}]),e}();function I(e){return/^[\s\xa0]*$/.test(e)}function O(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function P(e){return P[" "](e),e}P[" "]=function(){};var L=-1!=O().indexOf("Gecko")&&!(-1!=O().toLowerCase().indexOf("webkit")&&-1==O().indexOf("Edge"))&&!(-1!=O().indexOf("Trident")||-1!=O().indexOf("MSIE"))&&-1==O().indexOf("Edge");function V(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function q(e){var t={};for(var n in e)t[n]=e[n];return t}var U="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function B(e,t){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])e[n]=r[n];for(var a=0;a<U.length;a++)n=U[a],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function z(e){var t=1;e=e.split(":");for(var n=[];0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function j(e){i.setTimeout((function(){throw e}),0)}function G(){var e=Y,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var K,Q=function(){function e(){(0,y.Z)(this,e),this.h=this.g=null}return(0,m.Z)(e,[{key:"add",value:function(e,t){var n=H.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}]),e}(),H=new x((function(){return new W}),(function(e){return e.reset()})),W=function(){function e(){(0,y.Z)(this,e),this.next=this.g=this.h=null}return(0,m.Z)(e,[{key:"set",value:function(e,t){this.h=e,this.g=t,this.next=null}},{key:"reset",value:function(){this.next=this.g=this.h=null}}]),e}(),J=!1,Y=new Q,X=function(){var e=i.Promise.resolve(void 0);K=function(){e.then($)}},$=function(){for(var e;e=G();){try{e.h.call(e.g)}catch(n){j(n)}var t=H;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}J=!1};function ee(){this.s=this.s,this.C=this.C}function te(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}ee.prototype.s=!1,ee.prototype.ma=function(){this.s||(this.s=!0,this.N())},ee.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},te.prototype.h=function(){this.defaultPrevented=!0};var ne=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{var n=function(){};i.addEventListener("test",n,t),i.removeEventListener("test",n,t)}catch(n){}return e}();function re(e,t){if(te.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(L){e:{try{P(t.nodeName);var i=!0;break e}catch(a){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:ie[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&re.aa.h.call(this)}}k(re,te);var ie={2:"touch",3:"pen",4:"mouse"};re.prototype.h=function(){re.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var ae="closure_listenable_"+(1e6*Math.random()|0),ue=0;function oe(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++ue,this.da=this.fa=!1}function se(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function ce(e){this.src=e,this.g={},this.h=0}function le(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],a=Array.prototype.indexOf.call(i,t,void 0);(r=0<=a)&&Array.prototype.splice.call(i,a,1),r&&(se(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function he(e,t,n,r){for(var i=0;i<e.length;++i){var a=e[i];if(!a.da&&a.listener==t&&a.capture==!!n&&a.ha==r)return i}return-1}ce.prototype.add=function(e,t,n,r,i){var a=e.toString();(e=this.g[a])||(e=this.g[a]=[],this.h++);var u=he(e,t,r,i);return-1<u?(t=e[u],n||(t.fa=!1)):((t=new oe(t,this.src,a,!!r,i)).fa=n,e.push(t)),t};var fe="closure_lm_"+(1e6*Math.random()|0),de={};function ve(e,t,n,r,i){if(r&&r.once)return ye(e,t,n,r,i);if(Array.isArray(t)){for(var a=0;a<t.length;a++)ve(e,t[a],n,r,i);return null}return n=Ie(n),e&&e[ae]?e.K(t,n,c(r)?!!r.capture:!!r,i):pe(e,t,n,!1,r,i)}function pe(e,t,n,r,i,a){if(!t)throw Error("Invalid event type");var u=c(i)?!!i.capture:!!i,o=be(e);if(o||(e[fe]=o=new ce(e)),(n=o.add(t,n,r,u,a)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}var t=we;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)ne||(i=u),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(ke(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function ye(e,t,n,r,i){if(Array.isArray(t)){for(var a=0;a<t.length;a++)ye(e,t[a],n,r,i);return null}return n=Ie(n),e&&e[ae]?e.L(t,n,c(r)?!!r.capture:!!r,i):pe(e,t,n,!0,r,i)}function me(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)me(e,t[a],n,r,i);else r=c(r)?!!r.capture:!!r,n=Ie(n),e&&e[ae]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=he(a=e.g[t],n,r,i))&&(se(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete e.g[t],e.h--)))):e&&(e=be(e))&&(t=e.g[t.toString()],e=-1,t&&(e=he(t,n,r,i)),(n=-1<e?t[e]:null)&&ge(n))}function ge(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[ae])le(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ke(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=be(t))?(le(n,e),0==n.h&&(n.src=null,t[fe]=null)):se(e)}}}function ke(e){return e in de?de[e]:de[e]="on"+e}function we(e,t){if(e.da)e=!0;else{t=new re(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&ge(e),e=n.call(r,t)}return e}function be(e){return(e=e[fe])instanceof ce?e:null}var xe="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ie(e){return"function"===typeof e?e:(e[xe]||(e[xe]=function(t){return e.handleEvent(t)}),e[xe])}function _e(){ee.call(this),this.i=new ce(this),this.M=this,this.F=null}function Te(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"===typeof t)t=new te(t,e);else if(t instanceof te)t.target=t.target||e;else{var i=t;B(t=new te(r,e),i)}if(i=!0,n)for(var a=n.length-1;0<=a;a--){var u=t.g=n[a];i=Ze(u,r,!0,t)&&i}if(i=Ze(u=t.g=e,r,!0,t)&&i,i=Ze(u,r,!1,t)&&i,n)for(a=0;a<n.length;a++)i=Ze(u=t.g=n[a],r,!1,t)&&i}function Ze(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,a=0;a<t.length;++a){var u=t[a];if(u&&!u.da&&u.capture==n){var o=u.listener,s=u.ha||u.src;u.fa&&le(e.i,u),i=!1!==o.call(s,r)&&i}}return i&&!r.defaultPrevented}function Ee(e,t,n){if("function"===typeof e)n&&(e=p(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=p(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function Se(e){e.g=Ee((function(){e.g=null,e.i&&(e.i=!1,Se(e))}),e.l);var t=e.h;e.h=null,e.m.apply(null,t)}k(_e,ee),_e.prototype[ae]=!0,_e.prototype.removeEventListener=function(e,t,n,r){me(this,e,t,n,r)},_e.prototype.N=function(){if(_e.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)se(n[r]);delete t.g[e],t.h--}}this.F=null},_e.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},_e.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Ce=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this)).m=e,i.l=r,i.h=null,i.i=!1,i.g=null,i}return(0,m.Z)(n,[{key:"j",value:function(e){this.h=arguments,this.g?this.i=!0:Se(this)}},{key:"N",value:function(){(0,u.Z)((0,o.Z)(n.prototype),"N",this).call(this),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}]),n}(ee);function Ae(e){ee.call(this),this.h=e,this.g={}}k(Ae,ee);var De=[];function Ne(e){V(e.g,(function(e,t){this.g.hasOwnProperty(t)&&ge(e)}),e),e.g={}}Ae.prototype.N=function(){Ae.aa.N.call(this),Ne(this)},Ae.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Re=i.JSON.stringify,Me=i.JSON.parse,Oe=function(){function e(){(0,y.Z)(this,e)}return(0,m.Z)(e,[{key:"stringify",value:function(e){return i.JSON.stringify(e,void 0)}},{key:"parse",value:function(e){return i.JSON.parse(e,void 0)}}]),e}();function Pe(){}function Fe(e){return e.h||(e.h=e.i())}function Le(){}Pe.prototype.h=null;var Ve={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function qe(){te.call(this,"d")}function Ue(){te.call(this,"c")}k(qe,te),k(Ue,te);var Be={},ze=null;function je(){return ze=ze||new _e}function Ge(e){te.call(this,Be.La,e)}function Ke(e){var t=je();Te(t,new Ge(t))}function Qe(e,t){te.call(this,Be.STAT_EVENT,e),this.stat=t}function He(e){var t=je();Te(t,new Qe(t,e))}function We(e,t){te.call(this,Be.Ma,e),this.size=t}function Je(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){e()}),t)}function Ye(){this.g=!0}function Xe(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var a=i[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var u=1;u<i.length;u++)i[u]=""}}}return Re(n)}catch(o){return t}}(e,n)+(r?" "+r:"")}))}Be.La="serverreachability",k(Ge,te),Be.STAT_EVENT="statevent",k(Qe,te),Be.Ma="timingevent",k(We,te),Ye.prototype.xa=function(){this.g=!1},Ye.prototype.info=function(){};var $e,et={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},tt={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function nt(){}function rt(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new Ae(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new it}function it(){this.i=null,this.g="",this.h=!1}k(nt,Pe),nt.prototype.g=function(){return new XMLHttpRequest},nt.prototype.i=function(){return{}},$e=new nt;var at={},ut={};function ot(e,t,n){e.L=1,e.v=Rt(St(t)),e.m=n,e.P=!0,st(e,null)}function st(e,t){e.F=Date.now(),ht(e),e.A=St(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),Qt(n.i,"t",r),e.C=0,n=e.j.J,e.h=new it,e.g=On(e.j,n?t:null,!e.m),0<e.O&&(e.M=new Ce(p(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(De[0]=i.toString()),i=De);for(var a=0;a<i.length;a++){var u=ve(n,i[a],r||t.handleEvent,!1,t.h||t);if(!u)break;t.g[u.key]=u}t=e.H?q(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ke(),function(e,t,n,r,i,a){e.info((function(){if(e.g)if(a)for(var u="",o=a.split("&"),s=0;s<o.length;s++){var c=o[s].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");u=2<=h.length&&"type"==h[1]?u+(l+"=")+c+"&":u+(l+"=redacted&")}}else u=null;else u=a;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+u}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function ct(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function lt(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?ut:(n=Number(t.substring(n,r)),isNaN(n)?at:(r+=1)+n>t.length?ut:(t=t.slice(r,r+n),e.C=r+n,t))}function ht(e){e.S=Date.now()+e.I,ft(e,e.I)}function ft(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Je(p(e.ba,e),t)}function dt(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function vt(e){0==e.j.G||e.J||An(e.j,e)}function pt(e){dt(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,Ne(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function yt(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||bt(n.h,e)))if(!e.K&&bt(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(a){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Cn(n),kn(n)}Zn(n),He(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Je(p(n.Za,n),6e3));if(1>=wt(n.h)&&n.ca){try{n.ca()}catch(a){}n.ca=void 0}}else Nn(n,11)}else if((e.K||n.g==e)&&Cn(n),!I(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){var a=i[t];if(n.T=a[0],a=a[1],2==n.G)if("c"==a[0]){n.K=a[1],n.ia=a[2];var u=a[3];null!=u&&(n.la=u,n.j.info("VER="+n.la));var o=a[4];null!=o&&(n.Aa=o,n.j.info("SVER="+n.Aa));var s=a[5];null!=s&&"number"===typeof s&&0<s&&(r=1.5*s,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=e.g;if(c){var l=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var h=r.h;h.g||-1==l.indexOf("spdy")&&-1==l.indexOf("quic")&&-1==l.indexOf("h2")||(h.j=h.l,h.g=new Set,h.h&&(xt(h,h.h),h.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.ya=f,Nt(r.I,r.D,f))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var d=e;if((r=n).qa=Mn(r,r.J?r.ia:null,r.W),d.K){It(r.h,d);var v=d,y=r.L;y&&(v.I=y),v.B&&(dt(v),ht(v)),r.g=d}else Tn(r);0<n.i.length&&bn(n)}else"stop"!=a[0]&&"close"!=a[0]||Nn(n,7);else 3==n.G&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?Nn(n,7):gn(n):"noop"!=a[0]&&n.l&&n.l.ta(a),n.v=0)}Ke()}catch(a){}}rt.prototype.ca=function(e){e=e.target;var t=this.M;t&&3==vn(e)?t.j():this.Y(e)},rt.prototype.Y=function(e){try{if(e==this.g)e:{var t=vn(this.g),n=this.g.Ba();this.g.Z();if(!(3>t)&&(3!=t||this.g&&(this.h.h||this.g.oa()||pn(this.g)))){this.J||4!=t||7==n||Ke(),dt(this);var r=this.g.Z();this.X=r;t:if(ct(this)){var a=pn(this.g);e="";var u=a.length,o=4==vn(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){pt(this),vt(this);var s="";break t}this.h.i=new i.TextDecoder}for(n=0;n<u;n++)this.h.h=!0,e+=this.h.i.decode(a[n],{stream:!(o&&n==u-1)});a.length=0,this.h.g+=e,this.C=0,s=this.h.g}else s=this.g.oa();if(this.o=200==r,function(e,t,n,r,i,a,u){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+a+" "+u}))}(this.i,this.u,this.A,this.l,this.R,t,r),this.o){if(this.T&&!this.K){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(c)){var h=c;break t}}h=null}if(!(r=h)){this.o=!1,this.s=3,He(12),pt(this),vt(this);break e}Xe(this.i,this.l,r,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,yt(this,r)}if(this.P){var f;for(r=!0;!this.J&&this.C<s.length;){if((f=lt(this,s))==ut){4==t&&(this.s=4,He(14),r=!1),Xe(this.i,this.l,null,"[Incomplete Response]");break}if(f==at){this.s=4,He(15),Xe(this.i,this.l,s,"[Invalid Chunk]"),r=!1;break}Xe(this.i,this.l,f,null),yt(this,f)}if(ct(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=t||0!=s.length||this.h.h||(this.s=1,He(16),r=!1),this.o=this.o&&r,r){if(0<s.length&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.ba&&!d.M&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+s.length),En(d),d.M=!0,He(11))}}else Xe(this.i,this.l,s,"[Invalid Chunked Response]"),pt(this),vt(this)}else Xe(this.i,this.l,s,null),yt(this,s);4==t&&pt(this),this.o&&!this.J&&(4==t?An(this.j,this):(this.o=!1,ht(this)))}else(function(e){var t={};e=(e.g&&2<=vn(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(var n=0;n<e.length;n++)if(!I(e[n])){var r=z(e[n]),i=r[0];if("string"===typeof(r=r[1])){r=r.trim();var a=t[i]||[];t[i]=a,a.push(r)}}!function(e,t){for(var n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==r&&0<s.indexOf("Unknown SID")?(this.s=3,He(12)):(this.s=0,He(13)),pt(this),vt(this)}}}catch(t){}},rt.prototype.cancel=function(){this.J=!0,pt(this)},rt.prototype.ba=function(){this.B=null;var e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(Ke(),He(17)),pt(this),this.s=2,vt(this)):ft(this,this.S-e)};var mt=(0,m.Z)((function e(t,n){(0,y.Z)(this,e),this.g=t,this.map=n}));function gt(e){this.l=e||10,i.PerformanceNavigationTiming?e=0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function kt(e){return!!e.h||!!e.g&&e.g.size>=e.j}function wt(e){return e.h?1:e.g?e.g.size:0}function bt(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function xt(e,t){e.g?e.g.add(t):e.h=t}function It(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function _t(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){var t,n=e.i,r=(0,l.Z)(e.g.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n=n.concat(i.D)}}catch(a){r.e(a)}finally{r.f()}return n}return w(e.i)}function Tt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(a(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(a(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(var r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(a(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,u=0;u<i;u++)t.call(void 0,r[u],n&&n[u],e)}gt.prototype.cancel=function(){if(this.i=_t(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){var e,t=(0,l.Z)(this.g.values());try{for(t.s();!(e=t.n()).done;){e.value.cancel()}}catch(n){t.e(n)}finally{t.f()}this.g.clear()}};var Zt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Et(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof Et){this.h=e.h,Ct(this,e.j),this.o=e.o,this.g=e.g,At(this,e.s),this.l=e.l;var t=e.i,n=new zt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Dt(this,n),this.m=e.m}else e&&(t=String(e).match(Zt))?(this.h=!1,Ct(this,t[1]||"",!0),this.o=Mt(t[2]||""),this.g=Mt(t[3]||"",!0),At(this,t[4]),this.l=Mt(t[5]||"",!0),Dt(this,t[6]||"",!0),this.m=Mt(t[7]||"")):(this.h=!1,this.i=new zt(null,this.h))}function St(e){return new Et(e)}function Ct(e,t,n){e.j=n?Mt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function At(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function Dt(e,t,n){t instanceof zt?(e.i=t,function(e,t){t&&!e.j&&(jt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Gt(this,t),Qt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=Ot(t,Ut)),e.i=new zt(t,e.h))}function Nt(e,t,n){e.i.set(t,n)}function Rt(e){return Nt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Mt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Ot(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,Pt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Pt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Et.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Ot(t,Lt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(Ot(t,Lt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Ot(n,"/"==n.charAt(0)?qt:Vt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",Ot(n,Bt)),e.join("")};var Ft,Lt=/[#\/\?@]/g,Vt=/[#\?:]/g,qt=/[#\?]/g,Ut=/[#\?@]/g,Bt=/#/g;function zt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function jt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var a=e[n].substring(0,r);i=e[n].substring(r+1)}else a=e[n];t(a,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Gt(e,t){jt(e),t=Ht(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Kt(e,t){return jt(e),t=Ht(e,t),e.g.has(t)}function Qt(e,t,n){Gt(e,t),0<n.length&&(e.i=null,e.g.set(Ht(e,t),w(n)),e.h+=n.length)}function Ht(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Wt(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(a){}}function Jt(){this.g=new Oe}function Yt(e,t,n){var r=n||"";try{Tt(e,(function(e,n){var i=e;c(e)&&(i=Re(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function Xt(e){this.l=e.Ub||null,this.j=e.eb||!1}function $t(e,t){_e.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function en(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function tn(e){e.readyState=4,e.l=null,e.j=null,e.v=null,nn(e)}function nn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function rn(e){var t="";return V(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function an(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=rn(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):Nt(e,t,n))}function un(e){_e.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=zt.prototype).add=function(e,t){jt(this),this.i=null,e=Ht(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){jt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},e.na=function(){jt(this);for(var e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[],r=0;r<t.length;r++)for(var i=e[r],a=0;a<i.length;a++)n.push(t[r]);return n},e.V=function(e){jt(this);var t=[];if("string"===typeof e)Kt(this,e)&&(t=t.concat(this.g.get(Ht(this,e))));else{e=Array.from(this.g.values());for(var n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return jt(this),this.i=null,Kt(this,e=Ht(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=Array.from(this.g.keys()),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r)),a=this.V(r);for(r=0;r<a.length;r++){var u=i;""!==a[r]&&(u+="="+encodeURIComponent(String(a[r]))),e.push(u)}}return this.i=e.join("&")},k(Xt,Pe),Xt.prototype.g=function(){return new $t(this.l,this.j)},Xt.prototype.i=(Ft={},function(){return Ft}),k($t,_e),(e=$t.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,nn(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((function(){})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tn(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,nn(this)),this.g&&(this.readyState=3,nn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if("undefined"!==typeof i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;en(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tn(this):nn(this),3==this.readyState&&en(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,tn(this))},e.Qa=function(e){this.g&&(this.response=e,tn(this))},e.ga=function(){this.g&&tn(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty($t.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),k(un,_e);var on=/^https?$/i,sn=["POST","PUT"];function cn(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,ln(e),fn(e)}function ln(e){e.A||(e.A=!0,Te(e,"complete"),Te(e,"error"))}function hn(e){if(e.h&&"undefined"!=typeof r&&(!e.v[1]||4!=vn(e)||2!=e.Z()))if(e.u&&4==vn(e))Ee(e.Ea,0,e);else if(Te(e,"readystatechange"),4==vn(e)){e.h=!1;try{var t,n=e.Z();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break e;default:a=!1}if(!(t=a)){var u;if(u=0===n){var o=String(e.D).match(Zt)[1]||null;!o&&i.self&&i.self.location&&(o=i.self.location.protocol.slice(0,-1)),u=!on.test(o?o.toLowerCase():"")}t=u}if(t)Te(e,"complete"),Te(e,"success");else{e.m=6;try{var s=2<vn(e)?e.g.statusText:""}catch(c){s=""}e.l=s+" ["+e.Z()+"]",ln(e)}}finally{fn(e)}}}function fn(e,t){if(e.g){dn(e);var n=e.g,r=e.v[0]?function(){}:null;e.g=null,e.v=null,t||Te(e,"ready");try{n.onreadystatechange=r}catch(i){}}}function dn(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function vn(e){return e.g?e.g.readyState:0}function pn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(F){return null}}function yn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function mn(e){this.Aa=0,this.i=[],this.j=new Ye,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=yn("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=yn("baseRetryDelayMs",5e3,e),this.cb=yn("retryDelaySeedMs",1e4,e),this.Wa=yn("forwardChannelMaxRetries",2,e),this.wa=yn("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new gt(e&&e.concurrentRequestLimit),this.Da=new Jt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function gn(e){if(wn(e),3==e.G){var t=e.U++,n=St(e.I);if(Nt(n,"SID",e.K),Nt(n,"RID",t),Nt(n,"TYPE","terminate"),In(e,n),(t=new rt(e,e.j,t)).L=2,t.v=Rt(St(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(r){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=On(t.j,null),t.g.ea(t.v)),t.F=Date.now(),ht(t)}Rn(e)}function kn(e){e.g&&(En(e),e.g.cancel(),e.g=null)}function wn(e){kn(e),e.u&&(i.clearTimeout(e.u),e.u=null),Cn(e),e.h.cancel(),e.s&&("number"===typeof e.s&&i.clearTimeout(e.s),e.s=null)}function bn(e){if(!kt(e.h)&&!e.s){e.s=!0;var t=e.Ga;K||X(),J||(K(),J=!0),Y.add(t,e),e.B=0}}function xn(e,t){var n;n=t?t.l:e.U++;var r=St(e.I);Nt(r,"SID",e.K),Nt(r,"RID",n),Nt(r,"AID",e.T),In(e,r),e.m&&e.o&&an(r,e.m,e.o),n=new rt(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=_n(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),xt(e.h,n),ot(n,r,t)}function In(e,t){e.H&&V(e.H,(function(e,n){Nt(t,n,e)})),e.l&&Tt({},(function(e,n){Nt(t,n,e)}))}function _n(e,t,n){n=Math.min(e.i.length,n);var r=e.l?p(e.l.Na,e.l,e):null;e:for(var i=e.i,a=-1;;){var u=["count="+n];-1==a?0<n?(a=i[0].g,u.push("ofs="+a)):a=0:u.push("ofs="+a);for(var o=!0,s=0;s<n;s++){var c=i[s].g,l=i[s].map;if(0>(c-=a))a=Math.max(0,i[s].g-100),o=!1;else try{Yt(l,u,"req"+c+"_")}catch(M){r&&r(l)}}if(o){r=u.join("&");break e}}return e=e.i.splice(0,n),t.D=e,r}function Tn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;K||X(),J||(K(),J=!0),Y.add(t,e),e.v=0}}function Zn(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Je(p(e.Fa,e),Dn(e,e.v)),e.v++,!0)}function En(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function Sn(e){e.g=new rt(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=St(e.qa);Nt(t,"RID","rpc"),Nt(t,"SID",e.K),Nt(t,"AID",e.T),Nt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&Nt(t,"TO",e.ja),Nt(t,"TYPE","xmlhttp"),In(e,t),e.m&&e.o&&an(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=Rt(St(t)),n.m=null,n.P=!0,st(n,e)}function Cn(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function An(e,t){var n=null;if(e.g==t){Cn(e),En(e),e.g=null;var r=2}else{if(!bt(e.h,t))return;n=t.D,It(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;Te(r=je(),new We(r,n)),bn(e)}else Tn(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!(wt(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa))&&(e.s=Je(p(e.Ga,e,t),Dn(e,e.B)),e.B++,!0))}(e,t)||2==r&&Zn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:Nn(e,5);break;case 4:Nn(e,10);break;case 3:Nn(e,6);break;default:Nn(e,2)}}function Dn(e,t){var n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function Nn(e,t){if(e.j.info("Error code "+t),2==t){var n=p(e.fb,e),r=e.Xa,a=!r;r=new Et(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||Ct(r,"https"),Rt(r),a?function(e,t){var n=new Ye;if(i.Image){var r=new Image;r.onload=g(Wt,n,"TestLoadImage: loaded",!0,t,r),r.onerror=g(Wt,n,"TestLoadImage: error",!1,t,r),r.onabort=g(Wt,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=g(Wt,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ye;var n=new AbortController,r=setTimeout((function(){n.abort(),Wt(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((function(e){clearTimeout(r),e.ok?Wt(0,0,!0,t):Wt(0,0,!1,t)})).catch((function(){clearTimeout(r),Wt(0,0,!1,t)}))}(r.toString(),n)}else He(2);e.G=0,e.l&&e.l.sa(t),Rn(e),wn(e)}function Rn(e){if(e.G=0,e.ka=[],e.l){var t=_t(e.h);0==t.length&&0==e.i.length||(b(e.ka,t),b(e.ka,e.i),e.h.i.length=0,w(e.i),e.i.length=0),e.l.ra()}}function Mn(e,t,n){var r=n instanceof Et?St(n):new Et(n);if(""!=r.g)t&&(r.g=t+"."+r.g),At(r,r.s);else{var a=i.location;r=a.protocol,t=t?t+"."+a.hostname:a.hostname,a=+a.port;var u=new Et(null);r&&Ct(u,r),t&&(u.g=t),a&&At(u,a),n&&(u.l=n),r=u}return n=e.D,t=e.ya,n&&t&&Nt(r,n,t),Nt(r,"VER",e.la),In(e,r),r}function On(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new un(new Xt({eb:n})):new un(e.pa)).Ha(e.J),t}function Pn(){}function Fn(){}function Ln(e,t){_e.call(this),this.g=new mn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!I(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!I(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Un(this)}function Vn(e){qe.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function qn(){Ue.call(this),this.status=1}function Un(e){this.g=e}(e=un.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():$e.g(),this.v=this.o?Fe(this.o):Fe($e),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(c){return void cn(this,c)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var a in r)n.set(a,r[a]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));var u,o=(0,l.Z)(r.keys());try{for(o.s();!(u=o.n()).done;){var c=u.value;n.set(c,r.get(c))}}catch(m){o.e(m)}finally{o.f()}}r=Array.from(n.keys()).find((function(e){return"content-type"==e.toLowerCase()})),a=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(sn,t,void 0))||r||a||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");var h,f=(0,l.Z)(n);try{for(f.s();!(h=f.n()).done;){var d=(0,s.Z)(h.value,2),v=d[0],y=d[1];this.g.setRequestHeader(v,y)}}catch(m){f.e(m)}finally{f.f()}this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{dn(this),this.u=!0,this.g.send(e),this.u=!1}catch(c){cn(this,c)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,Te(this,"complete"),Te(this,"abort"),fn(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),fn(this,!0)),un.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?hn(this):this.bb())},e.bb=function(){hn(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<vn(this)?this.g.status:-1}catch(Ft){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(Ft){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Me(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=mn.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){He(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=Mn(this,null,this.W),bn(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;var t=new rt(this,this.j,e),n=this.o;if(this.S&&(n?B(n=q(n),this.S):n=this.S),null!==this.m||this.O||(t.H=n,n=null),this.P)e:{for(var r=0,i=0;i<this.i.length;i++){var a=this.i[i];if(void 0===(a="__data__"in a.map&&"string"===typeof(a=a.map.__data__)?a.length:void 0))break;if(4096<(r+=a)){r=i;break e}if(4096===r||i===this.i.length-1){r=i+1;break e}}r=1e3}else r=1e3;r=_n(this,t,r),Nt(i=St(this.I),"RID",e),Nt(i,"CVER",22),this.D&&Nt(i,"X-HTTP-Session-Id",this.D),In(this,i),n&&(this.O?r="headers="+encodeURIComponent(String(rn(n)))+"&"+r:this.m&&an(i,this.m,n)),xt(this.h,t),this.Ua&&Nt(i,"TYPE","init"),this.P?(Nt(i,"$req",r),Nt(i,"SID","null"),t.T=!0,ot(t,i,null)):ot(t,i,r),this.G=2}}else 3==this.G&&(e?xn(this,e):0==this.i.length||kt(this.h)||xn(this))},e.Fa=function(){if(this.u=null,Sn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Je(p(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,He(10),kn(this),Sn(this))},e.Za=function(){null!=this.C&&(this.C=null,kn(this),Zn(this),He(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),He(2)):(this.j.info("Failed to ping google.com"),He(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=Pn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},Fn.prototype.g=function(e,t){return new Ln(e,t)},k(Ln,_e),Ln.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ln.prototype.close=function(){gn(this.g)},Ln.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=Re(e),e=n);t.i.push(new mt(t.Ya++,e)),3==t.G&&bn(t)},Ln.prototype.N=function(){this.g.l=null,delete this.j,gn(this.g),delete this.g,Ln.aa.N.call(this)},k(Vn,qe),k(qn,Ue),k(Un,Pn),Un.prototype.ua=function(){Te(this.g,"a")},Un.prototype.ta=function(e){Te(this.g,new Vn(e))},Un.prototype.sa=function(e){Te(this.g,new qn)},Un.prototype.ra=function(){Te(this.g,"b")},Fn.prototype.createWebChannel=Fn.prototype.g,Ln.prototype.send=Ln.prototype.o,Ln.prototype.open=Ln.prototype.m,Ln.prototype.close=Ln.prototype.close,D=R.createWebChannelTransport=function(){return new Fn},A=R.getStatEventTarget=function(){return je()},C=R.Event=Be,S=R.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},et.NO_ERROR=0,et.TIMEOUT=8,et.HTTP_ERROR=6,E=R.ErrorCode=et,tt.COMPLETE="complete",Z=R.EventType=tt,Le.EventType=Ve,Ve.OPEN="a",Ve.CLOSE="b",Ve.ERROR="c",Ve.MESSAGE="d",_e.prototype.listen=_e.prototype.K,T=R.WebChannel=Le,R.FetchXmlHttpFactory=Xt,un.prototype.listenOnce=un.prototype.L,un.prototype.getLastError=un.prototype.Ka,un.prototype.getLastErrorCode=un.prototype.Ba,un.prototype.getStatus=un.prototype.Z,un.prototype.getResponseJson=un.prototype.Oa,un.prototype.getResponseText=un.prototype.oa,un.prototype.send=un.prototype.ea,un.prototype.setWithCredentials=un.prototype.Ha,_=R.XhrIo=un}).apply("undefined"!==typeof N?N:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var M="@firebase/firestore",O=function(){function e(t){(0,y.Z)(this,e),this.uid=t}return(0,m.Z)(e,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(e){return e.uid===this.uid}}]),e}();O.UNAUTHENTICATED=new O(null),O.GOOGLE_CREDENTIALS=new O("google-credentials-uid"),O.FIRST_PARTY=new O("first-party-uid"),O.MOCK_USER=new O("mock-user");var P="11.0.0",F=new w.Yd("@firebase/firestore");function L(){return F.logLevel}function V(e){F.setLogLevel(e)}function q(e){if(F.logLevel<=w.in.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(z);F.debug.apply(F,["Firestore (".concat(P,"): ").concat(e)].concat((0,p.Z)(i)))}}function U(e){if(F.logLevel<=w.in.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(z);F.error.apply(F,["Firestore (".concat(P,"): ").concat(e)].concat((0,p.Z)(i)))}}function B(e){if(F.logLevel<=w.in.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(z);F.warn.apply(F,["Firestore (".concat(P,"): ").concat(e)].concat((0,p.Z)(i)))}}function z(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",t="FIRESTORE (".concat(P,") INTERNAL ASSERTION FAILED: ")+e;throw U(t),new Error(t)}function G(e,t){e||j()}function K(e,t){e||j()}function Q(e,t){return e}var H={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},W=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this,e,r)).code=e,i.message=r,i.toString=function(){return"".concat(i.name,": [code=").concat(i.code,"]: ").concat(i.message)},i}return(0,m.Z)(n)}(b.ZR),J=(0,m.Z)((function e(){var t=this;(0,y.Z)(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))})),Y=(0,m.Z)((function e(t,n){(0,y.Z)(this,e),this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))})),X=function(){function e(){(0,y.Z)(this,e)}return(0,m.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(O.UNAUTHENTICATED)}))}},{key:"shutdown",value:function(){}}]),e}(),$=function(){function e(t){(0,y.Z)(this,e),this.token=t,this.changeListener=null}return(0,m.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable((function(){return t(n.token.user)}))}},{key:"shutdown",value:function(){this.changeListener=null}}]),e}(),ee=function(){function e(t){(0,y.Z)(this,e),this.t=t,this.currentUser=O.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return(0,m.Z)(e,[{key:"start",value:function(e,t){var n=this;G(void 0===this.o);var r=this.i,i=function(e){return n.i!==r?(r=n.i,t(e)):Promise.resolve()},a=new J;this.o=function(){n.i++,n.currentUser=n.u(),a.resolve(),a=new J,e.enqueueRetryable((function(){return i(n.currentUser)}))};var u=function(){var t=a;e.enqueueRetryable((0,f.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.promise;case 2:return e.next=4,i(n.currentUser);case 4:case"end":return e.stop()}}),e)}))))},o=function(e){q("FirebaseAuthCredentialsProvider","Auth detected"),n.auth=e,n.o&&(n.auth.addAuthTokenListener(n.o),u())};this.t.onInit((function(e){return o(e)})),setTimeout((function(){if(!n.auth){var e=n.t.getImmediate({optional:!0});e?o(e):(q("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new J)}}),0),u()}},{key:"getToken",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return e.i!==t?(q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?(G("string"==typeof n.accessToken),new Y(n.accessToken,e.currentUser)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}},{key:"u",value:function(){var e=this.auth&&this.auth.getUid();return G(null===e||"string"==typeof e),new O(e)}}]),e}(),te=function(){function e(t,n,r){(0,y.Z)(this,e),this.l=t,this.h=n,this.P=r,this.type="FirstParty",this.user=O.FIRST_PARTY,this.I=new Map}return(0,m.Z)(e,[{key:"T",value:function(){return this.P?this.P():null}},{key:"headers",get:function(){this.I.set("X-Goog-AuthUser",this.l);var e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}]),e}(),ne=function(){function e(t,n,r){(0,y.Z)(this,e),this.l=t,this.h=n,this.P=r}return(0,m.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(new te(this.l,this.h,this.P))}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(O.FIRST_PARTY)}))}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),e}(),re=(0,m.Z)((function e(t){(0,y.Z)(this,e),this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)})),ie=function(){function e(t){(0,y.Z)(this,e),this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}return(0,m.Z)(e,[{key:"start",value:function(e,t){var n=this;G(void 0===this.o);var r=function(e){null!=e.error&&q("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));var r=e.token!==n.R;return n.R=e.token,q("FirebaseAppCheckTokenProvider","Received ".concat(r?"new":"existing"," token.")),r?t(e.token):Promise.resolve()};this.o=function(t){e.enqueueRetryable((function(){return r(t)}))};var i=function(e){q("FirebaseAppCheckTokenProvider","AppCheck detected"),n.appCheck=e,n.o&&n.appCheck.addTokenListener(n.o)};this.A.onInit((function(e){return i(e)})),setTimeout((function(){if(!n.appCheck){var e=n.A.getImmediate({optional:!0});e?i(e):q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}},{key:"getToken",value:function(){var e=this,t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((function(t){return t?(G("string"==typeof t.token),e.R=t.token,new re(t.token)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}]),e}(),ae=function(){function e(){(0,y.Z)(this,e)}return(0,m.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(new re(""))}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){}},{key:"shutdown",value:function(){}}]),e}();function ue(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}var oe=function(){function e(){(0,y.Z)(this,e)}return(0,m.Z)(e,null,[{key:"newId",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62),n="";n.length<20;)for(var r=ue(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%62));return n}}]),e}();function se(e,t){return e<t?-1:e>t?1:0}function ce(e,t,n){return e.length===t.length&&e.every((function(e,r){return n(e,t[r])}))}function le(e){return e+"\0"}var he=function(){function e(t,n){if((0,y.Z)(this,e),this.seconds=t,this.nanoseconds=n,n<0)throw new W(H.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new W(H.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new W(H.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new W(H.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return(0,m.Z)(e,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?se(this.nanoseconds,e.nanoseconds):se(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return e.fromMillis(Date.now())}},{key:"fromDate",value:function(t){return e.fromMillis(t.getTime())}},{key:"fromMillis",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}(),fe=function(){function e(t){(0,y.Z)(this,e),this.timestamp=t}return(0,m.Z)(e,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(t){return new e(t)}},{key:"min",value:function(){return new e(new he(0,0))}},{key:"max",value:function(){return new e(new he(253402300799,999999999))}}]),e}(),de=function(){function e(t,n,r){(0,y.Z)(this,e),void 0===n?n=0:n>t.length&&j(),void 0===r?r=t.length-n:r>t.length-n&&j(),this.segments=t,this.offset=n,this.len=r}return(0,m.Z)(e,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(t){return 0===e.comparator(this,t)}},{key:"child",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach((function(e){n.push(e)})):n.push(t),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),a=t.get(r);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),ve=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"toUriEncodedString",value:function(){return this.toArray().map(encodeURIComponent).join("/")}}],[{key:"fromString",value:function(){for(var e=[],t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0,u=r;a<u.length;a++){var o=u[a];if(o.indexOf("//")>=0)throw new W(H.INVALID_ARGUMENT,"Invalid segment (".concat(o,"). Paths must not contain // in them."));e.push.apply(e,(0,p.Z)(o.split("/").filter((function(e){return e.length>0}))))}return new n(e)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(de),pe=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ye=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().map((function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e})).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(e){return pe.test(e)}},{key:"keyField",value:function(){return new n(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var t=[],r="",i=0,a=function(){if(0===r.length)throw new W(H.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(r),r=""},u=!1;i<e.length;){var o=e[i];if("\\"===o){if(i+1===e.length)throw new W(H.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var s=e[i+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new W(H.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=s,i+=2}else"`"===o?(u=!u,i++):"."!==o||u?(r+=o,i++):(a(),i++)}if(a(),u)throw new W(H.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(de),me=function(){function e(t){(0,y.Z)(this,e),this.path=t}return(0,m.Z)(e,[{key:"collectionGroup",get:function(){return this.path.popLast().lastSegment()}},{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"getCollectionGroup",value:function(){return this.path.get(this.path.length-2)}},{key:"getCollectionPath",value:function(){return this.path.popLast()}},{key:"isEqual",value:function(e){return null!==e&&0===ve.comparator(this.path,e.path)}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(t){return new e(ve.fromString(t))}},{key:"fromName",value:function(t){return new e(ve.fromString(t).popFirst(5))}},{key:"empty",value:function(){return new e(ve.emptyPath())}},{key:"comparator",value:function(e,t){return ve.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(t){return new e(new ve(t.slice()))}}]),e}(),ge=(0,m.Z)((function e(t,n,r,i){(0,y.Z)(this,e),this.indexId=t,this.collectionGroup=n,this.fields=r,this.indexState=i}));function ke(e){return e.fields.find((function(e){return 2===e.kind}))}function we(e){return e.fields.filter((function(e){return 2!==e.kind}))}function be(e,t){var n=se(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(var r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(0!==(n=Ie(e.fields[r],t.fields[r])))return n;return se(e.fields.length,t.fields.length)}ge.UNKNOWN_ID=-1;var xe=(0,m.Z)((function e(t,n){(0,y.Z)(this,e),this.fieldPath=t,this.kind=n}));function Ie(e,t){var n=ye.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:se(e.kind,t.kind)}var _e=function(){function e(t,n){(0,y.Z)(this,e),this.sequenceNumber=t,this.offset=n}return(0,m.Z)(e,null,[{key:"empty",value:function(){return new e(0,Ee.min())}}]),e}();function Te(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=fe.fromTimestamp(1e9===r?new he(n+1,0):new he(n,r));return new Ee(i,me.empty(),t)}function Ze(e){return new Ee(e.readTime,e.key,-1)}var Ee=function(){function e(t,n,r){(0,y.Z)(this,e),this.readTime=t,this.documentKey=n,this.largestBatchId=r}return(0,m.Z)(e,null,[{key:"min",value:function(){return new e(fe.min(),me.empty(),-1)}},{key:"max",value:function(){return new e(fe.max(),me.empty(),-1)}}]),e}();function Se(e,t){var n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=me.comparator(e.documentKey,t.documentKey))?n:se(e.largestBatchId,t.largestBatchId)}var Ce="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ae=function(){function e(){(0,y.Z)(this,e),this.onCommittedListeners=[]}return(0,m.Z)(e,[{key:"addOnCommittedListener",value:function(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach((function(e){return e()}))}}]),e}();function De(e){return Ne.apply(this,arguments)}function Ne(){return(Ne=(0,f.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.code===H.FAILED_PRECONDITION&&t.message===Ce){e.next=2;break}throw t;case 2:q("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Re=function(){function e(t){var n=this;(0,y.Z)(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(e){n.isDone=!0,n.result=e,n.nextCallback&&n.nextCallback(e)}),(function(e){n.isDone=!0,n.error=e,n.catchCallback&&n.catchCallback(e)}))}return(0,m.Z)(e,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(t,n){var r=this;return this.callbackAttached&&j(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e((function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}}))}},{key:"toPromise",value:function(){var e=this;return new Promise((function(t,n){e.next(t,n)}))}},{key:"wrapUserFunction",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}},{key:"wrapSuccess",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.resolve(n)}},{key:"wrapFailure",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.reject(n)}}],[{key:"resolve",value:function(t){return new e((function(e,n){e(t)}))}},{key:"reject",value:function(t){return new e((function(e,n){n(t)}))}},{key:"waitFor",value:function(t){return new e((function(e,n){var r=0,i=0,a=!1;t.forEach((function(t){++r,t.next((function(){++i,a&&i===r&&e()}),(function(e){return n(e)}))})),a=!0,i===r&&e()}))}},{key:"or",value:function(t){var n,r=e.resolve(!1),i=(0,l.Z)(t);try{var a=function(){var t=n.value;r=r.next((function(n){return n?e.resolve(n):t()}))};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return r}},{key:"forEach",value:function(e,t){var n=this,r=[];return e.forEach((function(e,i){r.push(t.call(n,e,i))})),this.waitFor(r)}},{key:"mapArray",value:function(t,n){return new e((function(e,r){for(var i=t.length,a=new Array(i),u=0,o=function(){var o=s;n(t[o]).next((function(t){a[o]=t,++u===i&&e(a)}),(function(e){return r(e)}))},s=0;s<i;s++)o()}))}},{key:"doWhile",value:function(t,n){return new e((function(e,r){!function i(){!0===t()?n().next((function(){i()}),r):e()}()}))}}]),e}(),Me=function(){function e(t,n){var r=this;(0,y.Z)(this,e),this.action=t,this.transaction=n,this.aborted=!1,this.V=new J,this.transaction.oncomplete=function(){r.V.resolve()},this.transaction.onabort=function(){n.error?r.V.reject(new Le(t,n.error)):r.V.resolve()},this.transaction.onerror=function(e){var n=ze(e.target.error);r.V.reject(new Le(t,n))}}return(0,m.Z)(e,[{key:"m",get:function(){return this.V.promise}},{key:"abort",value:function(e){e&&this.V.reject(e),this.aborted||(q("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}},{key:"g",value:function(){var e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}},{key:"store",value:function(e){var t=this.transaction.objectStore(e);return new qe(t)}}],[{key:"open",value:function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(t){throw new Le(n,t)}}}]),e}(),Oe=function(){function e(t,n,r){(0,y.Z)(this,e),this.name=t,this.version=n,this.p=r,12.2===e.S((0,b.z$)())&&U("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return(0,m.Z)(e,[{key:"M",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t){var n=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.db,e.t0){e.next=6;break}return q("SimpleDb","Opening database:",this.name),e.next=5,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new Le(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new W(H.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new W(H.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new Le(t,n))},i.onupgradeneeded=function(e){q("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;n.p.O(t,i.transaction,e.oldVersion,n.version).next((function(){q("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}));case 5:this.db=e.sent;case 6:return this.N&&(this.db.onversionchange=function(e){return n.N(e)}),e.abrupt("return",this.db);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"L",value:function(e){this.N=e,this.db&&(this.db.onversionchange=function(t){return e(t)})}},{key:"runTransaction",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t,n,r,i){var a,u,o,s,c=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a="readonly"===n,u=0,o=(0,h.Z)().mark((function e(){var n,o,s,l;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return++u,e.prev=1,e.next=4,c.M(t);case 4:return c.db=e.sent,n=Me.open(c.db,t,a?"readonly":"readwrite",r),o=i(n).next((function(e){return n.g(),e})).catch((function(e){return n.abort(e),Re.reject(e)})).toPromise(),o.catch((function(){})),e.next=9,n.m;case 9:return e.t0=o,e.abrupt("return",{v:e.t0});case 13:if(e.prev=13,e.t1=e.catch(1),s=e.t1,l="FirebaseError"!==s.name&&u<3,q("SimpleDb","Transaction failed with error:",s.message,"Retrying:",l),c.close(),l){e.next=18;break}return e.abrupt("return",{v:Promise.reject(s)});case 18:case"end":return e.stop()}}),e,null,[[1,13]])}));case 3:return e.delegateYield(o(),"t0",4);case 4:if(!(s=e.t0)){e.next=7;break}return e.abrupt("return",s.v);case 7:e.next=3;break;case 9:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"close",value:function(){this.db&&this.db.close(),this.db=void 0}}],[{key:"delete",value:function(e){return q("SimpleDb","Removing database:",e),Ue(window.indexedDB.deleteDatabase(e)).toPromise()}},{key:"D",value:function(){if(!(0,b.hl)())return!1;if(e.v())return!0;var t=(0,b.z$)(),n=e.S(t),r=0<n&&n<10,i=Pe(t),a=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||a)}},{key:"v",value:function(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.C)}},{key:"F",value:function(e,t){return e.store(t)}},{key:"S",value:function(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}}]),e}();function Pe(e){var t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}var Fe=function(){function e(t){(0,y.Z)(this,e),this.B=t,this.k=!1,this.q=null}return(0,m.Z)(e,[{key:"isDone",get:function(){return this.k}},{key:"K",get:function(){return this.q}},{key:"cursor",set:function(e){this.B=e}},{key:"done",value:function(){this.k=!0}},{key:"$",value:function(e){this.q=e}},{key:"delete",value:function(){return Ue(this.B.delete())}}]),e}(),Le=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this,H.UNAVAILABLE,"IndexedDB transaction '".concat(e,"' failed: ").concat(r))).name="IndexedDbTransactionError",i}return(0,m.Z)(n)}(W);function Ve(e){return"IndexedDbTransactionError"===e.name}var qe=function(){function e(t){(0,y.Z)(this,e),this.store=t}return(0,m.Z)(e,[{key:"put",value:function(e,t){var n;return void 0!==t?(q("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(q("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Ue(n)}},{key:"add",value:function(e){return q("SimpleDb","ADD",this.store.name,e,e),Ue(this.store.add(e))}},{key:"get",value:function(e){var t=this;return Ue(this.store.get(e)).next((function(n){return void 0===n&&(n=null),q("SimpleDb","GET",t.store.name,e,n),n}))}},{key:"delete",value:function(e){return q("SimpleDb","DELETE",this.store.name,e),Ue(this.store.delete(e))}},{key:"count",value:function(){return q("SimpleDb","COUNT",this.store.name),Ue(this.store.count())}},{key:"U",value:function(e,t){var n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){var i=r.getAll(n.range);return new Re((function(e,t){i.onerror=function(e){t(e.target.error)},i.onsuccess=function(t){e(t.target.result)}}))}var a=this.cursor(n),u=[];return this.W(a,(function(e,t){u.push(t)})).next((function(){return u}))}},{key:"G",value:function(e,t){var n=this.store.getAll(e,null===t?void 0:t);return new Re((function(e,t){n.onerror=function(e){t(e.target.error)},n.onsuccess=function(t){e(t.target.result)}}))}},{key:"j",value:function(e,t){q("SimpleDb","DELETE ALL",this.store.name);var n=this.options(e,t);n.H=!1;var r=this.cursor(n);return this.W(r,(function(e,t,n){return n.delete()}))}},{key:"J",value:function(e,t){var n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.W(r,t)}},{key:"Y",value:function(e){var t=this.cursor({});return new Re((function(n,r){t.onerror=function(e){var t=ze(e.target.error);r(t)},t.onsuccess=function(t){var r=t.target.result;r?e(r.primaryKey,r.value).next((function(e){e?r.continue():n()})):n()}}))}},{key:"W",value:function(e,t){var n=[];return new Re((function(r,i){e.onerror=function(e){i(e.target.error)},e.onsuccess=function(e){var i=e.target.result;if(i){var a=new Fe(i),u=t(i.primaryKey,i.value,a);if(u instanceof Re){var o=u.catch((function(e){return a.done(),Re.reject(e)}));n.push(o)}a.isDone?r():null===a.K?i.continue():i.continue(a.K)}else r()}})).next((function(){return Re.waitFor(n)}))}},{key:"options",value:function(e,t){var n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}},{key:"cursor",value:function(e){var t="next";if(e.reverse&&(t="prev"),e.index){var n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}]),e}();function Ue(e){return new Re((function(t,n){e.onsuccess=function(e){var n=e.target.result;t(n)},e.onerror=function(e){var t=ze(e.target.error);n(t)}}))}var Be=!1;function ze(e){var t=Oe.S((0,b.z$)());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new W("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(n,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return Be||(Be=!0,setTimeout((function(){throw r}),0)),r}}return e}var je=function(){function e(t,n){(0,y.Z)(this,e),this.asyncQueue=t,this.Z=n,this.task=null}return(0,m.Z)(e,[{key:"start",value:function(){this.X(15e3)}},{key:"stop",value:function(){this.task&&(this.task.cancel(),this.task=null)}},{key:"started",get:function(){return null!==this.task}},{key:"X",value:function(e){var t=this;q("IndexBackfiller","Scheduled in ".concat(e,"ms")),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,f.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.task=null,e.prev=1,e.t0=q,e.t1="Documents written: ",e.next=6,t.Z.ee();case 6:e.t2=e.sent,e.t3=e.t1.concat.call(e.t1,e.t2),(0,e.t0)("IndexBackfiller",e.t3),e.next=19;break;case 11:if(e.prev=11,e.t4=e.catch(1),!Ve(e.t4)){e.next=17;break}q("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e.t4),e.next=19;break;case 17:return e.next=19,De(e.t4);case 19:return e.next=21,t.X(6e4);case 21:case"end":return e.stop()}}),e,null,[[1,11]])}))))}}]),e}(),Ge=function(){function e(t,n){(0,y.Z)(this,e),this.localStore=t,this.persistence=n}return(0,m.Z)(e,[{key:"ee",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){var t,n=this,r=arguments;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:50,e.abrupt("return",this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(function(e){return n.te(e,t)})));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"te",value:function(e,t){var n=this,r=new Set,i=t,a=!0;return Re.doWhile((function(){return!0===a&&i>0}),(function(){return n.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((function(t){if(null!==t&&!r.has(t))return q("IndexBackfiller","Processing collection: ".concat(t)),n.ne(e,t,i).next((function(e){i-=e,r.add(t)}));a=!1}))})).next((function(){return t-i}))}},{key:"ne",value:function(e,t,n){var r=this;return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((function(i){return r.localStore.localDocuments.getNextDocuments(e,t,i,n).next((function(n){var a=n.changes;return r.localStore.indexManager.updateIndexEntries(e,a).next((function(){return r.re(i,n)})).next((function(n){return q("IndexBackfiller","Updating offset: ".concat(n)),r.localStore.indexManager.updateCollectionGroup(e,t,n)})).next((function(){return a.size}))}))}))}},{key:"re",value:function(e,t){var n=e;return t.changes.forEach((function(e,t){var r=Ze(t);Se(r,n)>0&&(n=r)})),new Ee(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}]),e}(),Ke=function(){function e(t,n){var r=this;(0,y.Z)(this,e),this.previousValue=t,n&&(n.sequenceNumberHandler=function(e){return r.ie(e)},this.se=function(e){return n.writeSequenceNumber(e)})}return(0,m.Z)(e,[{key:"ie",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function(){var e=++this.previousValue;return this.se&&this.se(e),e}}]),e}();function Qe(e){return null==e}function He(e){return 0===e&&1/e==-1/0}function We(e){return"number"==typeof e&&Number.isInteger(e)&&!He(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function Je(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=Xe(t)),t=Ye(e.get(n),t);return Xe(t)}function Ye(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var a=e.charAt(i);switch(a){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=a}}return n}function Xe(e){return e+"\x01\x01"}function $e(e){var t=e.length;if(G(t>=2),2===t)return G("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),ve.emptyPath();for(var n=t-2,r=[],i="",a=0;a<t;){var u=e.indexOf("\x01",a);switch((u<0||u>n)&&j(),e.charAt(u+1)){case"\x01":var o=e.substring(a,u),s=void 0;0===i.length?s=o:(s=i+=o,i=""),r.push(s);break;case"\x10":i+=e.substring(a,u),i+="\0";break;case"\x11":i+=e.substring(a,u+1);break;default:j()}a=u+2}return new ve(r)}Ke.oe=-1;var et=["userId","batchId"];function tt(e,t){return[e,Je(t)]}function nt(e,t,n){return[e,Je(t),n]}var rt={},it=["prefixPath","collectionGroup","readTime","documentId"],at=["prefixPath","collectionGroup","documentId"],ut=["collectionGroup","readTime","prefixPath","documentId"],ot=["canonicalId","targetId"],st=["targetId","path"],ct=["path","targetId"],lt=["collectionId","parent"],ht=["indexId","uid"],ft=["uid","sequenceNumber"],dt=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],vt=["indexId","uid","orderedDocumentKey"],pt=["userId","collectionPath","documentId"],yt=["userId","collectionPath","largestBatchId"],mt=["userId","collectionGroup","largestBatchId"],gt=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments"].concat(["clientMetadata"]).concat(["remoteDocumentGlobal"]).concat(["collectionParents"]).concat(["bundles","namedQueries"]),kt=[].concat((0,p.Z)(gt),["documentOverlays"]),wt=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],bt=wt,xt=[].concat(bt,["indexConfiguration","indexState","indexEntries"]),It=xt,_t=[].concat((0,p.Z)(xt),["globals"]),Tt=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this))._e=e,i.currentSequenceNumber=r,i}return(0,m.Z)(n)}(Ae);function Zt(e,t){var n=Q(e);return Oe.F(n._e,t)}function Et(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function St(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Ct(e,t){var n=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(t(e[r],r,e));return n}function At(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var Dt=function(){function e(t,n){(0,y.Z)(this,e),this.comparator=t,this.root=n||Rt.EMPTY}return(0,m.Z)(e,[{key:"insert",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,Rt.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Rt.BLACK,null,null))}},{key:"get",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal((function(t,n){return e(t,n),!1}))}},{key:"toString",value:function(){var e=[];return this.inorderTraversal((function(t,n){return e.push("".concat(t,":").concat(n)),!1})),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new Nt(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new Nt(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new Nt(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new Nt(this.root,e,this.comparator,!0)}}]),e}(),Nt=function(){function e(t,n,r,i){(0,y.Z)(this,e),this.isReverse=i,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=n?r(t.key,n):1,n&&i&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return(0,m.Z)(e,[{key:"getNext",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),Rt=function(){function e(t,n,r,i,a){(0,y.Z)(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return(0,m.Z)(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed())throw j();if(this.right.isRed())throw j();var e=this.left.check();if(e!==this.right.check())throw j();return e+(this.isRed()?0:1)}}]),e}();Rt.EMPTY=null,Rt.RED=!0,Rt.BLACK=!1,Rt.EMPTY=new(function(){function e(){(0,y.Z)(this,e),this.size=0}return(0,m.Z)(e,[{key:"key",get:function(){throw j()}},{key:"value",get:function(){throw j()}},{key:"color",get:function(){throw j()}},{key:"left",get:function(){throw j()}},{key:"right",get:function(){throw j()}},{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new Rt(e,t)}},{key:"remove",value:function(e,t){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}]),e}());var Mt=function(){function e(t){(0,y.Z)(this,e),this.comparator=t,this.data=new Dt(this.comparator)}return(0,m.Z)(e,[{key:"has",value:function(e){return null!==this.data.get(e)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"forEachInRange",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:"forEachWhile",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function(){return new Ot(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new Ot(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach((function(e){t=t.add(e)})),t}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(0!==this.comparator(i,a))return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){e.push(t)})),e}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){return e.push(t)})),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),Ot=function(){function e(t){(0,y.Z)(this,e),this.iter=t}return(0,m.Z)(e,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),e}();function Pt(e){return e.hasNext()?e.getNext():void 0}var Ft=function(){function e(t){(0,y.Z)(this,e),this.fields=t,t.sort(ye.comparator)}return(0,m.Z)(e,[{key:"unionWith",value:function(t){var n,r=new Mt(ye.comparator),i=(0,l.Z)(this.fields);try{for(i.s();!(n=i.n()).done;){var a=n.value;r=r.add(a)}}catch(c){i.e(c)}finally{i.f()}var u,o=(0,l.Z)(t);try{for(o.s();!(u=o.n()).done;){var s=u.value;r=r.add(s)}}catch(c){o.e(c)}finally{o.f()}return new e(r.toArray())}},{key:"covers",value:function(e){var t,n=(0,l.Z)(this.fields);try{for(n.s();!(t=n.n()).done;){if(t.value.isPrefixOf(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"isEqual",value:function(e){return ce(this.fields,e.fields,(function(e,t){return e.isEqual(t)}))}}],[{key:"empty",value:function(){return new e([])}}]),e}(),Lt=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(){var e;return(0,y.Z)(this,n),(e=t.apply(this,arguments)).name="Base64DecodeError",e}return(0,m.Z)(n)}((0,c.Z)(Error));function Vt(){return"undefined"!=typeof atob}var qt=function(e){function t(e){(0,y.Z)(this,t),this.binaryString=e}return(0,m.Z)(t,[{key:e,value:function(){var e=this,t=0;return{next:function(){return t<e.binaryString.length?{value:e.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}}},{key:"toBase64",value:function(){return e=this.binaryString,btoa(e);var e}},{key:"toUint8Array",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return se(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(e){var n=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Lt("Invalid base64 string: "+e):e}}(e);return new t(n)}},{key:"fromUint8Array",value:function(e){var n=function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new t(n)}}]),t}(Symbol.iterator);qt.EMPTY_BYTE_STRING=new qt("");var Ut=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Bt(e){if(G(!!e),"string"==typeof e){var t=0,n=Ut.exec(e);if(G(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:zt(e.seconds),nanos:zt(e.nanos)}}function zt(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function jt(e){return"string"==typeof e?qt.fromBase64String(e):qt.fromUint8Array(e)}function Gt(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Kt(e){var t=e.mapValue.fields.__previous_value__;return Gt(t)?Kt(t):t}function Qt(e){var t=Bt(e.mapValue.fields.__local_write_time__.timestampValue);return new he(t.seconds,t.nanos)}var Ht=(0,m.Z)((function e(t,n,r,i,a,u,o,s,c){(0,y.Z)(this,e),this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=u,this.autoDetectLongPolling=o,this.longPollingOptions=s,this.useFetchStreams=c})),Wt=function(){function e(t,n){(0,y.Z)(this,e),this.projectId=t,this.database=n||"(default)"}return(0,m.Z)(e,[{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}},{key:"isEqual",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}],[{key:"empty",value:function(){return new e("","")}}]),e}(),Jt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Yt={nullValue:"NULL_VALUE"};function Xt(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Gt(e)?4:yn(e)?9007199254740991:vn(e)?10:11:j()}function $t(e,t){if(e===t)return!0;var n=Xt(e);if(n!==Xt(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Qt(e).isEqual(Qt(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=Bt(e.timestampValue),r=Bt(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return jt(e.bytesValue).isEqual(jt(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return zt(e.geoPointValue.latitude)===zt(t.geoPointValue.latitude)&&zt(e.geoPointValue.longitude)===zt(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return zt(e.integerValue)===zt(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=zt(e.doubleValue),r=zt(t.doubleValue);return n===r?He(n)===He(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return ce(e.arrayValue.values||[],t.arrayValue.values||[],$t);case 10:case 11:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Et(n)!==Et(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!$t(n[i],r[i])))return!1;return!0}(e,t);default:return j()}}function en(e,t){return void 0!==(e.values||[]).find((function(e){return $t(e,t)}))}function tn(e,t){if(e===t)return 0;var n=Xt(e),r=Xt(t);if(n!==r)return se(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return se(e.booleanValue,t.booleanValue);case 2:return function(e,t){var n=zt(e.integerValue||e.doubleValue),r=zt(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return nn(e.timestampValue,t.timestampValue);case 4:return nn(Qt(e),Qt(t));case 5:return se(e.stringValue,t.stringValue);case 6:return function(e,t){var n=jt(e),r=jt(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var a=se(n[i],r[i]);if(0!==a)return a}return se(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=se(zt(e.latitude),zt(t.latitude));return 0!==n?n:se(zt(e.longitude),zt(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return rn(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,a,u=e.fields||{},o=t.fields||{},s=null===(n=u.value)||void 0===n?void 0:n.arrayValue,c=null===(r=o.value)||void 0===r?void 0:r.arrayValue,l=se((null===(i=null==s?void 0:s.values)||void 0===i?void 0:i.length)||0,(null===(a=null==c?void 0:c.values)||void 0===a?void 0:a.length)||0);return 0!==l?l:rn(s,c)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Jt.mapValue&&t===Jt.mapValue)return 0;if(e===Jt.mapValue)return 1;if(t===Jt.mapValue)return-1;var n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(var u=0;u<r.length&&u<a.length;++u){var o=se(r[u],a[u]);if(0!==o)return o;var s=tn(n[r[u]],i[a[u]]);if(0!==s)return s}return se(r.length,a.length)}(e.mapValue,t.mapValue);default:throw j()}}function nn(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return se(e,t);var n=Bt(e),r=Bt(t),i=se(n.seconds,r.seconds);return 0!==i?i:se(n.nanos,r.nanos)}function rn(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var a=tn(n[i],r[i]);if(a)return a}return se(n.length,r.length)}function an(e){return un(e)}function un(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){var t=Bt(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return jt(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return me.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){var t,n="[",r=!0,i=(0,l.Z)(e.values||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+=un(a)}}catch(u){i.e(u)}finally{i.f()}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){var t,n=Object.keys(e.fields||{}).sort(),r="{",i=!0,a=(0,l.Z)(n);try{for(a.s();!(t=a.n()).done;){var u=t.value;i?i=!1:r+=",",r+="".concat(u,":").concat(un(e.fields[u]))}}catch(o){a.e(o)}finally{a.f()}return r+"}"}(e.mapValue):j()}function on(e){switch(Xt(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:var t=Kt(e);return t?16+on(t):16;case 5:return 2*e.stringValue.length;case 6:return jt(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce((function(e,t){return e+on(t)}),0)}(e.arrayValue);case 10:case 11:return function(e){var t=0;return St(e.fields,(function(e,n){t+=e.length+on(n)})),t}(e.mapValue);default:throw j()}}function sn(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function cn(e){return!!e&&"integerValue"in e}function ln(e){return!!e&&"arrayValue"in e}function hn(e){return!!e&&"nullValue"in e}function fn(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function dn(e){return!!e&&"mapValue"in e}function vn(e){var t,n;return"__vector__"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function pn(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return St(e.mapValue.fields,(function(e,n){return t.mapValue.fields[e]=pn(n)})),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=pn(e.arrayValue.values[r]);return n}return Object.assign({},e)}function yn(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}var mn={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function gn(e){return"nullValue"in e?Yt:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?sn(Wt.empty(),me.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?vn(e)?mn:{mapValue:{}}:j()}function kn(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?sn(Wt.empty(),me.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?mn:"mapValue"in e?vn(e)?{mapValue:{}}:Jt:j()}function wn(e,t){var n=tn(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function bn(e,t){var n=tn(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}var xn=function(){function e(t){(0,y.Z)(this,e),this.value=t}return(0,m.Z)(e,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!dn(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=pn(t)}},{key:"setAll",value:function(e){var t=this,n=ye.emptyPath(),r={},i=[];e.forEach((function(e,a){if(!n.isImmediateParentOf(a)){var u=t.getFieldsMap(n);t.applyChanges(u,r,i),r={},i=[],n=a.popLast()}e?r[a.lastSegment()]=pn(e):i.push(a.lastSegment())}));var a=this.getFieldsMap(n);this.applyChanges(a,r,i)}},{key:"delete",value:function(e){var t=this.field(e.popLast());dn(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return $t(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];dn(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:"applyChanges",value:function(e,t,n){St(t,(function(t,n){return e[t]=n}));var r,i=(0,l.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete e[a]}}catch(u){i.e(u)}finally{i.f()}}},{key:"clone",value:function(){return new e(pn(this.value))}}],[{key:"empty",value:function(){return new e({mapValue:{}})}}]),e}();function In(e){var t=[];return St(e.fields,(function(e,n){var r=new ye([e]);if(dn(n)){var i=In(n.mapValue).fields;if(0===i.length)t.push(r);else{var a,u=(0,l.Z)(i);try{for(u.s();!(a=u.n()).done;){var o=a.value;t.push(r.child(o))}}catch(s){u.e(s)}finally{u.f()}}}else t.push(r)})),new Ft(t)}var _n=function(){function e(t,n,r,i,a,u,o){(0,y.Z)(this,e),this.key=t,this.documentType=n,this.version=r,this.readTime=i,this.createTime=a,this.data=u,this.documentState=o}return(0,m.Z)(e,[{key:"convertToFoundDocument",value:function(e,t){return!this.createTime.isEqual(fe.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=xn.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=xn.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this.version=fe.min(),this}},{key:"setReadTime",value:function(e){return this.readTime=e,this}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:"mutableCopy",value:function(){return new e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(t){return new e(t,0,fe.min(),fe.min(),fe.min(),xn.empty(),0)}},{key:"newFoundDocument",value:function(t,n,r,i){return new e(t,1,n,fe.min(),r,i,0)}},{key:"newNoDocument",value:function(t,n){return new e(t,2,n,fe.min(),fe.min(),xn.empty(),0)}},{key:"newUnknownDocument",value:function(t,n){return new e(t,3,n,fe.min(),fe.min(),xn.empty(),2)}}]),e}(),Tn=(0,m.Z)((function e(t,n){(0,y.Z)(this,e),this.position=t,this.inclusive=n}));function Zn(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var a=t[i],u=e.position[i];if(r=a.field.isKeyField()?me.comparator(me.fromName(u.referenceValue),n.key):tn(u,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return r}function En(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!$t(e.position[n],t.position[n]))return!1;return!0}var Sn=(0,m.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";(0,y.Z)(this,e),this.field=t,this.dir=n}));function Cn(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}var An=(0,m.Z)((function e(){(0,y.Z)(this,e)})),Dn=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i){var a;return(0,y.Z)(this,n),(a=t.call(this)).field=e,a.op=r,a.value=i,a}return(0,m.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(tn(t,this.value)):null!==t&&Xt(this.value)===Xt(t)&&this.matchesComparison(tn(t,this.value))}},{key:"matchesComparison",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return j()}}},{key:"isInequality",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}},{key:"getFlattenedFilters",value:function(){return[this]}},{key:"getFilters",value:function(){return[this]}}],[{key:"create",value:function(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new Un(e,t,r):"array-contains"===t?new Gn(e,r):"in"===t?new Kn(e,r):"not-in"===t?new Qn(e,r):"array-contains-any"===t?new Hn(e,r):new n(e,t,r)}},{key:"createKeyFieldInFilter",value:function(e,t,n){return"in"===t?new Bn(e,n):new zn(e,n)}}]),n}(An),Nn=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this)).filters=e,i.op=r,i.ae=null,i}return(0,m.Z)(n,[{key:"matches",value:function(e){return Rn(this)?void 0===this.filters.find((function(t){return!t.matches(e)})):void 0!==this.filters.find((function(t){return t.matches(e)}))}},{key:"getFlattenedFilters",value:function(){return null!==this.ae||(this.ae=this.filters.reduce((function(e,t){return e.concat(t.getFlattenedFilters())}),[])),this.ae}},{key:"getFilters",value:function(){return Object.assign([],this.filters)}}],[{key:"create",value:function(e,t){return new n(e,t)}}]),n}(An);function Rn(e){return"and"===e.op}function Mn(e){return"or"===e.op}function On(e){return Pn(e)&&Rn(e)}function Pn(e){var t,n=(0,l.Z)(e.filters);try{for(n.s();!(t=n.n()).done;){if(t.value instanceof Nn)return!1}}catch(r){n.e(r)}finally{n.f()}return!0}function Fn(e){if(e instanceof Dn)return e.field.canonicalString()+e.op.toString()+an(e.value);if(On(e))return e.filters.map((function(e){return Fn(e)})).join(",");var t=e.filters.map((function(e){return Fn(e)})).join(",");return"".concat(e.op,"(").concat(t,")")}function Ln(e,t){return e instanceof Dn?function(e,t){return t instanceof Dn&&e.op===t.op&&e.field.isEqual(t.field)&&$t(e.value,t.value)}(e,t):e instanceof Nn?function(e,t){return t instanceof Nn&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((function(e,n,r){return e&&Ln(n,t.filters[r])}),!0)}(e,t):void j()}function Vn(e,t){var n=e.filters.concat(t);return Nn.create(n,e.op)}function qn(e){return e instanceof Dn?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(an(e.value))}(e):e instanceof Nn?function(e){return e.op.toString()+" {"+e.getFilters().map(qn).join(" ,")+"}"}(e):"Filter"}var Un=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i){var a;return(0,y.Z)(this,n),(a=t.call(this,e,r,i)).key=me.fromName(i.referenceValue),a}return(0,m.Z)(n,[{key:"matches",value:function(e){var t=me.comparator(e.key,this.key);return this.matchesComparison(t)}}]),n}(Dn),Bn=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this,e,"in",r)).keys=jn("in",r),i}return(0,m.Z)(n,[{key:"matches",value:function(e){return this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(Dn),zn=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this,e,"not-in",r)).keys=jn("not-in",r),i}return(0,m.Z)(n,[{key:"matches",value:function(e){return!this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(Dn);function jn(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(e){return me.fromName(e.referenceValue)}))}var Gn=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){return(0,y.Z)(this,n),t.call(this,e,"array-contains",r)}return(0,m.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return ln(t)&&en(t.arrayValue,this.value)}}]),n}(Dn),Kn=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){return(0,y.Z)(this,n),t.call(this,e,"in",r)}return(0,m.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return null!==t&&en(this.value.arrayValue,t)}}]),n}(Dn),Qn=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){return(0,y.Z)(this,n),t.call(this,e,"not-in",r)}return(0,m.Z)(n,[{key:"matches",value:function(e){if(en(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!en(this.value.arrayValue,t)}}]),n}(Dn),Hn=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){return(0,y.Z)(this,n),t.call(this,e,"array-contains-any",r)}return(0,m.Z)(n,[{key:"matches",value:function(e){var t=this,n=e.data.field(this.field);return!(!ln(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(e){return en(t.value.arrayValue,e)}))}}]),n}(Dn),Wn=(0,m.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;(0,y.Z)(this,e),this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=u,this.endAt=o,this.ue=null}));function Jn(e){return new Wn(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function Yn(e){var t=Q(e);if(null===t.ue){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map((function(e){return Fn(e)})).join(","),n+="|ob:",n+=t.orderBy.map((function(e){return function(e){return e.field.canonicalString()+e.dir}(e)})).join(","),Qe(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((function(e){return an(e)})).join(",")),t.endAt&&(n+="|ub:",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((function(e){return an(e)})).join(",")),t.ue=n}return t.ue}function Xn(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!Cn(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(!Ln(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!En(e.startAt,t.startAt)&&En(e.endAt,t.endAt)}function $n(e){return me.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function er(e,t){return e.filters.filter((function(e){return e instanceof Dn&&e.field.isEqual(t)}))}function tr(e,t,n){var r,i=Yt,a=!0,u=(0,l.Z)(er(e,t));try{for(u.s();!(r=u.n()).done;){var o=r.value,s=Yt,c=!0;switch(o.op){case"<":case"<=":s=gn(o.value);break;case"==":case"in":case">=":s=o.value;break;case">":s=o.value,c=!1;break;case"!=":case"not-in":s=Yt}wn({value:i,inclusive:a},{value:s,inclusive:c})<0&&(i=s,a=c)}}catch(d){u.e(d)}finally{u.f()}if(null!==n)for(var h=0;h<e.orderBy.length;++h)if(e.orderBy[h].field.isEqual(t)){var f=n.position[h];wn({value:i,inclusive:a},{value:f,inclusive:n.inclusive})<0&&(i=f,a=n.inclusive);break}return{value:i,inclusive:a}}function nr(e,t,n){var r,i=Jt,a=!0,u=(0,l.Z)(er(e,t));try{for(u.s();!(r=u.n()).done;){var o=r.value,s=Jt,c=!0;switch(o.op){case">=":case">":s=kn(o.value),c=!1;break;case"==":case"in":case"<=":s=o.value;break;case"<":s=o.value,c=!1;break;case"!=":case"not-in":s=Jt}bn({value:i,inclusive:a},{value:s,inclusive:c})>0&&(i=s,a=c)}}catch(d){u.e(d)}finally{u.f()}if(null!==n)for(var h=0;h<e.orderBy.length;++h)if(e.orderBy[h].field.isEqual(t)){var f=n.position[h];bn({value:i,inclusive:a},{value:f,inclusive:n.inclusive})>0&&(i=f,a=n.inclusive);break}return{value:i,inclusive:a}}var rr=(0,m.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,y.Z)(this,e),this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=u,this.startAt=o,this.endAt=s,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}));function ir(e,t,n,r,i,a,u,o){return new rr(e,t,n,r,i,a,u,o)}function ar(e){return new rr(e)}function ur(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function or(e){return null!==e.collectionGroup}function sr(e){var t=Q(e);if(null===t.ce){t.ce=[];var n,r=new Set,i=(0,l.Z)(t.explicitOrderBy);try{for(i.s();!(n=i.n()).done;){var a=n.value;t.ce.push(a),r.add(a.field.canonicalString())}}catch(s){i.e(s)}finally{i.f()}var u=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",o=function(e){var t=new Mt(ye.comparator);return e.filters.forEach((function(e){e.getFlattenedFilters().forEach((function(e){e.isInequality()&&(t=t.add(e.field))}))})),t}(t);o.forEach((function(e){r.has(e.canonicalString())||e.isKeyField()||t.ce.push(new Sn(e,u))})),r.has(ye.keyField().canonicalString())||t.ce.push(new Sn(ye.keyField(),u))}return t.ce}function cr(e){var t=Q(e);return t.le||(t.le=hr(t,sr(e))),t.le}function lr(e){var t=Q(e);return t.he||(t.he=hr(t,e.explicitOrderBy)),t.he}function hr(e,t){if("F"===e.limitType)return Jn(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);t=t.map((function(e){var t="desc"===e.dir?"asc":"desc";return new Sn(e.field,t)}));var n=e.endAt?new Tn(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Tn(e.startAt.position,e.startAt.inclusive):null;return Jn(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}function fr(e,t){var n=e.filters.concat([t]);return new rr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function dr(e,t,n){return new rr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function vr(e,t){return Xn(cr(e),cr(t))&&e.limitType===t.limitType}function pr(e){return"".concat(Yn(cr(e)),"|lt:").concat(e.limitType)}function yr(e){return"Query(target=".concat(function(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map((function(e){return qn(e)})).join(", "),"]")),Qe(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map((function(e){return function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)})).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((function(e){return an(e)})).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((function(e){return an(e)})).join(",")),"Target(".concat(t,")")}(cr(e)),"; limitType=").concat(e.limitType,")")}function mr(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):me.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){var n,r=(0,l.Z)(sr(e));try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=(0,l.Z)(e.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(t))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){var r=Zn(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,sr(e),t))&&!(e.endAt&&!function(e,t,n){var r=Zn(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,sr(e),t))}(e,t)}function gr(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function kr(e){return function(t,n){var r,i=!1,a=(0,l.Z)(sr(e));try{for(a.s();!(r=a.n()).done;){var u=r.value,o=wr(u,t,n);if(0!==o)return o;i=i||u.field.isKeyField()}}catch(s){a.e(s)}finally{a.f()}return 0}}function wr(e,t,n){var r=e.field.isKeyField()?me.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?tn(r,i):j()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return j()}}var br=function(){function e(t,n){(0,y.Z)(this,e),this.mapKeyFn=t,this.equalsFn=n,this.inner={},this.innerSize=0}return(0,m.Z)(e,[{key:"get",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,i=(0,l.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=(0,s.Z)(r.value,2),u=a[0],o=a[1];if(this.equalsFn(u,e))return o}}catch(c){i.e(c)}finally{i.f()}}}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"set",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}},{key:"delete",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}},{key:"forEach",value:function(e){St(this.inner,(function(t,n){var r,i=(0,l.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=(0,s.Z)(r.value,2),u=a[0],o=a[1];e(u,o)}}catch(c){i.e(c)}finally{i.f()}}))}},{key:"isEmpty",value:function(){return At(this.inner)}},{key:"size",value:function(){return this.innerSize}}]),e}(),xr=new Dt(me.comparator);function Ir(){return xr}var _r=new Dt(me.comparator);function Tr(){for(var e=_r,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var u=a[i];e=e.insert(u.key,u)}return e}function Zr(e){var t=_r;return e.forEach((function(e,n){return t=t.insert(e,n.overlayedDocument)})),t}function Er(){return Cr()}function Sr(){return Cr()}function Cr(){return new br((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)}))}var Ar=new Dt(me.comparator),Dr=new Mt(me.comparator);function Nr(){for(var e=Dr,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var u=a[i];e=e.add(u)}return e}var Rr=new Mt(se);function Mr(){return Rr}function Or(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:He(t)?"-0":t}}function Pr(e){return{integerValue:""+e}}function Fr(e,t){return We(t)?Pr(t):Or(e,t)}var Lr=(0,m.Z)((function e(){(0,y.Z)(this,e),this._=void 0}));function Vr(e,t,n){return e instanceof Br?function(e,t){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Gt(t)&&(t=Kt(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof zr?jr(e,t):e instanceof Gr?Kr(e,t):function(e,t){var n=Ur(e,t),r=Hr(n)+Hr(e.Pe);return cn(n)&&cn(e.Pe)?Pr(r):Or(e.serializer,r)}(e,t)}function qr(e,t,n){return e instanceof zr?jr(e,t):e instanceof Gr?Kr(e,t):n}function Ur(e,t){return e instanceof Qr?function(e){return cn(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}var Br=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n)}(Lr),zr=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,m.Z)(n)}(Lr);function jr(e,t){var n,r=Wr(t),i=(0,l.Z)(e.elements);try{var a=function(){var e=n.value;r.some((function(t){return $t(t,e)}))||r.push(e)};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return{arrayValue:{values:r}}}var Gr=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,m.Z)(n)}(Lr);function Kr(e,t){var n,r=Wr(t),i=(0,l.Z)(e.elements);try{var a=function(){var e=n.value;r=r.filter((function(t){return!$t(t,e)}))};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return{arrayValue:{values:r}}}var Qr=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this)).serializer=e,i.Pe=r,i}return(0,m.Z)(n)}(Lr);function Hr(e){return zt(e.integerValue||e.doubleValue)}function Wr(e){return ln(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var Jr=(0,m.Z)((function e(t,n){(0,y.Z)(this,e),this.field=t,this.transform=n}));var Yr=(0,m.Z)((function e(t,n){(0,y.Z)(this,e),this.version=t,this.transformResults=n})),Xr=function(){function e(t,n){(0,y.Z)(this,e),this.updateTime=t,this.exists=n}return(0,m.Z)(e,[{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new e}},{key:"exists",value:function(t){return new e(void 0,t)}},{key:"updateTime",value:function(t){return new e(t)}}]),e}();function $r(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var ei=(0,m.Z)((function e(){(0,y.Z)(this,e)}));function ti(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new di(e.key,Xr.none()):new ui(e.key,e.data,Xr.none());var n,r=e.data,i=xn.empty(),a=new Mt(ye.comparator),u=(0,l.Z)(t.fields);try{for(u.s();!(n=u.n()).done;){var o=n.value;if(!a.has(o)){var s=r.field(o);null===s&&o.length>1&&(o=o.popLast(),s=r.field(o)),null===s?i.delete(o):i.set(o,s),a=a.add(o)}}}catch(c){u.e(c)}finally{u.f()}return new oi(e.key,i,new Ft(a.toArray()),Xr.none())}function ni(e,t,n){e instanceof ui?function(e,t,n){var r=e.value.clone(),i=ci(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof oi?function(e,t,n){if($r(e.precondition,t)){var r=ci(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(si(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function ri(e,t,n,r){return e instanceof ui?function(e,t,n,r){if(!$r(e.precondition,t))return n;var i=e.value.clone(),a=li(e.fieldTransforms,r,t);return i.setAll(a),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof oi?function(e,t,n,r){if(!$r(e.precondition,t))return n;var i=li(e.fieldTransforms,r,t),a=t.data;return a.setAll(si(e)),a.setAll(i),t.convertToFoundDocument(t.version,a).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((function(e){return e.field})))}(e,t,n,r):function(e,t,n){return $r(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function ii(e,t){var n,r=null,i=(0,l.Z)(e.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var a=n.value,u=t.data.field(a.field),o=Ur(a.transform,u||null);null!=o&&(null===r&&(r=xn.empty()),r.set(a.field,o))}}catch(s){i.e(s)}finally{i.f()}return r||null}function ai(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&ce(e,t,(function(e,t){return function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof zr&&t instanceof zr||e instanceof Gr&&t instanceof Gr?ce(e.elements,t.elements,$t):e instanceof Qr&&t instanceof Qr?$t(e.Pe,t.Pe):e instanceof Br&&t instanceof Br}(e.transform,t.transform)}(e,t)}))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}var ui=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i){var a,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return(0,y.Z)(this,n),(a=t.call(this)).key=e,a.value=r,a.precondition=i,a.fieldTransforms=u,a.type=0,a}return(0,m.Z)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(ei),oi=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i,a){var u,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return(0,y.Z)(this,n),(u=t.call(this)).key=e,u.data=r,u.fieldMask=i,u.precondition=a,u.fieldTransforms=o,u.type=1,u}return(0,m.Z)(n,[{key:"getFieldMask",value:function(){return this.fieldMask}}]),n}(ei);function si(e){var t=new Map;return e.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}})),t}function ci(e,t,n){var r=new Map;G(e.length===n.length);for(var i=0;i<n.length;i++){var a=e[i],u=a.transform,o=t.data.field(a.field);r.set(a.field,qr(u,o,n[i]))}return r}function li(e,t,n){var r,i=new Map,a=(0,l.Z)(e);try{for(a.s();!(r=a.n()).done;){var u=r.value,o=u.transform,s=n.data.field(u.field);i.set(u.field,Vr(o,s,t))}}catch(c){a.e(c)}finally{a.f()}return i}var hi,fi,di=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return(0,m.Z)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(ei),vi=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return(0,m.Z)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(ei),pi=function(){function e(t,n,r,i){(0,y.Z)(this,e),this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return(0,m.Z)(e,[{key:"applyToRemoteDocument",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&ni(i,e,n[r])}}},{key:"applyToLocalView",value:function(e,t){var n,r=(0,l.Z)(this.baseMutations);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.key.isEqual(e.key)&&(t=ri(i,e,t,this.localWriteTime))}}catch(s){r.e(s)}finally{r.f()}var a,u=(0,l.Z)(this.mutations);try{for(u.s();!(a=u.n()).done;){var o=a.value;o.key.isEqual(e.key)&&(t=ri(o,e,t,this.localWriteTime))}}catch(s){u.e(s)}finally{u.f()}return t}},{key:"applyToLocalDocumentSet",value:function(e,t){var n=this,r=Sr();return this.mutations.forEach((function(i){var a=e.get(i.key),u=a.overlayedDocument,o=n.applyToLocalView(u,a.mutatedFields),s=ti(u,o=t.has(i.key)?null:o);null!==s&&r.set(i.key,s),u.isValidDocument()||u.convertToNoDocument(fe.min())})),r}},{key:"keys",value:function(){return this.mutations.reduce((function(e,t){return e.add(t.key)}),Nr())}},{key:"isEqual",value:function(e){return this.batchId===e.batchId&&ce(this.mutations,e.mutations,(function(e,t){return ai(e,t)}))&&ce(this.baseMutations,e.baseMutations,(function(e,t){return ai(e,t)}))}}]),e}(),yi=function(){function e(t,n,r,i){(0,y.Z)(this,e),this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return(0,m.Z)(e,null,[{key:"from",value:function(t,n,r){G(t.mutations.length===r.length);for(var i=Ar,a=t.mutations,u=0;u<a.length;u++)i=i.insert(a[u].key,r[u].version);return new e(t,n,r,i)}}]),e}(),mi=function(){function e(t,n){(0,y.Z)(this,e),this.largestBatchId=t,this.mutation=n}return(0,m.Z)(e,[{key:"getKey",value:function(){return this.mutation.key}},{key:"isEqual",value:function(e){return null!==e&&this.mutation===e.mutation}},{key:"toString",value:function(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}]),e}(),gi=(0,m.Z)((function e(t,n,r){(0,y.Z)(this,e),this.alias=t,this.aggregateType=n,this.fieldPath=r})),ki=(0,m.Z)((function e(t,n){(0,y.Z)(this,e),this.count=t,this.unchangedNames=n}));function wi(e){switch(e){default:return j();case H.CANCELLED:case H.UNKNOWN:case H.DEADLINE_EXCEEDED:case H.RESOURCE_EXHAUSTED:case H.INTERNAL:case H.UNAVAILABLE:case H.UNAUTHENTICATED:return!1;case H.INVALID_ARGUMENT:case H.NOT_FOUND:case H.ALREADY_EXISTS:case H.PERMISSION_DENIED:case H.FAILED_PRECONDITION:case H.ABORTED:case H.OUT_OF_RANGE:case H.UNIMPLEMENTED:case H.DATA_LOSS:return!0}}function bi(e){if(void 0===e)return U("GRPC error has no .code"),H.UNKNOWN;switch(e){case hi.OK:return H.OK;case hi.CANCELLED:return H.CANCELLED;case hi.UNKNOWN:return H.UNKNOWN;case hi.DEADLINE_EXCEEDED:return H.DEADLINE_EXCEEDED;case hi.RESOURCE_EXHAUSTED:return H.RESOURCE_EXHAUSTED;case hi.INTERNAL:return H.INTERNAL;case hi.UNAVAILABLE:return H.UNAVAILABLE;case hi.UNAUTHENTICATED:return H.UNAUTHENTICATED;case hi.INVALID_ARGUMENT:return H.INVALID_ARGUMENT;case hi.NOT_FOUND:return H.NOT_FOUND;case hi.ALREADY_EXISTS:return H.ALREADY_EXISTS;case hi.PERMISSION_DENIED:return H.PERMISSION_DENIED;case hi.FAILED_PRECONDITION:return H.FAILED_PRECONDITION;case hi.ABORTED:return H.ABORTED;case hi.OUT_OF_RANGE:return H.OUT_OF_RANGE;case hi.UNIMPLEMENTED:return H.UNIMPLEMENTED;case hi.DATA_LOSS:return H.DATA_LOSS;default:return j()}}(fi=hi||(hi={}))[fi.OK=0]="OK",fi[fi.CANCELLED=1]="CANCELLED",fi[fi.UNKNOWN=2]="UNKNOWN",fi[fi.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",fi[fi.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",fi[fi.NOT_FOUND=5]="NOT_FOUND",fi[fi.ALREADY_EXISTS=6]="ALREADY_EXISTS",fi[fi.PERMISSION_DENIED=7]="PERMISSION_DENIED",fi[fi.UNAUTHENTICATED=16]="UNAUTHENTICATED",fi[fi.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",fi[fi.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",fi[fi.ABORTED=10]="ABORTED",fi[fi.OUT_OF_RANGE=11]="OUT_OF_RANGE",fi[fi.UNIMPLEMENTED=12]="UNIMPLEMENTED",fi[fi.INTERNAL=13]="INTERNAL",fi[fi.UNAVAILABLE=14]="UNAVAILABLE",fi[fi.DATA_LOSS=15]="DATA_LOSS";var xi=null;function Ii(){return new TextEncoder}var _i=new r([4294967295,4294967295],0);function Ti(e){var t=Ii().encode(e),n=new i;return n.update(t),new Uint8Array(n.digest())}function Zi(e){var t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),a=t.getUint32(8,!0),u=t.getUint32(12,!0);return[new r([n,i],0),new r([a,u],0)]}var Ei=function(){function e(t,n,i){if((0,y.Z)(this,e),this.bitmap=t,this.padding=n,this.hashCount=i,n<0||n>=8)throw new Si("Invalid padding: ".concat(n));if(i<0)throw new Si("Invalid hash count: ".concat(i));if(t.length>0&&0===this.hashCount)throw new Si("Invalid hash count: ".concat(i));if(0===t.length&&0!==n)throw new Si("Invalid padding when bitmap length is 0: ".concat(n));this.Ie=8*t.length-n,this.Te=r.fromNumber(this.Ie)}return(0,m.Z)(e,[{key:"Ee",value:function(e,t,n){var i=e.add(t.multiply(r.fromNumber(n)));return 1===i.compare(_i)&&(i=new r([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}},{key:"de",value:function(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}},{key:"mightContain",value:function(e){if(0===this.Ie)return!1;for(var t=Zi(Ti(e)),n=(0,s.Z)(t,2),r=n[0],i=n[1],a=0;a<this.hashCount;a++){var u=this.Ee(r,i,a);if(!this.de(u))return!1}return!0}},{key:"insert",value:function(e){if(0!==this.Ie)for(var t=Zi(Ti(e)),n=(0,s.Z)(t,2),r=n[0],i=n[1],a=0;a<this.hashCount;a++){var u=this.Ee(r,i,a);this.Ae(u)}}},{key:"Ae",value:function(e){var t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}],[{key:"create",value:function(t,n,r){var i=t%8==0?0:8-t%8,a=new e(new Uint8Array(Math.ceil(t/8)),i,n);return r.forEach((function(e){return a.insert(e)})),a}}]),e}(),Si=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(){var e;return(0,y.Z)(this,n),(e=t.apply(this,arguments)).name="BloomFilterError",e}return(0,m.Z)(n)}((0,c.Z)(Error)),Ci=function(){function e(t,n,r,i,a){(0,y.Z)(this,e),this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}return(0,m.Z)(e,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(t,n,r){var i=new Map;return i.set(t,Ai.createSynthesizedTargetChangeForCurrentChange(t,n,r)),new e(fe.min(),i,new Dt(se),Ir(),Nr())}}]),e}(),Ai=function(){function e(t,n,r,i,a){(0,y.Z)(this,e),this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}return(0,m.Z)(e,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(t,n,r){return new e(r,n,Nr(),Nr(),Nr())}}]),e}(),Di=(0,m.Z)((function e(t,n,r,i){(0,y.Z)(this,e),this.Re=t,this.removedTargetIds=n,this.key=r,this.Ve=i})),Ni=(0,m.Z)((function e(t,n){(0,y.Z)(this,e),this.targetId=t,this.me=n})),Ri=(0,m.Z)((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:qt.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,y.Z)(this,e),this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=i})),Mi=function(){function e(){(0,y.Z)(this,e),this.fe=0,this.ge=Fi(),this.pe=qt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}return(0,m.Z)(e,[{key:"current",get:function(){return this.ye}},{key:"resumeToken",get:function(){return this.pe}},{key:"Se",get:function(){return 0!==this.fe}},{key:"be",get:function(){return this.we}},{key:"De",value:function(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}},{key:"ve",value:function(){var e=Nr(),t=Nr(),n=Nr();return this.ge.forEach((function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:j()}})),new Ai(this.pe,this.ye,e,t,n)}},{key:"Ce",value:function(){this.we=!1,this.ge=Fi()}},{key:"Fe",value:function(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}},{key:"Me",value:function(e){this.we=!0,this.ge=this.ge.remove(e)}},{key:"xe",value:function(){this.fe+=1}},{key:"Oe",value:function(){this.fe-=1,G(this.fe>=0)}},{key:"Ne",value:function(){this.we=!0,this.ye=!0}}]),e}(),Oi=function(){function e(t){(0,y.Z)(this,e),this.Le=t,this.Be=new Map,this.ke=Ir(),this.qe=Pi(),this.Qe=new Dt(se)}return(0,m.Z)(e,[{key:"Ke",value:function(e){var t,n=(0,l.Z)(e.Re);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.Ve&&e.Ve.isFoundDocument()?this.$e(r,e.Ve):this.Ue(r,e.key,e.Ve)}}catch(o){n.e(o)}finally{n.f()}var i,a=(0,l.Z)(e.removedTargetIds);try{for(a.s();!(i=a.n()).done;){var u=i.value;this.Ue(u,e.key,e.Ve)}}catch(o){a.e(o)}finally{a.f()}}},{key:"We",value:function(e){var t=this;this.forEachTarget(e,(function(n){var r=t.Ge(n);switch(e.state){case 0:t.ze(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||t.removeTarget(n);break;case 3:t.ze(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:t.ze(n)&&(t.je(n),r.De(e.resumeToken));break;default:j()}}))}},{key:"forEachTarget",value:function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((function(e,r){n.ze(r)&&t(r)}))}},{key:"He",value:function(e){var t=e.targetId,n=e.me.count,r=this.Je(t);if(r){var i=r.target;if($n(i))if(0===n){var a=new me(i.path);this.Ue(t,a,_n.newNoDocument(a,fe.min()))}else G(1===n);else{var u=this.Ye(t);if(u!==n){var o=this.Ze(e),s=o?this.Xe(o,e,u):1;if(0!==s){this.je(t);var c=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}null==xi||xi.et(function(e,t,n,r,i){var a,u,o,s,c,l,h={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},f=t.unchangedNames;return f&&(h.bloomFilter={applied:0===i,hashCount:null!==(a=null==f?void 0:f.hashCount)&&void 0!==a?a:0,bitmapLength:null!==(s=null===(o=null===(u=null==f?void 0:f.bits)||void 0===u?void 0:u.bitmap)||void 0===o?void 0:o.length)&&void 0!==s?s:0,padding:null!==(l=null===(c=null==f?void 0:f.bits)||void 0===c?void 0:c.padding)&&void 0!==l?l:0,mightContain:function(e){var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),h}(u,e.me,this.Le.tt(),o,s))}}}}},{key:"Ze",value:function(e){var t=e.me.unchangedNames;if(!t||!t.bits)return null;var n,r,i=t.bits,a=i.bitmap,u=void 0===a?"":a,o=i.padding,s=void 0===o?0:o,c=t.hashCount,l=void 0===c?0:c;try{n=jt(u).toUint8Array()}catch(e){if(e instanceof Lt)return B("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new Ei(n,s,l)}catch(e){return B(e instanceof Si?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.Ie?null:r}},{key:"Xe",value:function(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}},{key:"nt",value:function(e,t){var n=this,r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach((function(r){var a=n.Le.tt(),u="projects/".concat(a.projectId,"/databases/").concat(a.database,"/documents/").concat(r.path.canonicalString());e.mightContain(u)||(n.Ue(t,r,null),i++)})),i}},{key:"rt",value:function(e){var t=this,n=new Map;this.Be.forEach((function(r,i){var a=t.Je(i);if(a){if(r.current&&$n(a.target)){var u=new me(a.target.path);null!==t.ke.get(u)||t.it(i,u)||t.Ue(i,u,_n.newNoDocument(u,e))}r.be&&(n.set(i,r.ve()),r.Ce())}}));var r=Nr();this.qe.forEach((function(e,n){var i=!0;n.forEachWhile((function(e){var n=t.Je(e);return!n||"TargetPurposeLimboResolution"===n.purpose||(i=!1,!1)})),i&&(r=r.add(e))})),this.ke.forEach((function(t,n){return n.setReadTime(e)}));var i=new Ci(e,n,this.Qe,this.ke,r);return this.ke=Ir(),this.qe=Pi(),this.Qe=new Dt(se),i}},{key:"$e",value:function(e,t){if(this.ze(e)){var n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}}},{key:"Ue",value:function(e,t,n){if(this.ze(e)){var r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}}},{key:"removeTarget",value:function(e){this.Be.delete(e)}},{key:"Ye",value:function(e){var t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:"xe",value:function(e){this.Ge(e).xe()}},{key:"Ge",value:function(e){var t=this.Be.get(e);return t||(t=new Mi,this.Be.set(e,t)),t}},{key:"st",value:function(e){var t=this.qe.get(e);return t||(t=new Mt(se),this.qe=this.qe.insert(e,t)),t}},{key:"ze",value:function(e){var t=null!==this.Je(e);return t||q("WatchChangeAggregator","Detected inactive target",e),t}},{key:"Je",value:function(e){var t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}},{key:"je",value:function(e){var t=this;this.Be.set(e,new Mi),this.Le.getRemoteKeysForTarget(e).forEach((function(n){t.Ue(e,n,null)}))}},{key:"it",value:function(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}]),e}();function Pi(){return new Dt(me.comparator)}function Fi(){return new Dt(me.comparator)}var Li={asc:"ASCENDING",desc:"DESCENDING"},Vi={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qi={and:"AND",or:"OR"},Ui=(0,m.Z)((function e(t,n){(0,y.Z)(this,e),this.databaseId=t,this.useProto3Json=n}));function Bi(e,t){return e.useProto3Json||Qe(t)?t:{value:t}}function zi(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function ji(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Gi(e,t){return zi(e,t.toTimestamp())}function Ki(e){return G(!!e),fe.fromTimestamp(function(e){var t=Bt(e);return new he(t.seconds,t.nanos)}(e))}function Qi(e,t){return Hi(e,t).canonicalString()}function Hi(e,t){var n=function(e){return new ve(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Wi(e){var t=ve.fromString(e);return G(ka(t)),t}function Ji(e,t){return Qi(e.databaseId,t.path)}function Yi(e,t){var n=Wi(t);if(n.get(1)!==e.databaseId.projectId)throw new W(H.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new W(H.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new me(ta(n))}function Xi(e,t){return Qi(e.databaseId,t)}function $i(e){var t=Wi(e);return 4===t.length?ve.emptyPath():ta(t)}function ea(e){return new ve(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ta(e){return G(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function na(e,t,n){return{name:Ji(e,t),fields:n.value.mapValue.fields}}function ra(e,t,n){var r=Yi(e,t.name),i=Ki(t.updateTime),a=t.createTime?Ki(t.createTime):fe.min(),u=new xn({mapValue:{fields:t.fields}}),o=_n.newFoundDocument(r,i,a,u);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function ia(e,t){return"found"in t?function(e,t){G(!!t.found),t.found.name,t.found.updateTime;var n=Yi(e,t.found.name),r=Ki(t.found.updateTime),i=t.found.createTime?Ki(t.found.createTime):fe.min(),a=new xn({mapValue:{fields:t.found.fields}});return _n.newFoundDocument(n,r,i,a)}(e,t):"missing"in t?function(e,t){G(!!t.missing),G(!!t.readTime);var n=Yi(e,t.missing),r=Ki(t.readTime);return _n.newNoDocument(n,r)}(e,t):j()}function aa(e,t){var n;if(t instanceof ui)n={update:na(e,t.key,t.value)};else if(t instanceof di)n={delete:Ji(e,t.key)};else if(t instanceof oi)n={update:na(e,t.key,t.data),updateMask:ga(t.fieldMask)};else{if(!(t instanceof vi))return j();n={verify:Ji(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((function(e){return function(e,t){var n=t.transform;if(n instanceof Br)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof zr)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Gr)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Qr)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw j()}(0,e)}))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Gi(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:j()}(e,t.precondition)),n}function ua(e,t){var n=t.currentDocument?function(e){return void 0!==e.updateTime?Xr.updateTime(Ki(e.updateTime)):void 0!==e.exists?Xr.exists(e.exists):Xr.none()}(t.currentDocument):Xr.none(),r=t.updateTransforms?t.updateTransforms.map((function(t){return function(e,t){var n=null;if("setToServerValue"in t)G("REQUEST_TIME"===t.setToServerValue),n=new Br;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new zr(r)}else if("removeAllFromArray"in t){var i=t.removeAllFromArray.values||[];n=new Gr(i)}else"increment"in t?n=new Qr(e,t.increment):j();var a=ye.fromServerFormat(t.fieldPath);return new Jr(a,n)}(e,t)})):[];if(t.update){t.update.name;var i=Yi(e,t.update.name),a=new xn({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=function(e){var t=e.fieldPaths||[];return new Ft(t.map((function(e){return ye.fromServerFormat(e)})))}(t.updateMask);return new oi(i,a,u,n,r)}return new ui(i,a,n,r)}if(t.delete){var o=Yi(e,t.delete);return new di(o,n)}if(t.verify){var s=Yi(e,t.verify);return new vi(s,n)}return j()}function oa(e,t){return{documents:[Xi(e,t.path)]}}function sa(e,t){var n,r={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(n=i,r.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n=i.popLast(),r.structuredQuery.from=[{collectionId:i.lastSegment()}]),r.parent=Xi(e,n);var a=function(e){if(0!==e.length)return ma(Nn.create(e,"and"))}(t.filters);a&&(r.structuredQuery.where=a);var u=function(e){if(0!==e.length)return e.map((function(e){return function(e){return{field:pa(e.field),direction:fa(e.dir)}}(e)}))}(t.orderBy);u&&(r.structuredQuery.orderBy=u);var o=Bi(e,t.limit);return null!==o&&(r.structuredQuery.limit=o),t.startAt&&(r.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(r.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{_t:r,parent:n}}function ca(e,t,n,r){var i=sa(e,t),a=i._t,u=i.parent,o={},s=[],c=0;return n.forEach((function(e){var t=r?e.alias:"aggregate_"+c++;o[t]=e.alias,"count"===e.aggregateType?s.push({alias:t,count:{}}):"avg"===e.aggregateType?s.push({alias:t,avg:{field:pa(e.fieldPath)}}):"sum"===e.aggregateType&&s.push({alias:t,sum:{field:pa(e.fieldPath)}})})),{request:{structuredAggregationQuery:{aggregations:s,structuredQuery:a.structuredQuery},parent:a.parent},ut:o,parent:u}}function la(e){var t=$i(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){G(1===r);var a=n.from[0];a.allDescendants?i=a.collectionId:t=t.child(a.collectionId)}var u=[];n.where&&(u=function(e){var t=ha(e);return t instanceof Nn&&On(t)?t.getFilters():[t]}(n.where));var o=[];n.orderBy&&(o=function(e){return e.map((function(e){return function(e){return new Sn(ya(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)}))}(n.orderBy));var s=null;n.limit&&(s=function(e){var t;return Qe(t="object"==typeof e?e.value:e)?null:t}(n.limit));var c=null;n.startAt&&(c=function(e){var t=!!e.before,n=e.values||[];return new Tn(n,t)}(n.startAt));var l=null;return n.endAt&&(l=function(e){var t=!e.before,n=e.values||[];return new Tn(n,t)}(n.endAt)),ir(t,i,o,u,s,"F",c,l)}function ha(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":var t=ya(e.unaryFilter.field);return Dn.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=ya(e.unaryFilter.field);return Dn.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ya(e.unaryFilter.field);return Dn.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ya(e.unaryFilter.field);return Dn.create(i,"!=",{nullValue:"NULL_VALUE"});default:return j()}}(e):void 0!==e.fieldFilter?function(e){return Dn.create(ya(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return j()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Nn.create(e.compositeFilter.filters.map((function(e){return ha(e)})),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return j()}}(e.compositeFilter.op))}(e):j()}function fa(e){return Li[e]}function da(e){return Vi[e]}function va(e){return qi[e]}function pa(e){return{fieldPath:e.canonicalString()}}function ya(e){return ye.fromServerFormat(e.fieldPath)}function ma(e){return e instanceof Dn?function(e){if("=="===e.op){if(fn(e.value))return{unaryFilter:{field:pa(e.field),op:"IS_NAN"}};if(hn(e.value))return{unaryFilter:{field:pa(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(fn(e.value))return{unaryFilter:{field:pa(e.field),op:"IS_NOT_NAN"}};if(hn(e.value))return{unaryFilter:{field:pa(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:pa(e.field),op:da(e.op),value:e.value}}}(e):e instanceof Nn?function(e){var t=e.getFilters().map((function(e){return ma(e)}));return 1===t.length?t[0]:{compositeFilter:{op:va(e.op),filters:t}}}(e):j()}function ga(e){var t=[];return e.fields.forEach((function(e){return t.push(e.canonicalString())})),{fieldPaths:t}}function ka(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}var wa=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:fe.min(),u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:fe.min(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:qt.EMPTY_BYTE_STRING,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,y.Z)(this,e),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=o,this.expectedCount=s}return(0,m.Z)(e,[{key:"withSequenceNumber",value:function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}},{key:"withResumeToken",value:function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t,null)}},{key:"withExpectedCount",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}},{key:"withLastLimboFreeSnapshotVersion",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}]),e}(),ba=(0,m.Z)((function e(t){(0,y.Z)(this,e),this.ct=t}));function xa(e,t){var n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Ia(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Ji(e,t.key),fields:t.data.value.mapValue.fields,updateTime:zi(e,t.version.toTimestamp()),createTime:zi(e,t.createTime.toTimestamp())}}(e.ct,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:_a(t.version)};else{if(!t.isUnknownDocument())return j();r.unknownDocument={path:n.path.toArray(),version:_a(t.version)}}return r}function Ia(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function _a(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Ta(e){var t=new he(e.seconds,e.nanoseconds);return fe.fromTimestamp(t)}function Za(e,t){for(var n=(t.baseMutations||[]).map((function(t){return ua(e.ct,t)})),r=0;r<t.mutations.length-1;++r){var i=t.mutations[r];if(r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform){var a=t.mutations[r+1];i.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var u=t.mutations.map((function(t){return ua(e.ct,t)})),o=he.fromMillis(t.localWriteTimeMs);return new pi(t.batchId,o,n,u)}function Ea(e){var t,n=Ta(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?Ta(e.lastLimboFreeSnapshotVersion):fe.min();return t=function(e){return void 0!==e.documents}(e.query)?function(e){return G(1===e.documents.length),cr(ar($i(e.documents[0])))}(e.query):function(e){return cr(la(e))}(e.query),new wa(t,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,r,qt.fromBase64String(e.resumeToken))}function Sa(e,t){var n,r=_a(t.snapshotVersion),i=_a(t.lastLimboFreeSnapshotVersion);n=$n(t.target)?oa(e.ct,t.target):sa(e.ct,t.target)._t;var a=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Yn(t.target),readTime:r,resumeToken:a,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function Ca(e){var t=la({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?dr(t,t.limit,"L"):t}function Aa(e,t){return new mi(t.largestBatchId,ua(e.ct,t.overlayMutation))}function Da(e,t){var n=t.path.lastSegment();return[e,Je(t.path.popLast()),n]}function Na(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:_a(r.readTime),documentKey:Je(r.documentKey.path),largestBatchId:r.largestBatchId}}var Ra=function(){function e(){(0,y.Z)(this,e)}return(0,m.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return Ma(e).get(t).next((function(e){if(e)return function(e){return{id:e.bundleId,createTime:Ta(e.createTime),version:e.version}}(e)}))}},{key:"saveBundleMetadata",value:function(e,t){return Ma(e).put(function(e){return{bundleId:e.id,createTime:_a(Ki(e.createTime)),version:e.version}}(t))}},{key:"getNamedQuery",value:function(e,t){return Oa(e).get(t).next((function(e){if(e)return function(e){return{name:e.name,query:Ca(e.bundledQuery),readTime:Ta(e.readTime)}}(e)}))}},{key:"saveNamedQuery",value:function(e,t){return Oa(e).put(function(e){return{name:e.name,readTime:_a(Ki(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}]),e}();function Ma(e){return Zt(e,"bundles")}function Oa(e){return Zt(e,"namedQueries")}var Pa=function(){function e(t,n){(0,y.Z)(this,e),this.serializer=t,this.userId=n}return(0,m.Z)(e,[{key:"getOverlay",value:function(e,t){var n=this;return Fa(e).get(Da(this.userId,t)).next((function(e){return e?Aa(n.serializer,e):null}))}},{key:"getOverlays",value:function(e,t){var n=this,r=Er();return Re.forEach(t,(function(t){return n.getOverlay(e,t).next((function(e){null!==e&&r.set(t,e)}))})).next((function(){return r}))}},{key:"saveOverlays",value:function(e,t,n){var r=this,i=[];return n.forEach((function(n,a){var u=new mi(t,a);i.push(r.ht(e,u))})),Re.waitFor(i)}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,i=new Set;t.forEach((function(e){return i.add(Je(e.getCollectionPath()))}));var a=[];return i.forEach((function(t){var i=IDBKeyRange.bound([r.userId,t,n],[r.userId,t,n+1],!1,!0);a.push(Fa(e).j("collectionPathOverlayIndex",i))})),Re.waitFor(a)}},{key:"getOverlaysForCollection",value:function(e,t,n){var r=this,i=Er(),a=Je(t),u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,Number.POSITIVE_INFINITY],!0);return Fa(e).U("collectionPathOverlayIndex",u).next((function(e){var t,n=(0,l.Z)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,u=Aa(r.serializer,a);i.set(u.getKey(),u)}}catch(o){n.e(o)}finally{n.f()}return i}))}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){var i,a=this,u=Er(),o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Fa(e).J({index:"collectionGroupOverlayIndex",range:o},(function(e,t,n){var o=Aa(a.serializer,t);u.size()<r||o.largestBatchId===i?(u.set(o.getKey(),o),i=o.largestBatchId):n.done()})).next((function(){return u}))}},{key:"ht",value:function(e,t){return Fa(e).put(function(e,t,n){var r=Da(t,n.mutation.key),i=(0,s.Z)(r,3);i[0];return{userId:t,collectionPath:i[1],documentId:i[2],collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:aa(e.ct,n.mutation)}}(this.serializer,this.userId,t))}}],[{key:"lt",value:function(t,n){return new e(t,n.uid||"")}}]),e}();function Fa(e){return Zt(e,"documentOverlays")}var La=function(){function e(){(0,y.Z)(this,e)}return(0,m.Z)(e,[{key:"Pt",value:function(e){return Zt(e,"globals")}},{key:"getSessionToken",value:function(e){return this.Pt(e).get("sessionToken").next((function(e){var t=null==e?void 0:e.value;return t?qt.fromUint8Array(t):qt.EMPTY_BYTE_STRING}))}},{key:"setSessionToken",value:function(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}]),e}(),Va=function(){function e(){(0,y.Z)(this,e)}return(0,m.Z)(e,[{key:"It",value:function(e,t){this.Tt(e,t),t.Et()}},{key:"Tt",value:function(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(zt(e.integerValue));else if("doubleValue"in e){var n=zt(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),He(n)?t.At(0):t.At(n))}else if("timestampValue"in e){var r=e.timestampValue;this.dt(t,20),"string"==typeof r&&(r=Bt(r)),t.Rt("".concat(r.seconds||"")),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(jt(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){var i=e.geoPointValue;this.dt(t,45),t.At(i.latitude||0),t.At(i.longitude||0)}else"mapValue"in e?yn(e)?this.dt(t,Number.MAX_SAFE_INTEGER):vn(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):j()}},{key:"Vt",value:function(e,t){this.dt(t,25),this.Dt(e,t)}},{key:"Dt",value:function(e,t){t.Rt(e)}},{key:"St",value:function(e,t){var n=e.fields||{};this.dt(t,55);for(var r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];this.Vt(a,t),this.Tt(n[a],t)}}},{key:"wt",value:function(e,t){var n,r,i=e.fields||{};this.dt(t,53);var a="value",u=(null===(r=null===(n=i[a].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.dt(t,15),t.At(zt(u)),this.Vt(a,t),this.Tt(i[a],t)}},{key:"bt",value:function(e,t){var n=e.values||[];this.dt(t,50);var r,i=(0,l.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.Tt(a,t)}}catch(u){i.e(u)}finally{i.f()}}},{key:"yt",value:function(e,t){var n=this;this.dt(t,37),me.fromName(e).path.forEach((function(e){n.dt(t,60),n.Dt(e,t)}))}},{key:"dt",value:function(e,t){e.At(t)}},{key:"ft",value:function(e){e.At(2)}}]),e}();function qa(e){if(0===e)return 8;var t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function Ua(e){var t=64-function(e){for(var t=0,n=0;n<8;++n){var r=qa(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}Va.vt=new Va;var Ba=function(){function e(){(0,y.Z)(this,e),this.buffer=new Uint8Array(1024),this.position=0}return(0,m.Z)(e,[{key:"Ct",value:function(e){for(var t=e[Symbol.iterator](),n=t.next();!n.done;)this.Ft(n.value),n=t.next();this.Mt()}},{key:"xt",value:function(e){for(var t=e[Symbol.iterator](),n=t.next();!n.done;)this.Ot(n.value),n=t.next();this.Nt()}},{key:"Lt",value:function(e){var t,n=(0,l.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.charCodeAt(0);if(i<128)this.Ft(i);else if(i<2048)this.Ft(960|i>>>6),this.Ft(128|63&i);else if(r<"\ud800"||"\udbff"<r)this.Ft(480|i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i);else{var a=r.codePointAt(0);this.Ft(240|a>>>18),this.Ft(128|63&a>>>12),this.Ft(128|63&a>>>6),this.Ft(128|63&a)}}}catch(u){n.e(u)}finally{n.f()}this.Mt()}},{key:"Bt",value:function(e){var t,n=(0,l.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.charCodeAt(0);if(i<128)this.Ot(i);else if(i<2048)this.Ot(960|i>>>6),this.Ot(128|63&i);else if(r<"\ud800"||"\udbff"<r)this.Ot(480|i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i);else{var a=r.codePointAt(0);this.Ot(240|a>>>18),this.Ot(128|63&a>>>12),this.Ot(128|63&a>>>6),this.Ot(128|63&a)}}}catch(u){n.e(u)}finally{n.f()}this.Nt()}},{key:"kt",value:function(e){var t=this.qt(e),n=Ua(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(var r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}},{key:"Kt",value:function(e){var t=this.qt(e),n=Ua(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(var r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}},{key:"$t",value:function(){this.Ut(255),this.Ut(255)}},{key:"Wt",value:function(){this.Gt(255),this.Gt(255)}},{key:"reset",value:function(){this.position=0}},{key:"seed",value:function(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}},{key:"zt",value:function(){return this.buffer.slice(0,this.position)}},{key:"qt",value:function(e){var t=function(e){var t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(var r=1;r<t.length;++r)t[r]^=n?255:0;return t}},{key:"Ft",value:function(e){var t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(t)}},{key:"Ot",value:function(e){var t=255&e;0===t?(this.Gt(0),this.Gt(255)):255===t?(this.Gt(255),this.Gt(0)):this.Gt(e)}},{key:"Mt",value:function(){this.Ut(0),this.Ut(1)}},{key:"Nt",value:function(){this.Gt(0),this.Gt(1)}},{key:"Ut",value:function(e){this.Qt(1),this.buffer[this.position++]=e}},{key:"Gt",value:function(e){this.Qt(1),this.buffer[this.position++]=~e}},{key:"Qt",value:function(e){var t=e+this.position;if(!(t<=this.buffer.length)){var n=2*this.buffer.length;n<t&&(n=t);var r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}}]),e}(),za=function(){function e(t){(0,y.Z)(this,e),this.jt=t}return(0,m.Z)(e,[{key:"gt",value:function(e){this.jt.Ct(e)}},{key:"Rt",value:function(e){this.jt.Lt(e)}},{key:"At",value:function(e){this.jt.kt(e)}},{key:"Et",value:function(){this.jt.$t()}}]),e}(),ja=function(){function e(t){(0,y.Z)(this,e),this.jt=t}return(0,m.Z)(e,[{key:"gt",value:function(e){this.jt.xt(e)}},{key:"Rt",value:function(e){this.jt.Bt(e)}},{key:"At",value:function(e){this.jt.Kt(e)}},{key:"Et",value:function(){this.jt.Wt()}}]),e}(),Ga=function(){function e(){(0,y.Z)(this,e),this.jt=new Ba,this.Ht=new za(this.jt),this.Jt=new ja(this.jt)}return(0,m.Z)(e,[{key:"seed",value:function(e){this.jt.seed(e)}},{key:"Yt",value:function(e){return 0===e?this.Ht:this.Jt}},{key:"zt",value:function(){return this.jt.zt()}},{key:"reset",value:function(){this.jt.reset()}}]),e}(),Ka=function(){function e(t,n,r,i){(0,y.Z)(this,e),this.indexId=t,this.documentKey=n,this.arrayValue=r,this.directionalValue=i}return(0,m.Z)(e,[{key:"Zt",value:function(){var t=this.directionalValue.length,n=0===t||255===this.directionalValue[t-1]?t+1:t,r=new Uint8Array(n);return r.set(this.directionalValue,0),n!==t?r.set([0],this.directionalValue.length):++r[r.length-1],new e(this.indexId,this.documentKey,this.arrayValue,r)}}]),e}();function Qa(e,t){var n=e.indexId-t.indexId;return 0!==n?n:0!==(n=Ha(e.arrayValue,t.arrayValue))?n:0!==(n=Ha(e.directionalValue,t.directionalValue))?n:me.comparator(e.documentKey,t.documentKey)}function Ha(e,t){for(var n=0;n<e.length&&n<t.length;++n){var r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}var Wa=function(){function e(t){(0,y.Z)(this,e),this.Xt=new Mt((function(e,t){return ye.comparator(e.field,t.field)})),this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.en=t.orderBy,this.tn=[];var n,r=(0,l.Z)(t.filters);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.isInequality()?this.Xt=this.Xt.add(i):this.tn.push(i)}}catch(a){r.e(a)}finally{r.f()}}return(0,m.Z)(e,[{key:"nn",get:function(){return this.Xt.size>1}},{key:"rn",value:function(e){if(G(e.collectionGroup===this.collectionId),this.nn)return!1;var t=ke(e);if(void 0!==t&&!this.sn(t))return!1;for(var n=we(e),r=new Set,i=0,a=0;i<n.length&&this.sn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Xt.size>0){var u=this.Xt.getIterator().getNext();if(!r.has(u.field.canonicalString())){var o=n[i];if(!this.on(u,o)||!this._n(this.en[a++],o))return!1}++i}for(;i<n.length;++i){var s=n[i];if(a>=this.en.length||!this._n(this.en[a++],s))return!1}return!0}},{key:"an",value:function(){if(this.nn)return null;var e,t=new Mt(ye.comparator),n=[],r=(0,l.Z)(this.tn);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(!i.field.isKeyField())if("array-contains"===i.op||"array-contains-any"===i.op)n.push(new xe(i.field,2));else{if(t.has(i.field))continue;t=t.add(i.field),n.push(new xe(i.field,0))}}}catch(s){r.e(s)}finally{r.f()}var a,u=(0,l.Z)(this.en);try{for(u.s();!(a=u.n()).done;){var o=a.value;o.field.isKeyField()||t.has(o.field)||(t=t.add(o.field),n.push(new xe(o.field,"asc"===o.dir?0:1)))}}catch(s){u.e(s)}finally{u.f()}return new ge(ge.UNKNOWN_ID,this.collectionId,n,_e.empty())}},{key:"sn",value:function(e){var t,n=(0,l.Z)(this.tn);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(this.on(r,e))return!0}}catch(i){n.e(i)}finally{n.f()}return!1}},{key:"on",value:function(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}},{key:"_n",value:function(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}]),e}();function Ja(e){var t,n;if(G(e instanceof Dn||e instanceof Nn),e instanceof Dn){if(e instanceof Kn){var r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((function(t){return Dn.create(e.field,"==",t)})))||[];return Nn.create(r,"or")}return e}var i=e.filters.map((function(e){return Ja(e)}));return Nn.create(i,e.op)}function Ya(e){if(0===e.getFilters().length)return[];var t=tu(Ja(e));return G(eu(t)),Xa(t)||$a(t)?[t]:t.getFilters()}function Xa(e){return e instanceof Dn}function $a(e){return e instanceof Nn&&On(e)}function eu(e){return Xa(e)||$a(e)||function(e){if(e instanceof Nn&&Mn(e)){var t,n=(0,l.Z)(e.getFilters());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!Xa(r)&&!$a(r))return!1}}catch(i){n.e(i)}finally{n.f()}return!0}return!1}(e)}function tu(e){if(G(e instanceof Dn||e instanceof Nn),e instanceof Dn)return e;if(1===e.filters.length)return tu(e.filters[0]);var t=e.filters.map((function(e){return tu(e)})),n=Nn.create(t,e.op);return eu(n=iu(n))?n:(G(n instanceof Nn),G(Rn(n)),G(n.filters.length>1),n.filters.reduce((function(e,t){return nu(e,t)})))}function nu(e,t){var n;return G(e instanceof Dn||e instanceof Nn),G(t instanceof Dn||t instanceof Nn),n=e instanceof Dn?t instanceof Dn?function(e,t){return Nn.create([e,t],"and")}(e,t):ru(e,t):t instanceof Dn?ru(t,e):function(e,t){if(G(e.filters.length>0&&t.filters.length>0),Rn(e)&&Rn(t))return Vn(e,t.getFilters());var n=Mn(e)?e:t,r=Mn(e)?t:e,i=n.filters.map((function(e){return nu(e,r)}));return Nn.create(i,"or")}(e,t),iu(n)}function ru(e,t){if(Rn(t))return Vn(t,e.getFilters());var n=t.filters.map((function(t){return nu(e,t)}));return Nn.create(n,"or")}function iu(e){if(G(e instanceof Dn||e instanceof Nn),e instanceof Dn)return e;var t=e.getFilters();if(1===t.length)return iu(t[0]);if(Pn(e))return e;var n=t.map((function(e){return iu(e)})),r=[];return n.forEach((function(t){t instanceof Dn?r.push(t):t instanceof Nn&&(t.op===e.op?r.push.apply(r,(0,p.Z)(t.filters)):r.push(t))})),1===r.length?r[0]:Nn.create(r,e.op)}var au=function(){function e(){(0,y.Z)(this,e),this.un=new uu}return(0,m.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){return this.un.add(t),Re.resolve()}},{key:"getCollectionParents",value:function(e,t){return Re.resolve(this.un.getEntries(t))}},{key:"addFieldIndex",value:function(e,t){return Re.resolve()}},{key:"deleteFieldIndex",value:function(e,t){return Re.resolve()}},{key:"deleteAllFieldIndexes",value:function(e){return Re.resolve()}},{key:"createTargetIndexes",value:function(e,t){return Re.resolve()}},{key:"getDocumentsMatchingTarget",value:function(e,t){return Re.resolve(null)}},{key:"getIndexType",value:function(e,t){return Re.resolve(0)}},{key:"getFieldIndexes",value:function(e,t){return Re.resolve([])}},{key:"getNextCollectionGroupToUpdate",value:function(e){return Re.resolve(null)}},{key:"getMinOffset",value:function(e,t){return Re.resolve(Ee.min())}},{key:"getMinOffsetFromCollectionGroup",value:function(e,t){return Re.resolve(Ee.min())}},{key:"updateCollectionGroup",value:function(e,t,n){return Re.resolve()}},{key:"updateIndexEntries",value:function(e,t){return Re.resolve()}}]),e}(),uu=function(){function e(){(0,y.Z)(this,e),this.index={}}return(0,m.Z)(e,[{key:"add",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Mt(ve.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}},{key:"has",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:"getEntries",value:function(e){return(this.index[e]||new Mt(ve.comparator)).toArray()}}]),e}(),ou=new Uint8Array(0),su=function(){function e(t,n){(0,y.Z)(this,e),this.databaseId=n,this.cn=new uu,this.ln=new br((function(e){return Yn(e)}),(function(e,t){return Xn(e,t)})),this.uid=t.uid||""}return(0,m.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){var n=this;if(!this.cn.has(t)){var r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener((function(){n.cn.add(t)}));var a={collectionId:r,parent:Je(i)};return cu(e).put(a)}return Re.resolve()}},{key:"getCollectionParents",value:function(e,t){var n=[],r=IDBKeyRange.bound([t,""],[le(t),""],!1,!0);return cu(e).U(r).next((function(e){var r,i=(0,l.Z)(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.collectionId!==t)break;n.push($e(a.parent))}}catch(u){i.e(u)}finally{i.f()}return n}))}},{key:"addFieldIndex",value:function(e,t){var n=this,r=hu(e),i=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((function(e){return[e.fieldPath.canonicalString(),e.kind]}))}}(t);delete i.indexId;var a=r.add(i);if(t.indexState){var u=fu(e);return a.next((function(e){u.put(Na(e,n.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return a.next()}},{key:"deleteFieldIndex",value:function(e,t){var n=hu(e),r=fu(e),i=lu(e);return n.delete(t.indexId).next((function(){return r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))})).next((function(){return i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))}))}},{key:"deleteAllFieldIndexes",value:function(e){var t=hu(e),n=lu(e),r=fu(e);return t.j().next((function(){return n.j()})).next((function(){return r.j()}))}},{key:"createTargetIndexes",value:function(e,t){var n=this;return Re.forEach(this.hn(t),(function(t){return n.getIndexType(e,t).next((function(r){if(0===r||1===r){var i=new Wa(t).an();if(null!=i)return n.addFieldIndex(e,i)}}))}))}},{key:"getDocumentsMatchingTarget",value:function(e,t){var n=this,r=lu(e),i=!0,a=new Map;return Re.forEach(this.hn(t),(function(t){return n.Pn(e,t).next((function(e){i&&(i=!!e),a.set(t,e)}))})).next((function(){if(i){var e=Nr(),u=[];return Re.forEach(a,(function(i,a){q("IndexedDbIndexManager","Using index ".concat(function(e){return"id=".concat(e.indexId,"|cg=").concat(e.collectionGroup,"|f=").concat(e.fields.map((function(e){return"".concat(e.fieldPath,":").concat(e.kind)})).join(","))}(i)," to execute ").concat(Yn(t)));var o=function(e,t){var n=ke(t);if(void 0===n)return null;var r,i=(0,l.Z)(er(e,n.fieldPath));try{for(i.s();!(r=i.n()).done;){var a=r.value;switch(a.op){case"array-contains-any":return a.value.arrayValue.values||[];case"array-contains":return[a.value]}}}catch(u){i.e(u)}finally{i.f()}return null}(a,i),s=function(e,t){var n,r=new Map,i=(0,l.Z)(we(t));try{for(i.s();!(n=i.n()).done;){var a,u=n.value,o=(0,l.Z)(er(e,u.fieldPath));try{for(o.s();!(a=o.n()).done;){var s=a.value;switch(s.op){case"==":case"in":r.set(u.fieldPath.canonicalString(),s.value);break;case"not-in":case"!=":return r.set(u.fieldPath.canonicalString(),s.value),Array.from(r.values())}}}catch(c){o.e(c)}finally{o.f()}}}catch(c){i.e(c)}finally{i.f()}return null}(a,i),c=function(e,t){var n,r=[],i=!0,a=(0,l.Z)(we(t));try{for(a.s();!(n=a.n()).done;){var u=n.value,o=0===u.kind?tr(e,u.fieldPath,e.startAt):nr(e,u.fieldPath,e.startAt);r.push(o.value),i&&(i=o.inclusive)}}catch(s){a.e(s)}finally{a.f()}return new Tn(r,i)}(a,i),h=function(e,t){var n,r=[],i=!0,a=(0,l.Z)(we(t));try{for(a.s();!(n=a.n()).done;){var u=n.value,o=0===u.kind?nr(e,u.fieldPath,e.endAt):tr(e,u.fieldPath,e.endAt);r.push(o.value),i&&(i=o.inclusive)}}catch(s){a.e(s)}finally{a.f()}return new Tn(r,i)}(a,i),f=n.In(i,a,c),d=n.In(i,a,h),v=n.Tn(i,a,s),p=n.En(i.indexId,o,f,c.inclusive,d,h.inclusive,v);return Re.forEach(p,(function(n){return r.G(n,t.limit).next((function(t){t.forEach((function(t){var n=me.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),u.push(n))}))}))}))})).next((function(){return u}))}return Re.resolve(null)}))}},{key:"hn",value:function(e){var t=this.ln.get(e);return t||(t=0===e.filters.length?[e]:Ya(Nn.create(e.filters,"and")).map((function(t){return Jn(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)})),this.ln.set(e,t),t)}},{key:"En",value:function(e,t,n,r,i,a,u){for(var o=this,s=(null!=t?t.length:1)*Math.max(n.length,i.length),c=s/(null!=t?t.length:1),l=[],h=function(){var s=t?o.dn(t[f/c]):ou,h=o.An(e,s,n[f%c],r),d=o.Rn(e,s,i[f%c],a),v=u.map((function(t){return o.An(e,s,t,!0)}));l.push.apply(l,(0,p.Z)(o.createRange(h,d,v)))},f=0;f<s;++f)h();return l}},{key:"An",value:function(e,t,n,r){var i=new Ka(e,me.empty(),t,n);return r?i:i.Zt()}},{key:"Rn",value:function(e,t,n,r){var i=new Ka(e,me.empty(),t,n);return r?i.Zt():i}},{key:"Pn",value:function(e,t){var n=new Wa(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((function(e){var t,r=null,i=(0,l.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;n.rn(a)&&(!r||a.fields.length>r.fields.length)&&(r=a)}}catch(u){i.e(u)}finally{i.f()}return r}))}},{key:"getIndexType",value:function(e,t){var n=this,r=2,i=this.hn(t);return Re.forEach(i,(function(t){return n.Pn(e,t).next((function(e){e?0!==r&&e.fields.length<function(e){var t,n=new Mt(ye.comparator),r=!1,i=(0,l.Z)(e.filters);try{for(i.s();!(t=i.n()).done;){var a,u=t.value,o=(0,l.Z)(u.getFlattenedFilters());try{for(o.s();!(a=o.n()).done;){var s=a.value;s.field.isKeyField()||("array-contains"===s.op||"array-contains-any"===s.op?r=!0:n=n.add(s.field))}}catch(d){o.e(d)}finally{o.f()}}}catch(d){i.e(d)}finally{i.f()}var c,h=(0,l.Z)(e.orderBy);try{for(h.s();!(c=h.n()).done;){var f=c.value;f.field.isKeyField()||(n=n.add(f.field))}}catch(d){h.e(d)}finally{h.f()}return n.size+(r?1:0)}(t)&&(r=1):r=0}))})).next((function(){return function(e){return null!==e.limit}(t)&&i.length>1&&2===r?1:r}))}},{key:"Vn",value:function(e,t){var n,r=new Ga,i=(0,l.Z)(we(e));try{for(i.s();!(n=i.n()).done;){var a=n.value,u=t.data.field(a.fieldPath);if(null==u)return null;var o=r.Yt(a.kind);Va.vt.It(u,o)}}catch(s){i.e(s)}finally{i.f()}return r.zt()}},{key:"dn",value:function(e){var t=new Ga;return Va.vt.It(e,t.Yt(0)),t.zt()}},{key:"mn",value:function(e,t){var n=new Ga;return Va.vt.It(sn(this.databaseId,t),n.Yt(function(e){var t=we(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.zt()}},{key:"Tn",value:function(e,t,n){if(null===n)return[];var r=[];r.push(new Ga);var i,a=0,u=(0,l.Z)(we(e));try{for(u.s();!(i=u.n()).done;){var o,s=i.value,c=n[a++],h=(0,l.Z)(r);try{for(h.s();!(o=h.n()).done;){var f=o.value;if(this.fn(t,s.fieldPath)&&ln(c))r=this.gn(r,s,c);else{var d=f.Yt(s.kind);Va.vt.It(c,d)}}}catch(v){h.e(v)}finally{h.f()}}}catch(v){u.e(v)}finally{u.f()}return this.pn(r)}},{key:"In",value:function(e,t,n){return this.Tn(e,t,n.position)}},{key:"pn",value:function(e){for(var t=[],n=0;n<e.length;++n)t[n]=e[n].zt();return t}},{key:"gn",value:function(e,t,n){var r,i=(0,p.Z)(e),a=[],u=(0,l.Z)(n.arrayValue.values||[]);try{for(u.s();!(r=u.n()).done;){var o,s=r.value,c=(0,l.Z)(i);try{for(c.s();!(o=c.n()).done;){var h=o.value,f=new Ga;f.seed(h.zt()),Va.vt.It(s,f.Yt(t.kind)),a.push(f)}}catch(d){c.e(d)}finally{c.f()}}}catch(d){u.e(d)}finally{u.f()}return a}},{key:"fn",value:function(e,t){return!!e.filters.find((function(e){return e instanceof Dn&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)}))}},{key:"getFieldIndexes",value:function(e,t){var n=this,r=hu(e),i=fu(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next((function(e){var t=[];return Re.forEach(e,(function(e){return i.get([e.indexId,n.uid]).next((function(n){t.push(function(e,t){var n=t?new _e(t.sequenceNumber,new Ee(Ta(t.readTime),new me($e(t.documentKey)),t.largestBatchId)):_e.empty(),r=e.fields.map((function(e){var t=(0,s.Z)(e,2),n=t[0],r=t[1];return new xe(ye.fromServerFormat(n),r)}));return new ge(e.indexId,e.collectionGroup,r,n)}(e,n))}))})).next((function(){return t}))}))}},{key:"getNextCollectionGroupToUpdate",value:function(e){return this.getFieldIndexes(e).next((function(e){return 0===e.length?null:(e.sort((function(e,t){var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:se(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)}))}},{key:"updateCollectionGroup",value:function(e,t,n){var r=this,i=hu(e),a=fu(e);return this.yn(e).next((function(e){return i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((function(t){return Re.forEach(t,(function(t){return a.put(Na(t.indexId,r.uid,e,n))}))}))}))}},{key:"updateIndexEntries",value:function(e,t){var n=this,r=new Map;return Re.forEach(t,(function(t,i){var a=r.get(t.collectionGroup);return(a?Re.resolve(a):n.getFieldIndexes(e,t.collectionGroup)).next((function(a){return r.set(t.collectionGroup,a),Re.forEach(a,(function(r){return n.wn(e,t,r).next((function(t){var a=n.Sn(i,r);return t.isEqual(a)?Re.resolve():n.bn(e,i,r,t,a)}))}))}))}))}},{key:"Dn",value:function(e,t,n,r){return lu(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}},{key:"vn",value:function(e,t,n,r){return lu(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}},{key:"wn",value:function(e,t,n){var r=lu(e),i=new Mt(Qa);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(function(e,r){i=i.add(new Ka(n.indexId,t,r.arrayValue,r.directionalValue))})).next((function(){return i}))}},{key:"Sn",value:function(e,t){var n=new Mt(Qa),r=this.Vn(t,e);if(null==r)return n;var i=ke(t);if(null!=i){var a=e.data.field(i.fieldPath);if(ln(a)){var u,o=(0,l.Z)(a.arrayValue.values||[]);try{for(o.s();!(u=o.n()).done;){var s=u.value;n=n.add(new Ka(t.indexId,e.key,this.dn(s),r))}}catch(c){o.e(c)}finally{o.f()}}}else n=n.add(new Ka(t.indexId,e.key,ou,r));return n}},{key:"bn",value:function(e,t,n,r,i){var a=this;q("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);var u=[];return function(e,t,n,r,i){for(var a=e.getIterator(),u=t.getIterator(),o=Pt(a),s=Pt(u);o||s;){var c=!1,l=!1;if(o&&s){var h=n(o,s);h<0?l=!0:h>0&&(c=!0)}else null!=o?l=!0:c=!0;c?(r(s),s=Pt(u)):l?(i(o),o=Pt(a)):(o=Pt(a),s=Pt(u))}}(r,i,Qa,(function(r){u.push(a.Dn(e,t,n,r))}),(function(r){u.push(a.vn(e,t,n,r))})),Re.waitFor(u)}},{key:"yn",value:function(e){var t=1;return fu(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(function(e,n,r){r.done(),t=n.sequenceNumber+1})).next((function(){return t}))}},{key:"createRange",value:function(e,t,n){n=n.sort((function(e,t){return Qa(e,t)})).filter((function(e,t,n){return!t||0!==Qa(e,n[t-1])}));var r=[];r.push(e);var i,a=(0,l.Z)(n);try{for(a.s();!(i=a.n()).done;){var u=i.value,o=Qa(u,e),s=Qa(u,t);if(0===o)r[0]=e.Zt();else if(o>0&&s<0)r.push(u),r.push(u.Zt());else if(s>0)break}}catch(v){a.e(v)}finally{a.f()}r.push(t);for(var c=[],h=0;h<r.length;h+=2){if(this.Cn(r[h],r[h+1]))return[];var f=[r[h].indexId,this.uid,r[h].arrayValue,r[h].directionalValue,ou,[]],d=[r[h+1].indexId,this.uid,r[h+1].arrayValue,r[h+1].directionalValue,ou,[]];c.push(IDBKeyRange.bound(f,d))}return c}},{key:"Cn",value:function(e,t){return Qa(e,t)>0}},{key:"getMinOffsetFromCollectionGroup",value:function(e,t){return this.getFieldIndexes(e,t).next(du)}},{key:"getMinOffset",value:function(e,t){var n=this;return Re.mapArray(this.hn(t),(function(t){return n.Pn(e,t).next((function(e){return e||j()}))})).next(du)}}]),e}();function cu(e){return Zt(e,"collectionParents")}function lu(e){return Zt(e,"indexEntries")}function hu(e){return Zt(e,"indexConfiguration")}function fu(e){return Zt(e,"indexState")}function du(e){G(0!==e.length);for(var t=e[0].indexState.offset,n=t.largestBatchId,r=1;r<e.length;r++){var i=e[r].indexState.offset;Se(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new Ee(t.readTime,t.documentKey,n)}var vu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},pu=function(){function e(t,n,r){(0,y.Z)(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return(0,m.Z)(e,null,[{key:"withCacheSize",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();function yu(e,t,n){var r=e.store("mutations"),i=e.store("documentMutations"),a=[],u=IDBKeyRange.only(n.batchId),o=0,s=r.J({range:u},(function(e,t,n){return o++,n.delete()}));a.push(s.next((function(){G(1===o)})));var c,h=[],f=(0,l.Z)(n.mutations);try{for(f.s();!(c=f.n()).done;){var d=c.value,v=nt(t,d.key.path,n.batchId);a.push(i.delete(v)),h.push(d.key)}}catch(p){f.e(p)}finally{f.f()}return Re.waitFor(a).next((function(){return h}))}function mu(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw j();t=e.noDocument}return JSON.stringify(t).length}pu.DEFAULT_COLLECTION_PERCENTILE=10,pu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pu.DEFAULT=new pu(41943040,pu.DEFAULT_COLLECTION_PERCENTILE,pu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pu.DISABLED=new pu(-1,0,0);var gu=function(){function e(t,n,r,i){(0,y.Z)(this,e),this.userId=t,this.serializer=n,this.indexManager=r,this.referenceDelegate=i,this.Fn={}}return(0,m.Z)(e,[{key:"checkEmpty",value:function(e){var t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return wu(e).J({index:"userMutationsIndex",range:n},(function(e,n,r){t=!1,r.done()})).next((function(){return t}))}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this,a=bu(e),u=wu(e);return u.add({}).next((function(o){G("number"==typeof o);var s,c=new pi(o,t,n,r),h=function(e,t,n){var r=n.baseMutations.map((function(t){return aa(e.ct,t)})),i=n.mutations.map((function(t){return aa(e.ct,t)}));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(i.serializer,i.userId,c),f=[],d=new Mt((function(e,t){return se(e.canonicalString(),t.canonicalString())})),v=(0,l.Z)(r);try{for(v.s();!(s=v.n()).done;){var p=s.value,y=nt(i.userId,p.key.path,o);d=d.add(p.key.path.popLast()),f.push(u.put(h)),f.push(a.put(y,rt))}}catch(m){v.e(m)}finally{v.f()}return d.forEach((function(t){f.push(i.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((function(){i.Fn[o]=c.keys()})),Re.waitFor(f).next((function(){return c}))}))}},{key:"lookupMutationBatch",value:function(e,t){var n=this;return wu(e).get(t).next((function(e){return e?(G(e.userId===n.userId),Za(n.serializer,e)):null}))}},{key:"Mn",value:function(e,t){var n=this;return this.Fn[t]?Re.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next((function(e){if(e){var r=e.keys();return n.Fn[t]=r,r}return null}))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=this,r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),a=null;return wu(e).J({index:"userMutationsIndex",range:i},(function(e,t,i){t.userId===n.userId&&(G(t.batchId>=r),a=Za(n.serializer,t)),i.done()})).next((function(){return a}))}},{key:"getHighestUnacknowledgedBatchId",value:function(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return wu(e).J({index:"userMutationsIndex",range:t,reverse:!0},(function(e,t,r){n=t.batchId,r.done()})).next((function(){return n}))}},{key:"getAllMutationBatches",value:function(e){var t=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return wu(e).U("userMutationsIndex",n).next((function(e){return e.map((function(e){return Za(t.serializer,e)}))}))}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=tt(this.userId,t.path),i=IDBKeyRange.lowerBound(r),a=[];return bu(e).J({range:i},(function(r,i,u){var o=(0,s.Z)(r,3),c=o[0],l=o[1],h=o[2],f=$e(l);if(c===n.userId&&t.path.isEqual(f))return wu(e).get(h).next((function(e){if(!e)throw j();G(e.userId===n.userId),a.push(Za(n.serializer,e))}));u.done()})).next((function(){return a}))}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Mt(se),i=[];return t.forEach((function(t){var a=tt(n.userId,t.path),u=IDBKeyRange.lowerBound(a),o=bu(e).J({range:u},(function(e,i,a){var u=(0,s.Z)(e,3),o=u[0],c=u[1],l=u[2],h=$e(c);o===n.userId&&t.path.isEqual(h)?r=r.add(l):a.done()}));i.push(o)})),Re.waitFor(i).next((function(){return n.xn(e,r)}))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=this,r=t.path,i=r.length+1,a=tt(this.userId,r),u=IDBKeyRange.lowerBound(a),o=new Mt(se);return bu(e).J({range:u},(function(e,t,a){var u=(0,s.Z)(e,3),c=u[0],l=u[1],h=u[2],f=$e(l);c===n.userId&&r.isPrefixOf(f)?f.length===i&&(o=o.add(h)):a.done()})).next((function(){return n.xn(e,o)}))}},{key:"xn",value:function(e,t){var n=this,r=[],i=[];return t.forEach((function(t){i.push(wu(e).get(t).next((function(e){if(null===e)throw j();G(e.userId===n.userId),r.push(Za(n.serializer,e))})))})),Re.waitFor(i).next((function(){return r}))}},{key:"removeMutationBatch",value:function(e,t){var n=this;return yu(e._e,this.userId,t).next((function(r){return e.addOnCommittedListener((function(){n.On(t.batchId)})),Re.forEach(r,(function(t){return n.referenceDelegate.markPotentiallyOrphaned(e,t)}))}))}},{key:"On",value:function(e){delete this.Fn[e]}},{key:"performConsistencyCheck",value:function(e){var t=this;return this.checkEmpty(e).next((function(n){if(!n)return Re.resolve();var r=IDBKeyRange.lowerBound(function(e){return[e]}(t.userId)),i=[];return bu(e).J({range:r},(function(e,n,r){if(e[0]===t.userId){var a=$e(e[1]);i.push(a)}else r.done()})).next((function(){G(0===i.length)}))}))}},{key:"containsKey",value:function(e,t){return ku(e,this.userId,t)}},{key:"Nn",value:function(e){var t=this;return xu(e).get(this.userId).next((function(e){return e||{userId:t.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}}))}}],[{key:"lt",value:function(t,n,r,i){return G(""!==t.uid),new e(t.isAuthenticated()?t.uid:"",n,r,i)}}]),e}();function ku(e,t,n){var r=tt(t,n.path),i=r[1],a=IDBKeyRange.lowerBound(r),u=!1;return bu(e).J({range:a,H:!0},(function(e,n,r){var a=(0,s.Z)(e,3),o=a[0],c=a[1];a[2];o===t&&c===i&&(u=!0),r.done()})).next((function(){return u}))}function wu(e){return Zt(e,"mutations")}function bu(e){return Zt(e,"documentMutations")}function xu(e){return Zt(e,"mutationQueues")}var Iu=function(){function e(t){(0,y.Z)(this,e),this.Ln=t}return(0,m.Z)(e,[{key:"next",value:function(){return this.Ln+=2,this.Ln}}],[{key:"Bn",value:function(){return new e(0)}},{key:"kn",value:function(){return new e(-1)}}]),e}(),_u=function(){function e(t,n){(0,y.Z)(this,e),this.referenceDelegate=t,this.serializer=n}return(0,m.Z)(e,[{key:"allocateTargetId",value:function(e){var t=this;return this.qn(e).next((function(n){var r=new Iu(n.highestTargetId);return n.highestTargetId=r.next(),t.Qn(e,n).next((function(){return n.highestTargetId}))}))}},{key:"getLastRemoteSnapshotVersion",value:function(e){return this.qn(e).next((function(e){return fe.fromTimestamp(new he(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))}))}},{key:"getHighestSequenceNumber",value:function(e){return this.qn(e).next((function(e){return e.highestListenSequenceNumber}))}},{key:"setTargetsMetadata",value:function(e,t,n){var r=this;return this.qn(e).next((function(i){return i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),r.Qn(e,i)}))}},{key:"addTargetData",value:function(e,t){var n=this;return this.Kn(e,t).next((function(){return n.qn(e).next((function(r){return r.targetCount+=1,n.$n(t,r),n.Qn(e,r)}))}))}},{key:"updateTargetData",value:function(e,t){return this.Kn(e,t)}},{key:"removeTargetData",value:function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next((function(){return Tu(e).delete(t.targetId)})).next((function(){return n.qn(e)})).next((function(t){return G(t.targetCount>0),t.targetCount-=1,n.Qn(e,t)}))}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return Tu(e).J((function(u,o){var s=Ea(o);s.sequenceNumber<=t&&null===n.get(s.targetId)&&(i++,a.push(r.removeTargetData(e,s)))})).next((function(){return Re.waitFor(a)})).next((function(){return i}))}},{key:"forEachTarget",value:function(e,t){return Tu(e).J((function(e,n){var r=Ea(n);t(r)}))}},{key:"qn",value:function(e){return Zu(e).get("targetGlobalKey").next((function(e){return G(null!==e),e}))}},{key:"Qn",value:function(e,t){return Zu(e).put("targetGlobalKey",t)}},{key:"Kn",value:function(e,t){return Tu(e).put(Sa(this.serializer,t))}},{key:"$n",value:function(e,t){var n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}},{key:"getTargetCount",value:function(e){return this.qn(e).next((function(e){return e.targetCount}))}},{key:"getTargetData",value:function(e,t){var n=Yn(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Tu(e).J({range:r,index:"queryTargetsIndex"},(function(e,n,r){var a=Ea(n);Xn(t,a.target)&&(i=a,r.done())})).next((function(){return i}))}},{key:"addMatchingKeys",value:function(e,t,n){var r=this,i=[],a=Eu(e);return t.forEach((function(t){var u=Je(t.path);i.push(a.put({targetId:n,path:u})),i.push(r.referenceDelegate.addReference(e,n,t))})),Re.waitFor(i)}},{key:"removeMatchingKeys",value:function(e,t,n){var r=this,i=Eu(e);return Re.forEach(t,(function(t){var a=Je(t.path);return Re.waitFor([i.delete([n,a]),r.referenceDelegate.removeReference(e,n,t)])}))}},{key:"removeMatchingKeysForTargetId",value:function(e,t){var n=Eu(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Eu(e),i=Nr();return r.J({range:n,H:!0},(function(e,t,n){var r=$e(e[1]),a=new me(r);i=i.add(a)})).next((function(){return i}))}},{key:"containsKey",value:function(e,t){var n=Je(t.path),r=IDBKeyRange.bound([n],[le(n)],!1,!0),i=0;return Eu(e).J({index:"documentTargetsIndex",H:!0,range:r},(function(e,t,n){var r=(0,s.Z)(e,2),a=r[0];r[1];0!==a&&(i++,n.done())})).next((function(){return i>0}))}},{key:"ot",value:function(e,t){return Tu(e).get(t).next((function(e){return e?Ea(e):null}))}}]),e}();function Tu(e){return Zt(e,"targets")}function Zu(e){return Zt(e,"targetGlobal")}function Eu(e){return Zt(e,"targetDocuments")}function Su(e,t){var n=(0,s.Z)(e,2),r=n[0],i=n[1],a=(0,s.Z)(t,2),u=a[0],o=a[1],c=se(r,u);return 0===c?se(i,o):c}var Cu=function(){function e(t){(0,y.Z)(this,e),this.Un=t,this.buffer=new Mt(Su),this.Wn=0}return(0,m.Z)(e,[{key:"Gn",value:function(){return++this.Wn}},{key:"zn",value:function(e){var t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{var n=this.buffer.last();Su(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}},{key:"maxValue",get:function(){return this.buffer.last()[0]}}]),e}(),Au=function(){function e(t,n,r){(0,y.Z)(this,e),this.garbageCollector=t,this.asyncQueue=n,this.localStore=r,this.jn=null}return(0,m.Z)(e,[{key:"start",value:function(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Hn(6e4)}},{key:"stop",value:function(){this.jn&&(this.jn.cancel(),this.jn=null)}},{key:"started",get:function(){return null!==this.jn}},{key:"Hn",value:function(e){var t=this;q("LruGarbageCollector","Garbage collection scheduled in ".concat(e,"ms")),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,f.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.jn=null,e.prev=1,e.next=4,t.localStore.collectGarbage(t.garbageCollector);case 4:e.next=14;break;case 6:if(e.prev=6,e.t0=e.catch(1),!Ve(e.t0)){e.next=12;break}q("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e.t0),e.next=14;break;case 12:return e.next=14,De(e.t0);case 14:return e.next=16,t.Hn(3e5);case 16:case"end":return e.stop()}}),e,null,[[1,6]])}))))}}]),e}(),Du=function(){function e(t,n){(0,y.Z)(this,e),this.Jn=t,this.params=n}return(0,m.Z)(e,[{key:"calculateTargetCount",value:function(e,t){return this.Jn.Yn(e).next((function(e){return Math.floor(t/100*e)}))}},{key:"nthSequenceNumber",value:function(e,t){var n=this;if(0===t)return Re.resolve(Ke.oe);var r=new Cu(t);return this.Jn.forEachTarget(e,(function(e){return r.zn(e.sequenceNumber)})).next((function(){return n.Jn.Zn(e,(function(e){return r.zn(e)}))})).next((function(){return r.maxValue}))}},{key:"removeTargets",value:function(e,t,n){return this.Jn.removeTargets(e,t,n)}},{key:"removeOrphanedDocuments",value:function(e,t){return this.Jn.removeOrphanedDocuments(e,t)}},{key:"collect",value:function(e,t){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(q("LruGarbageCollector","Garbage collection skipped; disabled"),Re.resolve(vu)):this.getCacheSize(e).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(q("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(r," is lower than threshold ").concat(n.params.cacheSizeCollectionThreshold)),vu):n.Xn(e,t)}))}},{key:"getCacheSize",value:function(e){return this.Jn.getCacheSize(e)}},{key:"Xn",value:function(e,t){var n,r,i,a,u,o,s,c=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((function(t){return t>c.params.maximumSequenceNumbersToCollect?(q("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(c.params.maximumSequenceNumbersToCollect," from ").concat(t)),r=c.params.maximumSequenceNumbersToCollect):r=t,a=Date.now(),c.nthSequenceNumber(e,r)})).next((function(r){return n=r,u=Date.now(),c.removeTargets(e,n,t)})).next((function(t){return i=t,o=Date.now(),c.removeOrphanedDocuments(e,n)})).next((function(e){return s=Date.now(),L()<=w.in.DEBUG&&q("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(a-l,"ms\n\tDetermined least recently used ").concat(r," in ")+(u-a)+"ms\n"+"\tRemoved ".concat(i," targets in ")+(o-u)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(s-o)+"ms\n"+"Total Duration: ".concat(s-l,"ms")),Re.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})}))}}]),e}();function Nu(e,t){return new Du(e,t)}var Ru=function(){function e(t,n){(0,y.Z)(this,e),this.db=t,this.garbageCollector=Nu(this,n)}return(0,m.Z)(e,[{key:"Yn",value:function(e){var t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next((function(e){return t.next((function(t){return e+t}))}))}},{key:"er",value:function(e){var t=0;return this.Zn(e,(function(e){t++})).next((function(){return t}))}},{key:"forEachTarget",value:function(e,t){return this.db.getTargetCache().forEachTarget(e,t)}},{key:"Zn",value:function(e,t){return this.tr(e,(function(e,n){return t(n)}))}},{key:"addReference",value:function(e,t,n){return Mu(e,n)}},{key:"removeReference",value:function(e,t,n){return Mu(e,n)}},{key:"removeTargets",value:function(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}},{key:"markPotentiallyOrphaned",value:function(e,t){return Mu(e,t)}},{key:"nr",value:function(e,t){return function(e,t){var n=!1;return xu(e).Y((function(r){return ku(e,r,t).next((function(e){return e&&(n=!0),Re.resolve(!e)}))})).next((function(){return n}))}(e,t)}},{key:"removeOrphanedDocuments",value:function(e,t){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],a=0;return this.tr(e,(function(u,o){if(o<=t){var s=n.nr(e,u).next((function(t){if(!t)return a++,r.getEntry(e,u).next((function(){return r.removeEntry(u,fe.min()),Eu(e).delete(function(e){return[0,Je(e.path)]}(u))}))}));i.push(s)}})).next((function(){return Re.waitFor(i)})).next((function(){return r.apply(e)})).next((function(){return a}))}},{key:"removeTarget",value:function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}},{key:"updateLimboDocument",value:function(e,t){return Mu(e,t)}},{key:"tr",value:function(e,t){var n,r=Eu(e),i=Ke.oe;return r.J({index:"documentTargetsIndex"},(function(e,r){var a=(0,s.Z)(e,2),u=a[0],o=(a[1],r.path),c=r.sequenceNumber;0===u?(i!==Ke.oe&&t(new me($e(n)),i),i=c,n=o):i=Ke.oe})).next((function(){i!==Ke.oe&&t(new me($e(n)),i)}))}},{key:"getCacheSize",value:function(e){return this.db.getRemoteDocumentCache().getSize(e)}}]),e}();function Mu(e,t){return Eu(e).put(function(e,t){return{targetId:0,path:Je(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}var Ou=function(){function e(){(0,y.Z)(this,e),this.changes=new br((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),this.changesApplied=!1}return(0,m.Z)(e,[{key:"addEntry",value:function(e){this.assertNotApplied(),this.changes.set(e.key,e)}},{key:"removeEntry",value:function(e,t){this.assertNotApplied(),this.changes.set(e,_n.newInvalidDocument(e).setReadTime(t))}},{key:"getEntry",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?Re.resolve(n):this.getFromCache(e,t)}},{key:"getEntries",value:function(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function(){}}]),e}(),Pu=function(){function e(t){(0,y.Z)(this,e),this.serializer=t}return(0,m.Z)(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t,n){return qu(e).put(n)}},{key:"removeEntry",value:function(e,t,n){return qu(e).delete(function(e,t){var n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Ia(t),n[n.length-1]]}(t,n))}},{key:"updateMetadata",value:function(e,t){var n=this;return this.getMetadata(e).next((function(r){return r.byteSize+=t,n.rr(e,r)}))}},{key:"getEntry",value:function(e,t){var n=this,r=_n.newInvalidDocument(t);return qu(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Uu(t))},(function(e,i){r=n.ir(t,i)})).next((function(){return r}))}},{key:"sr",value:function(e,t){var n=this,r={size:0,document:_n.newInvalidDocument(t)};return qu(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Uu(t))},(function(e,i){r={document:n.ir(t,i),size:mu(i)}})).next((function(){return r}))}},{key:"getEntries",value:function(e,t){var n=this,r=Ir();return this._r(e,t,(function(e,t){var i=n.ir(e,t);r=r.insert(e,i)})).next((function(){return r}))}},{key:"ar",value:function(e,t){var n=this,r=Ir(),i=new Dt(me.comparator);return this._r(e,t,(function(e,t){var a=n.ir(e,t);r=r.insert(e,a),i=i.insert(e,mu(t))})).next((function(){return{documents:r,ur:i}}))}},{key:"_r",value:function(e,t,n){if(t.isEmpty())return Re.resolve();var r=new Mt(zu);t.forEach((function(e){return r=r.add(e)}));var i=IDBKeyRange.bound(Uu(r.first()),Uu(r.last())),a=r.getIterator(),u=a.getNext();return qu(e).J({index:"documentKeyIndex",range:i},(function(e,t,r){for(var i=me.fromSegments([].concat((0,p.Z)(t.prefixPath),[t.collectionGroup,t.documentId]));u&&zu(u,i)<0;)n(u,null),u=a.getNext();u&&u.isEqual(i)&&(n(u,t),u=a.hasNext()?a.getNext():null),u?r.$(Uu(u)):r.done()})).next((function(){for(;u;)n(u,null),u=a.hasNext()?a.getNext():null}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r,i){var a=this,u=t.path,o=[u.popLast().toArray(),u.lastSegment(),Ia(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],s=[u.popLast().toArray(),u.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return qu(e).U(IDBKeyRange.bound(o,s,!0)).next((function(e){null==i||i.incrementDocumentReadCount(e.length);var n,u=Ir(),o=(0,l.Z)(e);try{for(o.s();!(n=o.n()).done;){var s=n.value,c=a.ir(me.fromSegments(s.prefixPath.concat(s.collectionGroup,s.documentId)),s);c.isFoundDocument()&&(mr(t,c)||r.has(c.key))&&(u=u.insert(c.key,c))}}catch(h){o.e(h)}finally{o.f()}return u}))}},{key:"getAllFromCollectionGroup",value:function(e,t,n,r){var i=this,a=Ir(),u=Bu(t,n),o=Bu(t,Ee.max());return qu(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(u,o,!0)},(function(e,t,n){var u=i.ir(me.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(a=a.insert(u.key,u)).size===r&&n.done()})).next((function(){return a}))}},{key:"newChangeBuffer",value:function(e){return new Lu(this,!!e&&e.trackRemovals)}},{key:"getSize",value:function(e){return this.getMetadata(e).next((function(e){return e.byteSize}))}},{key:"getMetadata",value:function(e){return Vu(e).get("remoteDocumentGlobalKey").next((function(e){return G(!!e),e}))}},{key:"rr",value:function(e,t){return Vu(e).put("remoteDocumentGlobalKey",t)}},{key:"ir",value:function(e,t){if(t){var n=function(e,t){var n;if(t.document)n=ra(e.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){var r=me.fromSegments(t.noDocument.path),i=Ta(t.noDocument.readTime);n=_n.newNoDocument(r,i),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return j();var a=me.fromSegments(t.unknownDocument.path),u=Ta(t.unknownDocument.version);n=_n.newUnknownDocument(a,u)}return t.readTime&&n.setReadTime(function(e){var t=new he(e[0],e[1]);return fe.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!n.isNoDocument()||!n.version.isEqual(fe.min()))return n}return _n.newInvalidDocument(e)}}]),e}();function Fu(e){return new Pu(e)}var Lu=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this)).cr=e,i.trackRemovals=r,i.lr=new br((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),i}return(0,m.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[],r=0,i=new Mt((function(e,t){return se(e.canonicalString(),t.canonicalString())}));return this.changes.forEach((function(a,u){var o=t.lr.get(a);if(n.push(t.cr.removeEntry(e,a,o.readTime)),u.isValidDocument()){var s=xa(t.cr.serializer,u);i=i.add(a.path.popLast());var c=mu(s);r+=c-o.size,n.push(t.cr.addEntry(e,a,s))}else if(r-=o.size,t.trackRemovals){var l=xa(t.cr.serializer,u.convertToNoDocument(fe.min()));n.push(t.cr.addEntry(e,a,l))}})),i.forEach((function(r){n.push(t.cr.indexManager.addToCollectionParentIndex(e,r))})),n.push(this.cr.updateMetadata(e,r)),Re.waitFor(n)}},{key:"getFromCache",value:function(e,t){var n=this;return this.cr.sr(e,t).next((function(e){return n.lr.set(t,{size:e.size,readTime:e.document.readTime}),e.document}))}},{key:"getAllFromCache",value:function(e,t){var n=this;return this.cr.ar(e,t).next((function(e){var t=e.documents;return e.ur.forEach((function(e,r){n.lr.set(e,{size:r,readTime:t.get(e).readTime})})),t}))}}]),n}(Ou);function Vu(e){return Zt(e,"remoteDocumentGlobal")}function qu(e){return Zt(e,"remoteDocumentsV14")}function Uu(e){var t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Bu(e,t){var n=t.documentKey.path.toArray();return[e,Ia(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function zu(e,t){for(var n=e.path.toArray(),r=t.path.toArray(),i=0,a=0;a<n.length-2&&a<r.length-2;++a)if(i=se(n[a],r[a]))return i;return(i=se(n.length,r.length))||((i=se(n[n.length-2],r[r.length-2]))||se(n[n.length-1],r[r.length-1]))}var ju=(0,m.Z)((function e(t,n){(0,y.Z)(this,e),this.overlayedDocument=t,this.mutatedFields=n})),Gu=function(){function e(t,n,r,i){(0,y.Z)(this,e),this.remoteDocumentCache=t,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}return(0,m.Z)(e,[{key:"getDocument",value:function(e,t){var n=this,r=null;return this.documentOverlayCache.getOverlay(e,t).next((function(i){return r=i,n.remoteDocumentCache.getEntry(e,t)})).next((function(e){return null!==r&&ri(r.mutation,e,Ft.empty(),he.now()),e}))}},{key:"getDocuments",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next((function(t){return n.getLocalViewOfDocuments(e,t,Nr()).next((function(){return t}))}))}},{key:"getLocalViewOfDocuments",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Nr(),i=Er();return this.populateOverlays(e,i,t).next((function(){return n.computeViews(e,t,i,r).next((function(e){var t=Tr();return e.forEach((function(e,n){t=t.insert(e,n.overlayedDocument)})),t}))}))}},{key:"getOverlayedDocuments",value:function(e,t){var n=this,r=Er();return this.populateOverlays(e,r,t).next((function(){return n.computeViews(e,t,r,Nr())}))}},{key:"populateOverlays",value:function(e,t,n){var r=[];return n.forEach((function(e){t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((function(e){e.forEach((function(e,n){t.set(e,n)}))}))}},{key:"computeViews",value:function(e,t,n,r){var i=Ir(),a=Cr(),u=Cr();return t.forEach((function(e,t){var u=n.get(t.key);r.has(t.key)&&(void 0===u||u.mutation instanceof oi)?i=i.insert(t.key,t):void 0!==u?(a.set(t.key,u.mutation.getFieldMask()),ri(u.mutation,t,u.mutation.getFieldMask(),he.now())):a.set(t.key,Ft.empty())})),this.recalculateAndSaveOverlays(e,i).next((function(e){return e.forEach((function(e,t){return a.set(e,t)})),t.forEach((function(e,t){var n;return u.set(e,new ju(t,null!==(n=a.get(e))&&void 0!==n?n:null))})),u}))}},{key:"recalculateAndSaveOverlays",value:function(e,t){var n=this,r=Cr(),i=new Dt((function(e,t){return e-t})),a=Nr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((function(e){var n,a=(0,l.Z)(e);try{var u=function(){var e=n.value;e.keys().forEach((function(n){var a=t.get(n);if(null!==a){var u=r.get(n)||Ft.empty();u=e.applyToLocalView(a,u),r.set(n,u);var o=(i.get(e.batchId)||Nr()).add(n);i=i.insert(e.batchId,o)}}))};for(a.s();!(n=a.n()).done;)u()}catch(o){a.e(o)}finally{a.f()}})).next((function(){for(var u=[],o=i.getReverseIterator(),s=function(){var i=o.getNext(),s=i.key,c=i.value,l=Sr();c.forEach((function(e){if(!a.has(e)){var n=ti(t.get(e),r.get(e));null!==n&&l.set(e,n),a=a.add(e)}})),u.push(n.documentOverlayCache.saveOverlays(e,s,l))};o.hasNext();)s();return Re.waitFor(u)})).next((function(){return r}))}},{key:"recalculateAndSaveOverlaysForDocumentKeys",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next((function(t){return n.recalculateAndSaveOverlays(e,t)}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){return function(e){return me.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):or(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}},{key:"getNextDocuments",value:function(e,t,n,r){var i=this;return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((function(a){var u=r-a.size>0?i.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-a.size):Re.resolve(Er()),o=-1,s=a;return u.next((function(t){return Re.forEach(t,(function(t,n){return o<n.largestBatchId&&(o=n.largestBatchId),a.get(t)?Re.resolve():i.remoteDocumentCache.getEntry(e,t).next((function(e){s=s.insert(t,e)}))})).next((function(){return i.populateOverlays(e,t,a)})).next((function(){return i.computeViews(e,s,t,Nr())})).next((function(e){return{batchId:o,changes:Zr(e)}}))}))}))}},{key:"getDocumentsMatchingDocumentQuery",value:function(e,t){return this.getDocument(e,new me(t)).next((function(e){var t=Tr();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}},{key:"getDocumentsMatchingCollectionGroupQuery",value:function(e,t,n,r){var i=this,a=t.collectionGroup,u=Tr();return this.indexManager.getCollectionParents(e,a).next((function(o){return Re.forEach(o,(function(o){var s=function(e,t){return new rr(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(a));return i.getDocumentsMatchingCollectionQuery(e,s,n,r).next((function(e){e.forEach((function(e,t){u=u.insert(e,t)}))}))})).next((function(){return u}))}))}},{key:"getDocumentsMatchingCollectionQuery",value:function(e,t,n,r){var i,a=this;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((function(u){return i=u,a.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)})).next((function(e){i.forEach((function(t,n){var r=n.getKey();null===e.get(r)&&(e=e.insert(r,_n.newInvalidDocument(r)))}));var n=Tr();return e.forEach((function(e,r){var a=i.get(e);void 0!==a&&ri(a.mutation,r,Ft.empty(),he.now()),mr(t,r)&&(n=n.insert(e,r))})),n}))}}]),e}(),Ku=function(){function e(t){(0,y.Z)(this,e),this.serializer=t,this.hr=new Map,this.Pr=new Map}return(0,m.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return Re.resolve(this.hr.get(t))}},{key:"saveBundleMetadata",value:function(e,t){return this.hr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Ki(e.createTime)}}(t)),Re.resolve()}},{key:"getNamedQuery",value:function(e,t){return Re.resolve(this.Pr.get(t))}},{key:"saveNamedQuery",value:function(e,t){return this.Pr.set(t.name,function(e){return{name:e.name,query:Ca(e.bundledQuery),readTime:Ki(e.readTime)}}(t)),Re.resolve()}}]),e}(),Qu=function(){function e(){(0,y.Z)(this,e),this.overlays=new Dt(me.comparator),this.Ir=new Map}return(0,m.Z)(e,[{key:"getOverlay",value:function(e,t){return Re.resolve(this.overlays.get(t))}},{key:"getOverlays",value:function(e,t){var n=this,r=Er();return Re.forEach(t,(function(t){return n.getOverlay(e,t).next((function(e){null!==e&&r.set(t,e)}))})).next((function(){return r}))}},{key:"saveOverlays",value:function(e,t,n){var r=this;return n.forEach((function(n,i){r.ht(e,t,i)})),Re.resolve()}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,i=this.Ir.get(n);return void 0!==i&&(i.forEach((function(e){return r.overlays=r.overlays.remove(e)})),this.Ir.delete(n)),Re.resolve()}},{key:"getOverlaysForCollection",value:function(e,t,n){for(var r=Er(),i=t.length+1,a=new me(t.child("")),u=this.overlays.getIteratorFrom(a);u.hasNext();){var o=u.getNext().value,s=o.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&o.largestBatchId>n&&r.set(o.getKey(),o)}return Re.resolve(r)}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){for(var i=new Dt((function(e,t){return e-t})),a=this.overlays.getIterator();a.hasNext();){var u=a.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>n){var o=i.get(u.largestBatchId);null===o&&(o=Er(),i=i.insert(u.largestBatchId,o)),o.set(u.getKey(),u)}}for(var s=Er(),c=i.getIterator();c.hasNext()&&(c.getNext().value.forEach((function(e,t){return s.set(e,t)})),!(s.size()>=r)););return Re.resolve(s)}},{key:"ht",value:function(e,t,n){var r=this.overlays.get(n.key);if(null!==r){var i=this.Ir.get(r.largestBatchId).delete(n.key);this.Ir.set(r.largestBatchId,i)}this.overlays=this.overlays.insert(n.key,new mi(t,n));var a=this.Ir.get(t);void 0===a&&(a=Nr(),this.Ir.set(t,a)),this.Ir.set(t,a.add(n.key))}}]),e}(),Hu=function(){function e(){(0,y.Z)(this,e),this.sessionToken=qt.EMPTY_BYTE_STRING}return(0,m.Z)(e,[{key:"getSessionToken",value:function(e){return Re.resolve(this.sessionToken)}},{key:"setSessionToken",value:function(e,t){return this.sessionToken=t,Re.resolve()}}]),e}(),Wu=function(){function e(){(0,y.Z)(this,e),this.Tr=new Mt(Ju.Er),this.dr=new Mt(Ju.Ar)}return(0,m.Z)(e,[{key:"isEmpty",value:function(){return this.Tr.isEmpty()}},{key:"addReference",value:function(e,t){var n=new Ju(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}},{key:"Rr",value:function(e,t){var n=this;e.forEach((function(e){return n.addReference(e,t)}))}},{key:"removeReference",value:function(e,t){this.Vr(new Ju(e,t))}},{key:"mr",value:function(e,t){var n=this;e.forEach((function(e){return n.removeReference(e,t)}))}},{key:"gr",value:function(e){var t=this,n=new me(new ve([])),r=new Ju(n,e),i=new Ju(n,e+1),a=[];return this.dr.forEachInRange([r,i],(function(e){t.Vr(e),a.push(e.key)})),a}},{key:"pr",value:function(){var e=this;this.Tr.forEach((function(t){return e.Vr(t)}))}},{key:"Vr",value:function(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}},{key:"yr",value:function(e){var t=new me(new ve([])),n=new Ju(t,e),r=new Ju(t,e+1),i=Nr();return this.dr.forEachInRange([n,r],(function(e){i=i.add(e.key)})),i}},{key:"containsKey",value:function(e){var t=new Ju(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),Ju=function(){function e(t,n){(0,y.Z)(this,e),this.key=t,this.wr=n}return(0,m.Z)(e,null,[{key:"Er",value:function(e,t){return me.comparator(e.key,t.key)||se(e.wr,t.wr)}},{key:"Ar",value:function(e,t){return se(e.wr,t.wr)||me.comparator(e.key,t.key)}}]),e}(),Yu=function(){function e(t,n){(0,y.Z)(this,e),this.indexManager=t,this.referenceDelegate=n,this.mutationQueue=[],this.Sr=1,this.br=new Mt(Ju.Er)}return(0,m.Z)(e,[{key:"checkEmpty",value:function(e){return Re.resolve(0===this.mutationQueue.length)}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];var a=new pi(i,t,n,r);this.mutationQueue.push(a);var u,o=(0,l.Z)(r);try{for(o.s();!(u=o.n()).done;){var s=u.value;this.br=this.br.add(new Ju(s.key,i)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast())}}catch(c){o.e(c)}finally{o.f()}return Re.resolve(a)}},{key:"lookupMutationBatch",value:function(e,t){return Re.resolve(this.Dr(t))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=t+1,r=this.vr(n),i=r<0?0:r;return Re.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return Re.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}},{key:"getAllMutationBatches",value:function(e){return Re.resolve(this.mutationQueue.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=new Ju(t,0),i=new Ju(t,Number.POSITIVE_INFINITY),a=[];return this.br.forEachInRange([r,i],(function(e){var t=n.Dr(e.wr);a.push(t)})),Re.resolve(a)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Mt(se);return t.forEach((function(e){var t=new Ju(e,0),i=new Ju(e,Number.POSITIVE_INFINITY);n.br.forEachInRange([t,i],(function(e){r=r.add(e.wr)}))})),Re.resolve(this.Cr(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=t.path,r=n.length+1,i=n;me.isDocumentKey(i)||(i=i.child(""));var a=new Ju(new me(i),0),u=new Mt(se);return this.br.forEachWhile((function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(u=u.add(e.wr)),!0)}),a),Re.resolve(this.Cr(u))}},{key:"Cr",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t.Dr(e);null!==r&&n.push(r)})),n}},{key:"removeMutationBatch",value:function(e,t){var n=this;G(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();var r=this.br;return Re.forEach(t.mutations,(function(i){var a=new Ju(i.key,t.batchId);return r=r.delete(a),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((function(){n.br=r}))}},{key:"On",value:function(e){}},{key:"containsKey",value:function(e,t){var n=new Ju(t,0),r=this.br.firstAfterOrEqual(n);return Re.resolve(t.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(e){return this.mutationQueue.length,Re.resolve()}},{key:"Fr",value:function(e,t){return this.vr(e)}},{key:"vr",value:function(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}},{key:"Dr",value:function(e){var t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}]),e}(),Xu=function(){function e(t){(0,y.Z)(this,e),this.Mr=t,this.docs=new Dt(me.comparator),this.size=0}return(0,m.Z)(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t){var n=t.key,r=this.docs.get(n),i=r?r.size:0,a=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}},{key:"removeEntry",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function(e,t){var n=this.docs.get(t);return Re.resolve(n?n.document.mutableCopy():_n.newInvalidDocument(t))}},{key:"getEntries",value:function(e,t){var n=this,r=Ir();return t.forEach((function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():_n.newInvalidDocument(e))})),Re.resolve(r)}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){for(var i=Ir(),a=t.path,u=new me(a.child("")),o=this.docs.getIteratorFrom(u);o.hasNext();){var s=o.getNext(),c=s.key,l=s.value.document;if(!a.isPrefixOf(c.path))break;c.path.length>a.length+1||Se(Ze(l),n)<=0||(r.has(l.key)||mr(t,l))&&(i=i.insert(l.key,l.mutableCopy()))}return Re.resolve(i)}},{key:"getAllFromCollectionGroup",value:function(e,t,n,r){j()}},{key:"Or",value:function(e,t){return Re.forEach(this.docs,(function(e){return t(e)}))}},{key:"newChangeBuffer",value:function(e){return new $u(this)}},{key:"getSize",value:function(e){return Re.resolve(this.size)}}]),e}(),$u=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).cr=e,r}return(0,m.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[];return this.changes.forEach((function(r,i){i.isValidDocument()?n.push(t.cr.addEntry(e,i)):t.cr.removeEntry(r)})),Re.waitFor(n)}},{key:"getFromCache",value:function(e,t){return this.cr.getEntry(e,t)}},{key:"getAllFromCache",value:function(e,t){return this.cr.getEntries(e,t)}}]),n}(Ou),eo=function(){function e(t){(0,y.Z)(this,e),this.persistence=t,this.Nr=new br((function(e){return Yn(e)}),Xn),this.lastRemoteSnapshotVersion=fe.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Wu,this.targetCount=0,this.kr=Iu.Bn()}return(0,m.Z)(e,[{key:"forEachTarget",value:function(e,t){return this.Nr.forEach((function(e,n){return t(n)})),Re.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(e){return Re.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(e){return Re.resolve(this.Lr)}},{key:"allocateTargetId",value:function(e){return this.highestTargetId=this.kr.next(),Re.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),Re.resolve()}},{key:"Kn",value:function(e){this.Nr.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.kr=new Iu(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}},{key:"addTargetData",value:function(e,t){return this.Kn(t),this.targetCount+=1,Re.resolve()}},{key:"updateTargetData",value:function(e,t){return this.Kn(t),Re.resolve()}},{key:"removeTargetData",value:function(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,Re.resolve()}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return this.Nr.forEach((function(u,o){o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r.Nr.delete(u),a.push(r.removeMatchingKeysForTargetId(e,o.targetId)),i++)})),Re.waitFor(a).next((function(){return i}))}},{key:"getTargetCount",value:function(e){return Re.resolve(this.targetCount)}},{key:"getTargetData",value:function(e,t){var n=this.Nr.get(t)||null;return Re.resolve(n)}},{key:"addMatchingKeys",value:function(e,t,n){return this.Br.Rr(t,n),Re.resolve()}},{key:"removeMatchingKeys",value:function(e,t,n){this.Br.mr(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((function(t){i.push(r.markPotentiallyOrphaned(e,t))})),Re.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function(e,t){return this.Br.gr(t),Re.resolve()}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=this.Br.yr(t);return Re.resolve(n)}},{key:"containsKey",value:function(e,t){return Re.resolve(this.Br.containsKey(t))}}]),e}(),to=function(){function e(t,n){var r=this;(0,y.Z)(this,e),this.qr={},this.overlays={},this.Qr=new Ke(0),this.Kr=!1,this.Kr=!0,this.$r=new Hu,this.referenceDelegate=t(this),this.Ur=new eo(this),this.indexManager=new au,this.remoteDocumentCache=function(e){return new Xu(e)}((function(e){return r.referenceDelegate.Wr(e)})),this.serializer=new ba(n),this.Gr=new Ku(this.serializer)}return(0,m.Z)(e,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.Kr=!1,Promise.resolve()}},{key:"started",get:function(){return this.Kr}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(e){return this.indexManager}},{key:"getDocumentOverlayCache",value:function(e){var t=this.overlays[e.toKey()];return t||(t=new Qu,this.overlays[e.toKey()]=t),t}},{key:"getMutationQueue",value:function(e,t){var n=this.qr[e.toKey()];return n||(n=new Yu(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}},{key:"getGlobalsCache",value:function(){return this.$r}},{key:"getTargetCache",value:function(){return this.Ur}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getBundleCache",value:function(){return this.Gr}},{key:"runTransaction",value:function(e,t,n){var r=this;q("MemoryPersistence","Starting transaction:",e);var i=new no(this.Qr.next());return this.referenceDelegate.zr(),n(i).next((function(e){return r.referenceDelegate.jr(i).next((function(){return e}))})).toPromise().then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"Hr",value:function(e,t){return Re.or(Object.values(this.qr).map((function(n){return function(){return n.containsKey(e,t)}})))}}]),e}(),no=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).currentSequenceNumber=e,r}return(0,m.Z)(n)}(Ae),ro=function(){function e(t){(0,y.Z)(this,e),this.persistence=t,this.Jr=new Wu,this.Yr=null}return(0,m.Z)(e,[{key:"Xr",get:function(){if(this.Yr)return this.Yr;throw j()}},{key:"addReference",value:function(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),Re.resolve()}},{key:"removeReference",value:function(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),Re.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.Xr.add(t.toString()),Re.resolve()}},{key:"removeTarget",value:function(e,t){var n=this;this.Jr.gr(t.targetId).forEach((function(e){return n.Xr.add(e.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((function(e){e.forEach((function(e){return n.Xr.add(e.toString())}))})).next((function(){return r.removeTargetData(e,t)}))}},{key:"zr",value:function(){this.Yr=new Set}},{key:"jr",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Re.forEach(this.Xr,(function(r){var i=me.fromPath(r);return t.ei(e,i).next((function(e){e||n.removeEntry(i,fe.min())}))})).next((function(){return t.Yr=null,n.apply(e)}))}},{key:"updateLimboDocument",value:function(e,t){var n=this;return this.ei(e,t).next((function(e){e?n.Xr.delete(t.toString()):n.Xr.add(t.toString())}))}},{key:"Wr",value:function(e){return 0}},{key:"ei",value:function(e,t){var n=this;return Re.or([function(){return Re.resolve(n.Jr.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Hr(e,t)}])}}],[{key:"Zr",value:function(t){return new e(t)}}]),e}(),io=function(){function e(t,n){(0,y.Z)(this,e),this.persistence=t,this.ti=new br((function(e){return Je(e.path)}),(function(e,t){return e.isEqual(t)})),this.garbageCollector=Nu(this,n)}return(0,m.Z)(e,[{key:"zr",value:function(){}},{key:"jr",value:function(e){return Re.resolve()}},{key:"forEachTarget",value:function(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}},{key:"Yn",value:function(e){var t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next((function(e){return t.next((function(t){return e+t}))}))}},{key:"er",value:function(e){var t=0;return this.Zn(e,(function(e){t++})).next((function(){return t}))}},{key:"Zn",value:function(e,t){var n=this;return Re.forEach(this.ti,(function(r,i){return n.nr(e,r,i).next((function(e){return e?Re.resolve():t(i)}))}))}},{key:"removeTargets",value:function(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}},{key:"removeOrphanedDocuments",value:function(e,t){var n=this,r=0,i=this.persistence.getRemoteDocumentCache(),a=i.newChangeBuffer();return i.Or(e,(function(i){return n.nr(e,i,t).next((function(e){e||(r++,a.removeEntry(i,fe.min()))}))})).next((function(){return a.apply(e)})).next((function(){return r}))}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.ti.set(t,e.currentSequenceNumber),Re.resolve()}},{key:"removeTarget",value:function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}},{key:"addReference",value:function(e,t,n){return this.ti.set(n,e.currentSequenceNumber),Re.resolve()}},{key:"removeReference",value:function(e,t,n){return this.ti.set(n,e.currentSequenceNumber),Re.resolve()}},{key:"updateLimboDocument",value:function(e,t){return this.ti.set(t,e.currentSequenceNumber),Re.resolve()}},{key:"Wr",value:function(e){var t=e.key.toString().length;return e.isFoundDocument()&&(t+=on(e.data.value)),t}},{key:"nr",value:function(e,t,n){var r=this;return Re.or([function(){return r.persistence.Hr(e,t)},function(){return r.persistence.getTargetCache().containsKey(e,t)},function(){var e=r.ti.get(t);return Re.resolve(void 0!==e&&e>n)}])}},{key:"getCacheSize",value:function(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}],[{key:"Zr",value:function(t,n){return new e(t,n)}}]),e}(),ao=function(){function e(t){(0,y.Z)(this,e),this.serializer=t}return(0,m.Z)(e,[{key:"O",value:function(e,t,n,r){var i=this,a=new Me("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",et,{unique:!0}),e.createObjectStore("documentMutations")}(e),uo(e),function(e){e.createObjectStore("remoteDocuments")}(e));var u=Re.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),uo(e)),u=u.next((function(){return function(e){var t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:fe.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(a)}))),n<4&&r>=4&&(0!==n&&(u=u.next((function(){return function(e,t){return t.store("mutations").U().next((function(n){e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",et,{unique:!0});var r=t.store("mutations"),i=n.map((function(e){return r.put(e)}));return Re.waitFor(i)}))}(e,a)}))),u=u.next((function(){!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(u=u.next((function(){return i.ni(a)}))),n<6&&r>=6&&(u=u.next((function(){return function(e){e.createObjectStore("remoteDocumentGlobal")}(e),i.ri(a)}))),n<7&&r>=7&&(u=u.next((function(){return i.ii(a)}))),n<8&&r>=8&&(u=u.next((function(){return i.si(e,a)}))),n<9&&r>=9&&(u=u.next((function(){!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(u=u.next((function(){return i.oi(a)}))),n<11&&r>=11&&(u=u.next((function(){!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(u=u.next((function(){!function(e){var t=e.createObjectStore("documentOverlays",{keyPath:pt});t.createIndex("collectionPathOverlayIndex",yt,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",mt,{unique:!1})}(e)}))),n<13&&r>=13&&(u=u.next((function(){return function(e){var t=e.createObjectStore("remoteDocumentsV14",{keyPath:it});t.createIndex("documentKeyIndex",at),t.createIndex("collectionGroupIndex",ut)}(e)})).next((function(){return i._i(e,a)})).next((function(){return e.deleteObjectStore("remoteDocuments")}))),n<14&&r>=14&&(u=u.next((function(){return i.ai(e,a)}))),n<15&&r>=15&&(u=u.next((function(){return function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:ht}).createIndex("sequenceNumberIndex",ft,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:dt}).createIndex("documentKeyIndex",vt,{unique:!1})}(e)}))),n<16&&r>=16&&(u=u.next((function(){t.objectStore("indexState").clear()})).next((function(){t.objectStore("indexEntries").clear()}))),n<17&&r>=17&&(u=u.next((function(){!function(e){e.createObjectStore("globals",{keyPath:"name"})}(e)}))),u}},{key:"ri",value:function(e){var t=0;return e.store("remoteDocuments").J((function(e,n){t+=mu(n)})).next((function(){var n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}},{key:"ni",value:function(e){var t=this,n=e.store("mutationQueues"),r=e.store("mutations");return n.U().next((function(n){return Re.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",i).next((function(r){return Re.forEach(r,(function(r){G(r.userId===n.userId);var i=Za(t.serializer,r);return yu(e,n.userId,i).next((function(){}))}))}))}))}))}},{key:"ii",value:function(e){var t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((function(e){var r=[];return n.J((function(n,i){var a=new ve(n),u=function(e){return[0,Je(e)]}(a);r.push(t.get(u).next((function(n){return n?Re.resolve():function(n){return t.put({targetId:0,path:Je(n),sequenceNumber:e.highestListenSequenceNumber})}(a)})))})).next((function(){return Re.waitFor(r)}))}))}},{key:"si",value:function(e,t){e.createObjectStore("collectionParents",{keyPath:lt});var n=t.store("collectionParents"),r=new uu,i=function(e){if(r.add(e)){var t=e.lastSegment(),i=e.popLast();return n.put({collectionId:t,parent:Je(i)})}};return t.store("remoteDocuments").J({H:!0},(function(e,t){var n=new ve(e);return i(n.popLast())})).next((function(){return t.store("documentMutations").J({H:!0},(function(e,t){var n=(0,s.Z)(e,3),r=(n[0],n[1]),a=(n[2],$e(r));return i(a.popLast())}))}))}},{key:"oi",value:function(e){var t=this,n=e.store("targets");return n.J((function(e,r){var i=Ea(r),a=Sa(t.serializer,i);return n.put(a)}))}},{key:"_i",value:function(e,t){var n=t.store("remoteDocuments"),r=[];return n.J((function(e,n){var i=t.store("remoteDocumentsV14"),a=function(e){return e.document?new me(ve.fromString(e.document.name).popFirst(5)):e.noDocument?me.fromSegments(e.noDocument.path):e.unknownDocument?me.fromSegments(e.unknownDocument.path):j()}(n).path.toArray(),u={prefixPath:a.slice(0,a.length-2),collectionGroup:a[a.length-2],documentId:a[a.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(u))})).next((function(){return Re.waitFor(r)}))}},{key:"ai",value:function(e,t){var n=this,r=t.store("mutations"),i=Fu(this.serializer),a=new to(ro.Zr,this.serializer.ct);return r.U().next((function(e){var r=new Map;return e.forEach((function(e){var t,i=null!==(t=r.get(e.userId))&&void 0!==t?t:Nr();Za(n.serializer,e).keys().forEach((function(e){return i=i.add(e)})),r.set(e.userId,i)})),Re.forEach(r,(function(e,r){var u=new O(r),o=Pa.lt(n.serializer,u),s=a.getIndexManager(u),c=gu.lt(u,n.serializer,s,a.referenceDelegate);return new Gu(i,c,o,s).recalculateAndSaveOverlaysForDocumentKeys(new Tt(t,Ke.oe),e).next()}))}))}}]),e}();function uo(e){e.createObjectStore("targetDocuments",{keyPath:st}).createIndex("documentTargetsIndex",ct,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",ot,{unique:!0}),e.createObjectStore("targetGlobal")}var oo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",so=function(){function e(t,n,r,i,a,u,o,s,c,l){var h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:17;if((0,y.Z)(this,e),this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.ui=a,this.window=u,this.document=o,this.ci=c,this.li=l,this.hi=h,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=function(e){return Promise.resolve()},!e.D())throw new W(H.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ru(this,i),this.Ai=n+"main",this.serializer=new ba(s),this.Ri=new Oe(this.Ai,this.hi,new ao(this.serializer)),this.$r=new La,this.Ur=new _u(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Fu(this.serializer),this.Gr=new Ra,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,!1===l&&U("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return(0,m.Z)(e,[{key:"start",value:function(){var e=this;return this.mi().then((function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new W(H.FAILED_PRECONDITION,oo);return e.fi(),e.gi(),e.pi(),e.runTransaction("getHighestListenSequenceNumber","readonly",(function(t){return e.Ur.getHighestSequenceNumber(t)}))})).then((function(t){e.Qr=new Ke(t,e.ci)})).then((function(){e.Kr=!0})).catch((function(t){return e.Ri&&e.Ri.close(),Promise.reject(t)}))}},{key:"yi",value:function(e){var t=this;return this.di=function(){var n=(0,f.Z)((0,h.Z)().mark((function n(r){return(0,h.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.started){n.next=2;break}return n.abrupt("return",e(r));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e(this.isPrimary)}},{key:"setDatabaseDeletedListener",value:function(e){this.Ri.L(function(){var t=(0,f.Z)((0,h.Z)().mark((function t(n){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=null===n.newVersion,!t.t0){t.next=4;break}return t.next=4,e();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"setNetworkEnabled",value:function(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget((0,f.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.started,!e.t0){e.next=4;break}return e.next=4,t.mi();case 4:case"end":return e.stop()}}),e)})))))}},{key:"mi",value:function(){var e=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(t){return lo(t).put({clientId:e.clientId,updateTimeMs:Date.now(),networkEnabled:e.networkEnabled,inForeground:e.inForeground}).next((function(){if(e.isPrimary)return e.wi(t).next((function(t){t||(e.isPrimary=!1,e.ui.enqueueRetryable((function(){return e.di(!1)})))}))})).next((function(){return e.Si(t)})).next((function(n){return e.isPrimary&&!n?e.bi(t).next((function(){return!1})):!!n&&e.Di(t).next((function(){return!0}))}))})).catch((function(t){if(Ve(t))return q("IndexedDbPersistence","Failed to extend owner lease: ",t),e.isPrimary;if(!e.allowTabSynchronization)throw t;return q("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((function(t){e.isPrimary!==t&&e.ui.enqueueRetryable((function(){return e.di(t)})),e.isPrimary=t}))}},{key:"wi",value:function(e){var t=this;return co(e).get("owner").next((function(e){return Re.resolve(t.vi(e))}))}},{key:"Ci",value:function(e){return lo(e).delete(this.clientId)}},{key:"Fi",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){var t,n,r,i,a=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrimary||this.Mi(this.Ei,18e5)){e.next=6;break}return this.Ei=Date.now(),e.next=4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var t=Zt(e,"clientMetadata");return t.U().next((function(e){var n=a.xi(e,18e5),r=e.filter((function(e){return-1===n.indexOf(e)}));return Re.forEach(r,(function(e){return t.delete(e.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}));case 4:if(t=e.sent,this.Vi){n=(0,l.Z)(t);try{for(n.s();!(r=n.n()).done;)i=r.value,this.Vi.removeItem(this.Oi(i.clientId))}catch(u){n.e(u)}finally{n.f()}}case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pi",value:function(){var e=this;this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return e.mi().then((function(){return e.Fi()})).then((function(){return e.pi()}))}))}},{key:"vi",value:function(e){return!!e&&e.ownerId===this.clientId}},{key:"Si",value:function(e){var t=this;return this.li?Re.resolve(!0):co(e).get("owner").next((function(n){if(null!==n&&t.Mi(n.leaseTimestampMs,5e3)&&!t.Ni(n.ownerId)){if(t.vi(n)&&t.networkEnabled)return!0;if(!t.vi(n)){if(!n.allowTabSynchronization)throw new W(H.FAILED_PRECONDITION,oo);return!1}}return!(!t.networkEnabled||!t.inForeground)||lo(e).U().next((function(e){return void 0===t.xi(e,5e3).find((function(e){if(t.clientId!==e.clientId){var n=!t.networkEnabled&&e.networkEnabled,r=!t.inForeground&&e.inForeground,i=t.networkEnabled===e.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(e){return t.isPrimary!==e&&q("IndexedDbPersistence","Client ".concat(e?"is":"is not"," eligible for a primary lease.")),e}))}},{key:"shutdown",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){var t=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),e.next=7,this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(function(e){var n=new Tt(e,Ke.oe);return t.bi(n).next((function(){return t.Ci(n)}))}));case 7:this.Ri.close(),this.qi();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"xi",value:function(e,t){var n=this;return e.filter((function(e){return n.Mi(e.updateTimeMs,t)&&!n.Ni(e.clientId)}))}},{key:"Qi",value:function(){var e=this;return this.runTransaction("getActiveClients","readonly",(function(t){return lo(t).U().next((function(t){return e.xi(t,18e5).map((function(e){return e.clientId}))}))}))}},{key:"started",get:function(){return this.Kr}},{key:"getGlobalsCache",value:function(){return this.$r}},{key:"getMutationQueue",value:function(e,t){return gu.lt(e,this.serializer,t,this.referenceDelegate)}},{key:"getTargetCache",value:function(){return this.Ur}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getIndexManager",value:function(e){return new su(e,this.serializer.ct.databaseId)}},{key:"getDocumentOverlayCache",value:function(e){return Pa.lt(this.serializer,e)}},{key:"getBundleCache",value:function(){return this.Gr}},{key:"runTransaction",value:function(e,t,n){var r=this;q("IndexedDbPersistence","Starting transaction:",e);var i,a="readonly"===t?"readonly":"readwrite",u=function(e){return 17===e?_t:16===e?It:15===e?xt:14===e?bt:13===e?wt:12===e?kt:11===e?gt:void j()}(this.hi);return this.Ri.runTransaction(e,a,u,(function(a){return i=new Tt(a,r.Qr?r.Qr.next():Ke.oe),"readwrite-primary"===t?r.wi(i).next((function(e){return!!e||r.Si(i)})).next((function(t){if(!t)throw U("Failed to obtain primary lease for action '".concat(e,"'.")),r.isPrimary=!1,r.ui.enqueueRetryable((function(){return r.di(!1)})),new W(H.FAILED_PRECONDITION,Ce);return n(i)})).next((function(e){return r.Di(i).next((function(){return e}))})):r.Ki(i).next((function(){return n(i)}))})).then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"Ki",value:function(e){var t=this;return co(e).get("owner").next((function(e){if(null!==e&&t.Mi(e.leaseTimestampMs,5e3)&&!t.Ni(e.ownerId)&&!t.vi(e)&&!(t.li||t.allowTabSynchronization&&e.allowTabSynchronization))throw new W(H.FAILED_PRECONDITION,oo)}))}},{key:"Di",value:function(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return co(e).put("owner",t)}},{key:"bi",value:function(e){var t=this,n=co(e);return n.get("owner").next((function(e){return t.vi(e)?(q("IndexedDbPersistence","Releasing primary lease."),n.delete("owner")):Re.resolve()}))}},{key:"Mi",value:function(e,t){var n=Date.now();return!(e<n-t)&&(!(e>n)||(U("Detected an update time that is in the future: ".concat(e," > ").concat(n)),!1))}},{key:"fi",value:function(){var e=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ii=function(){e.ui.enqueueAndForget((function(){return e.inForeground="visible"===e.document.visibilityState,e.mi()}))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground="visible"===this.document.visibilityState)}},{key:"Bi",value:function(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}},{key:"gi",value:function(){var e,t=this;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Pi=function(){t.Li();var e=/(?:Version|Mobile)\/1[456]/;(0,b.G6)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&t.ui.enterRestrictedMode(!0),t.ui.enqueueAndForget((function(){return t.shutdown()}))},this.window.addEventListener("pagehide",this.Pi))}},{key:"ki",value:function(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}},{key:"Ni",value:function(e){var t;try{var n=null!==(null===(t=this.Vi)||void 0===t?void 0:t.getItem(this.Oi(e)));return q("IndexedDbPersistence","Client '".concat(e,"' ").concat(n?"is":"is not"," zombied in LocalStorage")),n}catch(e){return U("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}},{key:"Li",value:function(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){U("Failed to set zombie client id.",e)}}},{key:"qi",value:function(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch(e){}}},{key:"Oi",value:function(e){return"firestore_zombie_".concat(this.persistenceKey,"_").concat(e)}}],[{key:"D",value:function(){return Oe.D()}}]),e}();function co(e){return Zt(e,"owner")}function lo(e){return Zt(e,"clientMetadata")}function ho(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var fo=function(){function e(t,n,r,i){(0,y.Z)(this,e),this.targetId=t,this.fromCache=n,this.$i=r,this.Ui=i}return(0,m.Z)(e,null,[{key:"Wi",value:function(t,n){var r,i=Nr(),a=Nr(),u=(0,l.Z)(n.docChanges);try{for(u.s();!(r=u.n()).done;){var o=r.value;switch(o.type){case 0:i=i.add(o.doc.key);break;case 1:a=a.add(o.doc.key)}}}catch(s){u.e(s)}finally{u.f()}return new e(t,n.fromCache,i,a)}}]),e}(),vo=function(){function e(){(0,y.Z)(this,e),this._documentReadCount=0}return(0,m.Z)(e,[{key:"documentReadCount",get:function(){return this._documentReadCount}},{key:"incrementDocumentReadCount",value:function(e){this._documentReadCount+=e}}]),e}(),po=function(){function e(){(0,y.Z)(this,e),this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(0,b.G6)()?8:Pe((0,b.z$)())>0?6:4}return(0,m.Z)(e,[{key:"initialize",value:function(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var i=this,a={result:null};return this.Yi(e,t).next((function(e){a.result=e})).next((function(){if(!a.result)return i.Zi(e,t,r,n).next((function(e){a.result=e}))})).next((function(){if(!a.result){var n=new vo;return i.Xi(e,t,n).next((function(r){if(a.result=r,i.zi)return i.es(e,t,n,r.size)}))}})).next((function(){return a.result}))}},{key:"es",value:function(e,t,n,r){return n.documentReadCount<this.ji?(L()<=w.in.DEBUG&&q("QueryEngine","SDK will not create cache indexes for query:",yr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Re.resolve()):(L()<=w.in.DEBUG&&q("QueryEngine","Query:",yr(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Hi*r?(L()<=w.in.DEBUG&&q("QueryEngine","The SDK decides to create cache indexes for query:",yr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,cr(t))):Re.resolve())}},{key:"Yi",value:function(e,t){var n=this;if(ur(t))return Re.resolve(null);var r=cr(t);return this.indexManager.getIndexType(e,r).next((function(i){return 0===i?null:(null!==t.limit&&1===i&&(t=dr(t,null,"F"),r=cr(t)),n.indexManager.getDocumentsMatchingTarget(e,r).next((function(i){var a=Nr.apply(void 0,(0,p.Z)(i));return n.Ji.getDocuments(e,a).next((function(i){return n.indexManager.getMinOffset(e,r).next((function(r){var u=n.ts(t,i);return n.ns(t,u,a,r.readTime)?n.Yi(e,dr(t,null,"F")):n.rs(e,u,t,r)}))}))})))}))}},{key:"Zi",value:function(e,t,n,r){var i=this;return ur(t)||r.isEqual(fe.min())?Re.resolve(null):this.Ji.getDocuments(e,n).next((function(a){var u=i.ts(t,a);return i.ns(t,u,n,r)?Re.resolve(null):(L()<=w.in.DEBUG&&q("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),yr(t)),i.rs(e,u,t,Te(r,-1)).next((function(e){return e})))}))}},{key:"ts",value:function(e,t){var n=new Mt(kr(e));return t.forEach((function(t,r){mr(e,r)&&(n=n.add(r))})),n}},{key:"ns",value:function(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;var i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Xi",value:function(e,t,n){return L()<=w.in.DEBUG&&q("QueryEngine","Using full collection scan to execute query:",yr(t)),this.Ji.getDocumentsMatchingQuery(e,t,Ee.min(),n)}},{key:"rs",value:function(e,t,n,r){return this.Ji.getDocumentsMatchingQuery(e,n,r).next((function(e){return t.forEach((function(t){e=e.insert(t.key,t)})),e}))}}]),e}(),yo=function(){function e(t,n,r,i){(0,y.Z)(this,e),this.persistence=t,this.ss=n,this.serializer=i,this.os=new Dt(se),this._s=new br((function(e){return Yn(e)}),Xn),this.us=new Map,this.cs=t.getRemoteDocumentCache(),this.Ur=t.getTargetCache(),this.Gr=t.getBundleCache(),this.ls(r)}return(0,m.Z)(e,[{key:"ls",value:function(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Gu(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}},{key:"collectGarbage",value:function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return e.collect(n,t.os)}))}}]),e}();function mo(e,t,n,r){return new yo(e,t,n,r)}function go(e,t){return ko.apply(this,arguments)}function ko(){return(ko=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),e.next=3,r.persistence.runTransaction("Handle user change","readonly",(function(e){var t;return r.mutationQueue.getAllMutationBatches(e).next((function(i){return t=i,r.ls(n),r.mutationQueue.getAllMutationBatches(e)})).next((function(n){var i,a=[],u=[],o=Nr(),s=(0,l.Z)(t);try{for(s.s();!(i=s.n()).done;){var c=i.value;a.push(c.batchId);var h,f=(0,l.Z)(c.mutations);try{for(f.s();!(h=f.n()).done;){var d=h.value;o=o.add(d.key)}}catch(w){f.e(w)}finally{f.f()}}}catch(w){s.e(w)}finally{s.f()}var v,p=(0,l.Z)(n);try{for(p.s();!(v=p.n()).done;){var y=v.value;u.push(y.batchId);var m,g=(0,l.Z)(y.mutations);try{for(g.s();!(m=g.n()).done;){var k=m.value;o=o.add(k.key)}}catch(w){g.e(w)}finally{g.f()}}}catch(w){p.e(w)}finally{p.f()}return r.localDocuments.getDocuments(e,o).next((function(e){return{hs:e,removedBatchIds:a,addedBatchIds:u}}))}))}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wo(e,t){var n=Q(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(e){var r=t.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){var i=n.batch,a=i.keys(),u=Re.resolve();return a.forEach((function(e){u=u.next((function(){return r.getEntry(t,e)})).next((function(t){var a=n.docVersions.get(e);G(null!==a),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),u.next((function(){return e.mutationQueue.removeMutationBatch(t,i)}))}(n,e,t,i).next((function(){return i.apply(e)})).next((function(){return n.mutationQueue.performConsistencyCheck(e)})).next((function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)})).next((function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){for(var t=Nr(),n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))})).next((function(){return n.localDocuments.getDocuments(e,r)}))}))}function bo(e){var t=Q(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.Ur.getLastRemoteSnapshotVersion(e)}))}function xo(e,t){var n=Q(e),r=t.snapshotVersion,i=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(e){var a=n.cs.newChangeBuffer({trackRemovals:!0});i=n.os;var u=[];t.targetChanges.forEach((function(a,o){var s=i.get(o);if(s){u.push(n.Ur.removeMatchingKeys(e,a.removedDocuments,o).next((function(){return n.Ur.addMatchingKeys(e,a.addedDocuments,o)})));var c=s.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?c=c.withResumeToken(qt.EMPTY_BYTE_STRING,fe.min()).withLastLimboFreeSnapshotVersion(fe.min()):a.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(a.resumeToken,r)),i=i.insert(o,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(s,c,a)&&u.push(n.Ur.updateTargetData(e,c))}}));var o=Ir(),s=Nr();if(t.documentUpdates.forEach((function(r){t.resolvedLimboDocuments.has(r)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),u.push(Io(e,a,t.documentUpdates).next((function(e){o=e.Ps,s=e.Is}))),!r.isEqual(fe.min())){var c=n.Ur.getLastRemoteSnapshotVersion(e).next((function(t){return n.Ur.setTargetsMetadata(e,e.currentSequenceNumber,r)}));u.push(c)}return Re.waitFor(u).next((function(){return a.apply(e)})).next((function(){return n.localDocuments.getLocalViewOfDocuments(e,o,s)})).next((function(){return o}))})).then((function(e){return n.os=i,e}))}function Io(e,t,n){var r=Nr(),i=Nr();return n.forEach((function(e){return r=r.add(e)})),t.getEntries(e,r).next((function(e){var r=Ir();return n.forEach((function(n,a){var u=e.get(n);a.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(n)),a.isNoDocument()&&a.version.isEqual(fe.min())?(t.removeEntry(n,a.readTime),r=r.insert(n,a)):!u.isValidDocument()||a.version.compareTo(u.version)>0||0===a.version.compareTo(u.version)&&u.hasPendingWrites?(t.addEntry(a),r=r.insert(n,a)):q("LocalStore","Ignoring outdated watch update for ",n,". Current version:",u.version," Watch version:",a.version)})),{Ps:r,Is:i}}))}function _o(e,t){var n=Q(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(e){return void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)}))}function To(e,t){var n=Q(e);return n.persistence.runTransaction("Allocate target","readwrite",(function(e){var r;return n.Ur.getTargetData(e,t).next((function(i){return i?(r=i,Re.resolve(r)):n.Ur.allocateTargetId(e).next((function(i){return r=new wa(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Ur.addTargetData(e,r).next((function(){return r}))}))}))})).then((function(e){var r=n.os.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.os=n.os.insert(e.targetId,e),n._s.set(t,e.targetId)),e}))}function Zo(e,t,n){return Eo.apply(this,arguments)}function Eo(){return(Eo=(0,f.Z)((0,h.Z)().mark((function e(t,n,r){var i,a,u;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Q(t),a=i.os.get(n),u=r?"readwrite":"readwrite-primary",e.prev=1,e.t0=r,e.t0){e.next=6;break}return e.next=6,i.persistence.runTransaction("Release target",u,(function(e){return i.persistence.referenceDelegate.removeTarget(e,a)}));case 6:e.next=13;break;case 8:if(e.prev=8,e.t1=e.catch(1),Ve(e.t1)){e.next=12;break}throw e.t1;case 12:q("LocalStore","Failed to update sequence numbers for target ".concat(n,": ").concat(e.t1));case 13:i.os=i.os.remove(n),i._s.delete(a.target);case 14:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function So(e,t,n){var r=Q(e),i=fe.min(),a=Nr();return r.persistence.runTransaction("Execute query","readwrite",(function(e){return function(e,t,n){var r=Q(e),i=r._s.get(n);return void 0!==i?Re.resolve(r.os.get(i)):r.Ur.getTargetData(t,n)}(r,e,cr(t)).next((function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(e,t.targetId).next((function(e){a=e}))})).next((function(){return r.ss.getDocumentsMatchingQuery(e,t,n?i:fe.min(),n?a:Nr())})).next((function(e){return Do(r,gr(t),e),{documents:e,Ts:a}}))}))}function Co(e,t){var n=Q(e),r=Q(n.Ur),i=n.os.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(e){return r.ot(e,t).next((function(e){return e?e.target:null}))}))}function Ao(e,t){var n=Q(e),r=n.us.get(t)||fe.min();return n.persistence.runTransaction("Get new document changes","readonly",(function(e){return n.cs.getAllFromCollectionGroup(e,t,Te(r,-1),Number.MAX_SAFE_INTEGER)})).then((function(e){return Do(n,t,e),e}))}function Do(e,t,n){var r=e.us.get(t)||fe.min();n.forEach((function(e,t){t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.us.set(t,r)}function No(e,t,n,r){return Ro.apply(this,arguments)}function Ro(){return(Ro=(0,f.Z)((0,h.Z)().mark((function e(t,n,r,i){var a,u,o,s,c,f,d,v,p,y;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Q(t),u=Nr(),o=Ir(),s=(0,l.Z)(r);try{for(s.s();!(c=s.n()).done;)f=c.value,d=n.Es(f.metadata.name),f.document&&(u=u.add(d)),(v=n.ds(f)).setReadTime(n.As(f.metadata.readTime)),o=o.insert(d,v)}catch(h){s.e(h)}finally{s.f()}return p=a.cs.newChangeBuffer({trackRemovals:!0}),e.next=7,To(a,function(e){return cr(ar(ve.fromString("__bundle__/docs/".concat(e))))}(i));case 7:return y=e.sent,e.abrupt("return",a.persistence.runTransaction("Apply bundle documents","readwrite",(function(e){return Io(e,p,o).next((function(t){return p.apply(e),t})).next((function(t){return a.Ur.removeMatchingKeysForTargetId(e,y.targetId).next((function(){return a.Ur.addMatchingKeys(e,u,y.targetId)})).next((function(){return a.localDocuments.getLocalViewOfDocuments(e,t.Ps,t.Is)})).next((function(){return t.Ps}))}))})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Mo(e,t){return Oo.apply(this,arguments)}function Oo(){return Oo=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i,a,u=arguments;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]?u[2]:Nr(),e.next=3,To(t,cr(Ca(n.bundledQuery)));case 3:return i=e.sent,a=Q(t),e.abrupt("return",a.persistence.runTransaction("Save named query","readwrite",(function(e){var t=Ki(n.readTime);if(i.snapshotVersion.compareTo(t)>=0)return a.Gr.saveNamedQuery(e,n);var u=i.withResumeToken(qt.EMPTY_BYTE_STRING,t);return a.os=a.os.insert(u.targetId,u),a.Ur.updateTargetData(e,u).next((function(){return a.Ur.removeMatchingKeysForTargetId(e,i.targetId)})).next((function(){return a.Ur.addMatchingKeys(e,r,i.targetId)})).next((function(){return a.Gr.saveNamedQuery(e,n)}))})));case 6:case"end":return e.stop()}}),e)}))),Oo.apply(this,arguments)}function Po(e,t){return"firestore_clients_".concat(e,"_").concat(t)}function Fo(e,t,n){var r="firestore_mutations_".concat(e,"_").concat(n);return t.isAuthenticated()&&(r+="_".concat(t.uid)),r}function Lo(e,t){return"firestore_targets_".concat(e,"_").concat(t)}var Vo=function(){function e(t,n,r,i){(0,y.Z)(this,e),this.user=t,this.batchId=n,this.state=r,this.error=i}return(0,m.Z)(e,[{key:"Vs",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Rs",value:function(t,n,r){var i,a=JSON.parse(r),u="object"==typeof a&&-1!==["pending","acknowledged","rejected"].indexOf(a.state)&&(void 0===a.error||"object"==typeof a.error);return u&&a.error&&((u="string"==typeof a.error.message&&"string"==typeof a.error.code)&&(i=new W(a.error.code,a.error.message))),u?new e(t,n,a.state,i):(U("SharedClientState","Failed to parse mutation state for ID '".concat(n,"': ").concat(r)),null)}}]),e}(),qo=function(){function e(t,n,r){(0,y.Z)(this,e),this.targetId=t,this.state=n,this.error=r}return(0,m.Z)(e,[{key:"Vs",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Rs",value:function(t,n){var r,i=JSON.parse(n),a="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&((a="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new W(i.error.code,i.error.message))),a?new e(t,i.state,r):(U("SharedClientState","Failed to parse target state for ID '".concat(t,"': ").concat(n)),null)}}]),e}(),Uo=function(){function e(t,n){(0,y.Z)(this,e),this.clientId=t,this.activeTargetIds=n}return(0,m.Z)(e,null,[{key:"Rs",value:function(t,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,a=Mr(),u=0;i&&u<r.activeTargetIds.length;++u)i=We(r.activeTargetIds[u]),a=a.add(r.activeTargetIds[u]);return i?new e(t,a):(U("SharedClientState","Failed to parse client data for instance '".concat(t,"': ").concat(n)),null)}}]),e}(),Bo=function(){function e(t,n){(0,y.Z)(this,e),this.clientId=t,this.onlineState=n}return(0,m.Z)(e,null,[{key:"Rs",value:function(t){var n=JSON.parse(t);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new e(n.clientId,n.onlineState):(U("SharedClientState","Failed to parse online state: ".concat(t)),null)}}]),e}(),zo=function(){function e(){(0,y.Z)(this,e),this.activeTargetIds=Mr()}return(0,m.Z)(e,[{key:"fs",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"gs",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"Vs",value:function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]),e}(),jo=function(){function e(t,n,r,i,a){(0,y.Z)(this,e),this.window=t,this.ui=n,this.persistenceKey=r,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Dt(se),this.started=!1,this.bs=[];var u=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=a,this.Ds=Po(this.persistenceKey,this.ps),this.vs=function(e){return"firestore_sequence_number_".concat(e)}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new zo),this.Cs=new RegExp("^firestore_clients_".concat(u,"_([^_]*)$")),this.Fs=new RegExp("^firestore_mutations_".concat(u,"_(\\d+)(?:_(.*))?$")),this.Ms=new RegExp("^firestore_targets_".concat(u,"_(\\d+)$")),this.xs=function(e){return"firestore_online_state_".concat(e)}(this.persistenceKey),this.Os=function(e){return"firestore_bundle_loaded_v2_".concat(e)}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}return(0,m.Z)(e,[{key:"start",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){var t,n,r,i,a,u,o,s,c,f,d,v=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.syncEngine.Qi();case 2:t=e.sent,n=(0,l.Z)(t),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=14;break}if((i=r.value)!==this.ps){e.next=10;break}return e.abrupt("continue",12);case 10:(a=this.getItem(Po(this.persistenceKey,i)))&&(u=Uo.Rs(i,a))&&(this.Ss=this.Ss.insert(u.clientId,u));case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:this.Ns(),(o=this.storage.getItem(this.xs))&&(s=this.Ls(o))&&this.Bs(s),c=(0,l.Z)(this.bs);try{for(c.s();!(f=c.n()).done;)d=f.value,this.ws(d)}catch(h){c.e(h)}finally{c.f()}this.bs=[],this.window.addEventListener("pagehide",(function(){return v.shutdown()})),this.started=!0;case 28:case"end":return e.stop()}}),e,this,[[4,16,19,22]])})));return function(){return e.apply(this,arguments)}}()},{key:"writeSequenceNumber",value:function(e){this.setItem(this.vs,JSON.stringify(e))}},{key:"getAllActiveQueryTargets",value:function(){return this.ks(this.Ss)}},{key:"isActiveQueryTarget",value:function(e){var t=!1;return this.Ss.forEach((function(n,r){r.activeTargetIds.has(e)&&(t=!0)})),t}},{key:"addPendingMutation",value:function(e){this.qs(e,"pending")}},{key:"updateMutationState",value:function(e,t,n){this.qs(e,t,n),this.Qs(e)}},{key:"addLocalQueryTarget",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n="not-current";if(this.isActiveQueryTarget(e)){var r=this.storage.getItem(Lo(this.persistenceKey,e));if(r){var i=qo.Rs(e,r);i&&(n=i.state)}}return t&&this.Ks.fs(e),this.Ns(),n}},{key:"removeLocalQueryTarget",value:function(e){this.Ks.gs(e),this.Ns()}},{key:"isLocalQueryTarget",value:function(e){return this.Ks.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){this.removeItem(Lo(this.persistenceKey,e))}},{key:"updateQueryState",value:function(e,t,n){this.$s(e,t,n)}},{key:"handleUserChange",value:function(e,t,n){var r=this;t.forEach((function(e){r.Qs(e)})),this.currentUser=e,n.forEach((function(e){r.addPendingMutation(e)}))}},{key:"setOnlineState",value:function(e){this.Us(e)}},{key:"notifyBundleLoaded",value:function(e){this.Ws(e)}},{key:"shutdown",value:function(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}},{key:"getItem",value:function(e){var t=this.storage.getItem(e);return q("SharedClientState","READ",e,t),t}},{key:"setItem",value:function(e,t){q("SharedClientState","SET",e,t),this.storage.setItem(e,t)}},{key:"removeItem",value:function(e){q("SharedClientState","REMOVE",e),this.storage.removeItem(e)}},{key:"ws",value:function(e){var t=this,n=e;if(n.storageArea===this.storage){if(q("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Ds)return void U("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable((0,f.Z)((0,h.Z)().mark((function e(){var r,i,a,u,o,s,c;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.started){e.next=43;break}if(null===n.key){e.next=41;break}if(!t.Cs.test(n.key)){e.next=11;break}if(null!=n.newValue){e.next=6;break}return r=t.Gs(n.key),e.abrupt("return",t.zs(r,null));case 6:if(!(i=t.js(n.key,n.newValue))){e.next=9;break}return e.abrupt("return",t.zs(i.clientId,i));case 9:e.next=41;break;case 11:if(!t.Fs.test(n.key)){e.next=18;break}if(null===n.newValue){e.next=16;break}if(!(a=t.Hs(n.key,n.newValue))){e.next=16;break}return e.abrupt("return",t.Js(a));case 16:e.next=41;break;case 18:if(!t.Ms.test(n.key)){e.next=25;break}if(null===n.newValue){e.next=23;break}if(!(u=t.Ys(n.key,n.newValue))){e.next=23;break}return e.abrupt("return",t.Zs(u));case 23:e.next=41;break;case 25:if(n.key!==t.xs){e.next=32;break}if(null===n.newValue){e.next=30;break}if(!(o=t.Ls(n.newValue))){e.next=30;break}return e.abrupt("return",t.Bs(o));case 30:e.next=41;break;case 32:if(n.key!==t.vs){e.next=37;break}s=function(e){var t=Ke.oe;if(null!=e)try{var n=JSON.parse(e);G("number"==typeof n),t=n}catch(e){U("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(n.newValue),s!==Ke.oe&&t.sequenceNumberHandler(s),e.next=41;break;case 37:if(n.key!==t.Os){e.next=41;break}return c=t.Xs(n.newValue),e.next=41,Promise.all(c.map((function(e){return t.syncEngine.eo(e)})));case 41:e.next=44;break;case 43:t.bs.push(n);case 44:case"end":return e.stop()}}),e)}))))}}},{key:"Ks",get:function(){return this.Ss.get(this.ps)}},{key:"Ns",value:function(){this.setItem(this.Ds,this.Ks.Vs())}},{key:"qs",value:function(e,t,n){var r=new Vo(this.currentUser,e,t,n),i=Fo(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Vs())}},{key:"Qs",value:function(e){var t=Fo(this.persistenceKey,this.currentUser,e);this.removeItem(t)}},{key:"Us",value:function(e){var t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}},{key:"$s",value:function(e,t,n){var r=Lo(this.persistenceKey,e),i=new qo(e,t,n);this.setItem(r,i.Vs())}},{key:"Ws",value:function(e){var t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}},{key:"Gs",value:function(e){var t=this.Cs.exec(e);return t?t[1]:null}},{key:"js",value:function(e,t){var n=this.Gs(e);return Uo.Rs(n,t)}},{key:"Hs",value:function(e,t){var n=this.Fs.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Vo.Rs(new O(i),r,t)}},{key:"Ys",value:function(e,t){var n=this.Ms.exec(e),r=Number(n[1]);return qo.Rs(r,t)}},{key:"Ls",value:function(e){return Bo.Rs(e)}},{key:"Xs",value:function(e){return JSON.parse(e)}},{key:"Js",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.user.uid!==this.currentUser.uid){e.next=2;break}return e.abrupt("return",this.syncEngine.no(t.batchId,t.state,t.error));case 2:q("SharedClientState","Ignoring mutation for non-active user ".concat(t.user.uid));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"Zs",value:function(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}},{key:"zs",value:function(e,t){var n=this,r=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),a=this.ks(r),u=[],o=[];return a.forEach((function(e){i.has(e)||u.push(e)})),i.forEach((function(e){a.has(e)||o.push(e)})),this.syncEngine.io(u,o).then((function(){n.Ss=r}))}},{key:"Bs",value:function(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}},{key:"ks",value:function(e){var t=Mr();return e.forEach((function(e,n){t=t.unionWith(n.activeTargetIds)})),t}}],[{key:"D",value:function(e){return!(!e||!e.localStorage)}}]),e}(),Go=function(){function e(){(0,y.Z)(this,e),this.so=new zo,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return(0,m.Z)(e,[{key:"addPendingMutation",value:function(e){}},{key:"updateMutationState",value:function(e,t,n){}},{key:"addLocalQueryTarget",value:function(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.so.fs(e),this.oo[e]||"not-current"}},{key:"updateQueryState",value:function(e,t,n){this.oo[e]=t}},{key:"removeLocalQueryTarget",value:function(e){this.so.gs(e)}},{key:"isLocalQueryTarget",value:function(e){return this.so.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){delete this.oo[e]}},{key:"getAllActiveQueryTargets",value:function(){return this.so.activeTargetIds}},{key:"isActiveQueryTarget",value:function(e){return this.so.activeTargetIds.has(e)}},{key:"start",value:function(){return this.so=new zo,Promise.resolve()}},{key:"handleUserChange",value:function(e,t,n){}},{key:"setOnlineState",value:function(e){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(e){}},{key:"notifyBundleLoaded",value:function(e){}}]),e}(),Ko=function(){function e(){(0,y.Z)(this,e)}return(0,m.Z)(e,[{key:"_o",value:function(e){}},{key:"shutdown",value:function(){}}]),e}(),Qo=function(){function e(){var t=this;(0,y.Z)(this,e),this.ao=function(){return t.uo()},this.co=function(){return t.lo()},this.ho=[],this.Po()}return(0,m.Z)(e,[{key:"_o",value:function(e){this.ho.push(e)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}},{key:"Po",value:function(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}},{key:"uo",value:function(){q("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var e,t=(0,l.Z)(this.ho);try{for(t.s();!(e=t.n()).done;){(0,e.value)(0)}}catch(n){t.e(n)}finally{t.f()}}},{key:"lo",value:function(){q("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var e,t=(0,l.Z)(this.ho);try{for(t.s();!(e=t.n()).done;){(0,e.value)(1)}}catch(n){t.e(n)}finally{t.f()}}}],[{key:"D",value:function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),Ho=null;function Wo(){return null===Ho?Ho=268435456+Math.round(2147483648*Math.random()):Ho++,"0x"+Ho.toString(16)}var Jo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Yo=function(){function e(t){(0,y.Z)(this,e),this.Io=t.Io,this.To=t.To}return(0,m.Z)(e,[{key:"Eo",value:function(e){this.Ao=e}},{key:"Ro",value:function(e){this.Vo=e}},{key:"mo",value:function(e){this.fo=e}},{key:"onMessage",value:function(e){this.po=e}},{key:"close",value:function(){this.To()}},{key:"send",value:function(e){this.Io(e)}},{key:"yo",value:function(){this.Ao()}},{key:"wo",value:function(){this.Vo()}},{key:"So",value:function(e){this.fo(e)}},{key:"bo",value:function(e){this.po(e)}}]),e}(),Xo="WebChannelConnection",$o=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).forceLongPolling=e.forceLongPolling,r.autoDetectLongPolling=e.autoDetectLongPolling,r.useFetchStreams=e.useFetchStreams,r.longPollingOptions=e.longPollingOptions,r}return(0,m.Z)(n,[{key:"No",value:function(e,t,n,r){var i=Wo();return new Promise((function(a,u){var o=new _;o.setWithCredentials(!0),o.listenOnce(Z.COMPLETE,(function(){try{switch(o.getLastErrorCode()){case E.NO_ERROR:var t=o.getResponseJson();q(Xo,"XHR for RPC '".concat(e,"' ").concat(i," received:"),JSON.stringify(t)),a(t);break;case E.TIMEOUT:q(Xo,"RPC '".concat(e,"' ").concat(i," timed out")),u(new W(H.DEADLINE_EXCEEDED,"Request time out"));break;case E.HTTP_ERROR:var n=o.getStatus();if(q(Xo,"RPC '".concat(e,"' ").concat(i," failed with status:"),n,"response text:",o.getResponseText()),n>0){var r=o.getResponseJson();Array.isArray(r)&&(r=r[0]);var s=null==r?void 0:r.error;if(s&&s.status&&s.message){var c=function(e){var t=e.toLowerCase().replace(/_/g,"-");return Object.values(H).indexOf(t)>=0?t:H.UNKNOWN}(s.status);u(new W(c,s.message))}else u(new W(H.UNKNOWN,"Server responded with status "+o.getStatus()))}else u(new W(H.UNAVAILABLE,"Connection failed."));break;default:j()}}finally{q(Xo,"RPC '".concat(e,"' ").concat(i," completed."))}}));var s=JSON.stringify(r);q(Xo,"RPC '".concat(e,"' ").concat(i," sending request:"),r),o.send(t,"POST",s,n,15)}))}},{key:"Bo",value:function(e,t,n){var r=Wo(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=D(),u=A(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},s=this.longPollingOptions.timeoutSeconds;void 0!==s&&(o.longPollingTimeout=Math.round(1e3*s)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Oo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;var c=i.join("");q(Xo,"Creating RPC '".concat(e,"' stream ").concat(r,": ").concat(c),o);var l=a.createWebChannel(c,o),h=!1,f=!1,d=new Yo({Io:function(t){f?q(Xo,"Not sending because RPC '".concat(e,"' stream ").concat(r," is closed:"),t):(h||(q(Xo,"Opening RPC '".concat(e,"' stream ").concat(r," transport.")),l.open(),h=!0),q(Xo,"RPC '".concat(e,"' stream ").concat(r," sending:"),t),l.send(t))},To:function(){return l.close()}}),v=function(e,t,n){e.listen(t,(function(e){try{n(e)}catch(e){setTimeout((function(){throw e}),0)}}))};return v(l,T.EventType.OPEN,(function(){f||(q(Xo,"RPC '".concat(e,"' stream ").concat(r," transport opened.")),d.yo())})),v(l,T.EventType.CLOSE,(function(){f||(f=!0,q(Xo,"RPC '".concat(e,"' stream ").concat(r," transport closed")),d.So())})),v(l,T.EventType.ERROR,(function(t){f||(f=!0,B(Xo,"RPC '".concat(e,"' stream ").concat(r," transport errored:"),t),d.So(new W(H.UNAVAILABLE,"The operation could not be completed")))})),v(l,T.EventType.MESSAGE,(function(t){var n;if(!f){var i=t.data[0];G(!!i);var a=i,u=a.error||(null===(n=a[0])||void 0===n?void 0:n.error);if(u){q(Xo,"RPC '".concat(e,"' stream ").concat(r," received error:"),u);var o=u.status,s=function(e){var t=hi[e];if(void 0!==t)return bi(t)}(o),c=u.message;void 0===s&&(s=H.INTERNAL,c="Unknown error status: "+o+" with message "+u.message),f=!0,d.So(new W(s,c)),l.close()}else q(Xo,"RPC '".concat(e,"' stream ").concat(r," received:"),i),d.bo(i)}})),v(u,C.STAT_EVENT,(function(t){t.stat===S.PROXY?q(Xo,"RPC '".concat(e,"' stream ").concat(r," detected buffering proxy")):t.stat===S.NOPROXY&&q(Xo,"RPC '".concat(e,"' stream ").concat(r," detected no buffering proxy"))})),setTimeout((function(){d.wo()}),0),d}}]),n}(function(){function e(t){(0,y.Z)(this,e),this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo="projects/".concat(r,"/databases/").concat(i),this.Co="(default)"===this.databaseId.database?"project_id=".concat(r):"project_id=".concat(r,"&database_id=").concat(i)}return(0,m.Z)(e,[{key:"Fo",get:function(){return!1}},{key:"Mo",value:function(e,t,n,r,i){var a=Wo(),u=this.xo(e,t.toUriEncodedString());q("RestConnection","Sending RPC '".concat(e,"' ").concat(a,":"),u,n);var o={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(o,r,i),this.No(e,u,o,n).then((function(t){return q("RestConnection","Received RPC '".concat(e,"' ").concat(a,": "),t),t}),(function(t){throw B("RestConnection","RPC '".concat(e,"' ").concat(a," failed with error: "),t,"url: ",u,"request:",n),t}))}},{key:"Lo",value:function(e,t,n,r,i,a){return this.Mo(e,t,n,r,i)}},{key:"Oo",value:function(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+P,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((function(t,n){return e[n]=t})),n&&n.headers.forEach((function(t,n){return e[n]=t}))}},{key:"xo",value:function(e,t){var n=Jo[e];return"".concat(this.Do,"/v1/").concat(t,":").concat(n)}},{key:"terminate",value:function(){}}]),e}());function es(){return"undefined"!=typeof window?window:null}function ts(){return"undefined"!=typeof document?document:null}function ns(e){return new Ui(e,!0)}var rs=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;(0,y.Z)(this,e),this.ui=t,this.timerId=n,this.ko=r,this.qo=i,this.Qo=a,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}return(0,m.Z)(e,[{key:"reset",value:function(){this.Ko=0}},{key:"Wo",value:function(){this.Ko=this.Qo}},{key:"Go",value:function(e){var t=this;this.cancel();var n=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,n-r);i>0&&q("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.Ko," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,(function(){return t.Uo=Date.now(),e()})),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}},{key:"jo",value:function(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}},{key:"cancel",value:function(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}},{key:"zo",value:function(){return(Math.random()-.5)*this.Ko}}]),e}(),is=function(){function e(t,n,r,i,a,u,o,s){(0,y.Z)(this,e),this.ui=t,this.Ho=r,this.Jo=i,this.connection=a,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=o,this.listener=s,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new rs(t,n)}return(0,m.Z)(e,[{key:"n_",value:function(){return 1===this.state||5===this.state||this.r_()}},{key:"r_",value:function(){return 2===this.state||3===this.state}},{key:"start",value:function(){this.e_=0,4!==this.state?this.auth():this.i_()}},{key:"stop",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.n_(),!e.t0){e.next=4;break}return e.next=4,this.close(0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"s_",value:function(){this.state=0,this.t_.reset()}},{key:"o_",value:function(){var e=this;this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,(function(){return e.__()})))}},{key:"a_",value:function(e){this.u_(),this.stream.send(e)}},{key:"__",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.r_()){e.next=2;break}return e.abrupt("return",this.close(0));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"u_",value:function(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}},{key:"c_",value:function(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}},{key:"close",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t,n){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.u_(),this.c_(),this.t_.cancel(),this.Yo++,4!==t?this.t_.reset():n&&n.code===H.RESOURCE_EXHAUSTED?(U(n.toString()),U("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):n&&n.code===H.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.l_(),this.stream.close(),this.stream=null),this.state=t,e.next=9,this.listener.mo(n);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"l_",value:function(){}},{key:"auth",value:function(){var e=this;this.state=1;var t=this.h_(this.Yo),n=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((function(t){var r=(0,s.Z)(t,2),i=r[0],a=r[1];e.Yo===n&&e.P_(i,a)}),(function(n){t((function(){var t=new W(H.UNKNOWN,"Fetching auth token failed: "+n.message);return e.I_(t)}))}))}},{key:"P_",value:function(e,t){var n=this,r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo((function(){r((function(){return n.listener.Eo()}))})),this.stream.Ro((function(){r((function(){return n.state=2,n.Xo=n.ui.enqueueAfterDelay(n.Jo,1e4,(function(){return n.r_()&&(n.state=3),Promise.resolve()})),n.listener.Ro()}))})),this.stream.mo((function(e){r((function(){return n.I_(e)}))})),this.stream.onMessage((function(e){r((function(){return 1==++n.e_?n.E_(e):n.onNext(e)}))}))}},{key:"i_",value:function(){var e=this;this.state=5,this.t_.Go((0,f.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case"end":return t.stop()}}),t)}))))}},{key:"I_",value:function(e){return q("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}},{key:"h_",value:function(e){var t=this;return function(n){t.ui.enqueueAndForget((function(){return t.Yo===e?n():(q("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}}}]),e}(),as=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i,a,u,o){var s;return(0,y.Z)(this,n),(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,i,a,o)).serializer=u,s}return(0,m.Z)(n,[{key:"T_",value:function(e,t){return this.connection.Bo("Listen",e,t)}},{key:"E_",value:function(e){return this.onNext(e)}},{key:"onNext",value:function(e){this.t_.reset();var t=function(e,t){var n;if("targetChange"in t){t.targetChange;var r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:j()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],a=function(e,t){return e.useProto3Json?(G(void 0===t||"string"==typeof t),qt.fromBase64String(t||"")):(G(void 0===t||t instanceof Buffer||t instanceof Uint8Array),qt.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),u=t.targetChange.cause,o=u&&function(e){var t=void 0===e.code?H.UNKNOWN:bi(e.code);return new W(t,e.message||"")}(u);n=new Ri(r,i,a,o||null)}else if("documentChange"in t){t.documentChange;var s=t.documentChange;s.document,s.document.name,s.document.updateTime;var c=Yi(e,s.document.name),l=Ki(s.document.updateTime),h=s.document.createTime?Ki(s.document.createTime):fe.min(),f=new xn({mapValue:{fields:s.document.fields}}),d=_n.newFoundDocument(c,l,h,f),v=s.targetIds||[],p=s.removedTargetIds||[];n=new Di(v,p,d.key,d)}else if("documentDelete"in t){t.documentDelete;var y=t.documentDelete;y.document;var m=Yi(e,y.document),g=y.readTime?Ki(y.readTime):fe.min(),k=_n.newNoDocument(m,g),w=y.removedTargetIds||[];n=new Di([],w,k.key,k)}else if("documentRemove"in t){t.documentRemove;var b=t.documentRemove;b.document;var x=Yi(e,b.document),I=b.removedTargetIds||[];n=new Di([],I,x,null)}else{if(!("filter"in t))return j();t.filter;var _=t.filter;_.targetId;var T=_.count,Z=void 0===T?0:T,E=_.unchangedNames,S=new ki(Z,E),C=_.targetId;n=new Ni(C,S)}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return fe.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?fe.min():t.readTime?Ki(t.readTime):fe.min()}(e);return this.listener.d_(t,n)}},{key:"A_",value:function(e){var t={};t.database=ea(this.serializer),t.addTarget=function(e,t){var n,r=t.target;if((n=$n(r)?{documents:oa(e,r)}:{query:sa(e,r)._t}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=ji(e,t.resumeToken);var i=Bi(e,t.expectedCount);null!==i&&(n.expectedCount=i)}else if(t.snapshotVersion.compareTo(fe.min())>0){n.readTime=zi(e,t.snapshotVersion.toTimestamp());var a=Bi(e,t.expectedCount);null!==a&&(n.expectedCount=a)}return n}(this.serializer,e);var n=function(e,t){var n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return j()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.a_(t)}},{key:"R_",value:function(e){var t={};t.database=ea(this.serializer),t.removeTarget=e,this.a_(t)}}]),n}(is),us=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i,a,u,o){var s;return(0,y.Z)(this,n),(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,i,a,o)).serializer=u,s}return(0,m.Z)(n,[{key:"V_",get:function(){return this.e_>0}},{key:"start",value:function(){this.lastStreamToken=void 0,(0,u.Z)((0,o.Z)(n.prototype),"start",this).call(this)}},{key:"l_",value:function(){this.V_&&this.m_([])}},{key:"T_",value:function(e,t){return this.connection.Bo("Write",e,t)}},{key:"E_",value:function(e){return G(!!e.streamToken),this.lastStreamToken=e.streamToken,G(!e.writeResults||0===e.writeResults.length),this.listener.f_()}},{key:"onNext",value:function(e){G(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();var t=function(e,t){return e&&e.length>0?(G(void 0!==t),e.map((function(e){return function(e,t){var n=e.updateTime?Ki(e.updateTime):Ki(t);return n.isEqual(fe.min())&&(n=Ki(t)),new Yr(n,e.transformResults||[])}(e,t)}))):[]}(e.writeResults,e.commitTime),n=Ki(e.commitTime);return this.listener.g_(n,t)}},{key:"p_",value:function(){var e={};e.database=ea(this.serializer),this.a_(e)}},{key:"m_",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map((function(e){return aa(t.serializer,e)}))};this.a_(n)}}]),n}(is),os=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i,a){var u;return(0,y.Z)(this,n),(u=t.call(this)).authCredentials=e,u.appCheckCredentials=r,u.connection=i,u.serializer=a,u.y_=!1,u}return(0,m.Z)(n,[{key:"w_",value:function(){if(this.y_)throw new W(H.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"Mo",value:function(e,t,n,r){var i=this;return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(a){var u=(0,s.Z)(a,2),o=u[0],c=u[1];return i.connection.Mo(e,Hi(t,n),r,o,c)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===H.UNAUTHENTICATED&&(i.authCredentials.invalidateToken(),i.appCheckCredentials.invalidateToken()),e):new W(H.UNKNOWN,e.toString())}))}},{key:"Lo",value:function(e,t,n,r,i){var a=this;return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(u){var o=(0,s.Z)(u,2),c=o[0],l=o[1];return a.connection.Lo(e,Hi(t,n),r,c,l,i)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===H.UNAUTHENTICATED&&(a.authCredentials.invalidateToken(),a.appCheckCredentials.invalidateToken()),e):new W(H.UNKNOWN,e.toString())}))}},{key:"terminate",value:function(){this.y_=!0,this.connection.terminate()}}]),n}((0,m.Z)((function e(){(0,y.Z)(this,e)}))),ss=function(){function e(t,n){(0,y.Z)(this,e),this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}return(0,m.Z)(e,[{key:"v_",value:function(){var e=this;0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return e.b_=null,e.F_("Backend didn't respond within 10 seconds."),e.C_("Offline"),Promise.resolve()})))}},{key:"M_",value:function(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.C_("Offline")))}},{key:"set",value:function(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}},{key:"C_",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"F_",value:function(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.D_?(U(t),this.D_=!1):q("OnlineStateTracker",t)}},{key:"x_",value:function(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}]),e}(),cs=(0,m.Z)((function e(t,n,r,i,a){var u=this;(0,y.Z)(this,e),this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=a,this.k_._o((function(e){r.enqueueAndForget((0,f.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=ws(u),!e.t0){e.next=5;break}return q("RemoteStore","Restarting streams for network reachability change."),e.next=5,function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t){var n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=Q(t)).L_.add(4),e.next=4,fs(n);case 4:return n.q_.set("Unknown"),n.L_.delete(4),e.next=8,ls(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(u);case 5:case"end":return e.stop()}}),e)}))))})),this.q_=new ss(r,i)}));function ls(e){return hs.apply(this,arguments)}function hs(){return(hs=(0,f.Z)((0,h.Z)().mark((function e(t){var n,r,i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ws(t)){e.next=18;break}n=(0,l.Z)(t.B_),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return i=r.value,e.next=8,i(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,12,15,18]])})))).apply(this,arguments)}function fs(e){return ds.apply(this,arguments)}function ds(){return(ds=(0,f.Z)((0,h.Z)().mark((function e(t){var n,r,i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,l.Z)(t.B_),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,i(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})))).apply(this,arguments)}function vs(e,t){var n=Q(e);n.N_.has(t.targetId)||(n.N_.set(t.targetId,t),ks(n)?gs(n):Ys(n).r_()&&ys(n,t))}function ps(e,t){var n=Q(e),r=Ys(n);n.N_.delete(t),r.r_()&&ms(n,t),0===n.N_.size&&(r.r_()?r.o_():ws(n)&&n.q_.set("Unknown"))}function ys(e,t){if(e.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(fe.min())>0){var n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Ys(e).A_(t)}function ms(e,t){e.Q_.xe(t),Ys(e).R_(t)}function gs(e){e.Q_=new Oi({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},ot:function(t){return e.N_.get(t)||null},tt:function(){return e.datastore.serializer.databaseId}}),Ys(e).start(),e.q_.v_()}function ks(e){return ws(e)&&!Ys(e).n_()&&e.N_.size>0}function ws(e){return 0===Q(e).L_.size}function bs(e){e.Q_=void 0}function xs(e){return Is.apply(this,arguments)}function Is(){return(Is=(0,f.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.q_.set("Online");case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _s(e){return Ts.apply(this,arguments)}function Ts(){return(Ts=(0,f.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.N_.forEach((function(e,n){ys(t,e)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zs(e,t){return Es.apply(this,arguments)}function Es(){return(Es=(0,f.Z)((0,h.Z)().mark((function e(t,n){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:bs(t),ks(t)?(t.q_.M_(n),gs(t)):t.q_.set("Unknown");case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ss(e,t,n){return Cs.apply(this,arguments)}function Cs(){return Cs=(0,f.Z)((0,h.Z)().mark((function e(t,n,r){var i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.q_.set("Online"),!(n instanceof Ri&&2===n.state&&n.cause)){e.next=13;break}return e.prev=1,e.next=4,function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i,a,u;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.cause,i=(0,l.Z)(n.targetIds),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=14;break}if(u=a.value,e.t0=t.N_.has(u),!e.t0){e.next=12;break}return e.next=10,t.remoteSyncer.rejectListen(u,r);case 10:t.N_.delete(u),t.Q_.removeTarget(u);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(2),i.e(e.t1);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[2,16,19,22]])})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),q("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),e.t0),e.next=11,As(t,e.t0);case 11:case 22:e.next=29;break;case 13:if(n instanceof Di?t.Q_.Ke(n):n instanceof Ni?t.Q_.He(n):t.Q_.We(n),r.isEqual(fe.min())){e.next=29;break}return e.prev=14,e.next=17,bo(t.localStore);case 17:if(i=e.sent,e.t1=r.compareTo(i)>=0,!e.t1){e.next=22;break}return e.next=22,function(e,t){var n=e.Q_.rt(t);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.N_.get(r);i&&e.N_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((function(t,n){var r=e.N_.get(t);if(r){e.N_.set(t,r.withResumeToken(qt.EMPTY_BYTE_STRING,r.snapshotVersion)),ms(e,t);var i=new wa(r.target,t,n,r.sequenceNumber);ys(e,i)}})),e.remoteSyncer.applyRemoteEvent(n)}(t,r);case 24:return e.prev=24,e.t2=e.catch(14),q("RemoteStore","Failed to raise snapshot:",e.t2),e.next=29,As(t,e.t2);case 29:case"end":return e.stop()}}),e,null,[[1,6],[14,24]])}))),Cs.apply(this,arguments)}function As(e,t,n){return Ds.apply(this,arguments)}function Ds(){return(Ds=(0,f.Z)((0,h.Z)().mark((function e(t,n,r){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ve(n)){e.next=2;break}throw n;case 2:return t.L_.add(1),e.next=5,fs(t);case 5:t.q_.set("Offline"),r||(r=function(){return bo(t.localStore)}),t.asyncQueue.enqueueRetryable((0,f.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q("RemoteStore","Retrying IndexedDB access"),e.next=3,r();case 3:return t.L_.delete(1),e.next=6,ls(t);case 6:case"end":return e.stop()}}),e)}))));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ns(e,t){return t().catch((function(n){return As(e,n,t)}))}function Rs(e){return Ms.apply(this,arguments)}function Ms(){return(Ms=(0,f.Z)((0,h.Z)().mark((function e(t){var n,r,i,a;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Q(t),r=Xs(n),i=n.O_.length>0?n.O_[n.O_.length-1].batchId:-1;case 2:if(!Os(n)){e.next=19;break}return e.prev=3,e.next=6,_o(n.localStore,i);case 6:if(null!==(a=e.sent)){e.next=10;break}return 0===n.O_.length&&r.o_(),e.abrupt("break",19);case 10:i=a.batchId,Ps(n,a),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,As(n,e.t0);case 17:e.next=2;break;case 19:Fs(n)&&Ls(n);case 20:case"end":return e.stop()}}),e,null,[[3,13]])})))).apply(this,arguments)}function Os(e){return ws(e)&&e.O_.length<10}function Ps(e,t){e.O_.push(t);var n=Xs(e);n.r_()&&n.V_&&n.m_(t.mutations)}function Fs(e){return ws(e)&&!Xs(e).n_()&&e.O_.length>0}function Ls(e){Xs(e).start()}function Vs(e){return qs.apply(this,arguments)}function qs(){return(qs=(0,f.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Xs(t).p_();case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Us(e){return Bs.apply(this,arguments)}function Bs(){return(Bs=(0,f.Z)((0,h.Z)().mark((function e(t){var n,r,i,a;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Xs(t),r=(0,l.Z)(t.O_);try{for(r.s();!(i=r.n()).done;)a=i.value,n.m_(a.mutations)}catch(u){r.e(u)}finally{r.f()}case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zs(e,t,n){return js.apply(this,arguments)}function js(){return(js=(0,f.Z)((0,h.Z)().mark((function e(t,n,r){var i,a;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.O_.shift(),a=yi.from(i,n,r),e.next=3,Ns(t,(function(){return t.remoteSyncer.applySuccessfulWrite(a)}));case 3:return e.next=5,Rs(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gs(e,t){return Ks.apply(this,arguments)}function Ks(){return Ks=(0,f.Z)((0,h.Z)().mark((function e(t,n){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n&&Xs(t).V_,!e.t0){e.next=4;break}return e.next=4,function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!function(e){return wi(e)&&e!==H.ABORTED}(n.code)){e.next=7;break}return r=t.O_.shift(),Xs(t).s_(),e.next=5,Ns(t,(function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)}));case 5:return e.next=7,Rs(t);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:Fs(t)&&Ls(t);case 5:case"end":return e.stop()}}),e)}))),Ks.apply(this,arguments)}function Qs(e,t){return Hs.apply(this,arguments)}function Hs(){return(Hs=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=Q(t)).asyncQueue.verifyOperationInProgress(),q("RemoteStore","RemoteStore received new credentials"),i=ws(r),r.L_.add(3),e.next=6,fs(r);case 6:return i&&r.q_.set("Unknown"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r.L_.delete(3),e.next=12,ls(r);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ws(e,t){return Js.apply(this,arguments)}function Js(){return(Js=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Q(t),!n){e.next=7;break}return r.L_.delete(2),e.next=5,ls(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r.L_.add(2),e.next=12,fs(r);case 12:r.q_.set("Unknown");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ys(e){return e.K_||(e.K_=function(e,t,n){var r=Q(e);return r.w_(),new as(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:xs.bind(null,e),Ro:_s.bind(null,e),mo:Zs.bind(null,e),d_:Ss.bind(null,e)}),e.B_.push(function(){var t=(0,f.Z)((0,h.Z)().mark((function t(n){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}e.K_.s_(),ks(e)?gs(e):e.q_.set("Unknown"),t.next=7;break;case 4:return t.next=6,e.K_.stop();case 6:bs(e);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.K_}function Xs(e){return e.U_||(e.U_=function(e,t,n){var r=Q(e);return r.w_(),new us(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:function(){return Promise.resolve()},Ro:Vs.bind(null,e),mo:Gs.bind(null,e),f_:Us.bind(null,e),g_:zs.bind(null,e)}),e.B_.push(function(){var t=(0,f.Z)((0,h.Z)().mark((function t(n){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.U_.s_(),t.next=4,Rs(e);case 4:t.next=9;break;case 6:return t.next=8,e.U_.stop();case 8:e.O_.length>0&&(q("RemoteStore","Stopping write stream with ".concat(e.O_.length," pending writes")),e.O_=[]);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.U_}var $s=function(){function e(t,n,r,i,a){(0,y.Z)(this,e),this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new J,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(e){}))}return(0,m.Z)(e,[{key:"promise",get:function(){return this.deferred.promise}},{key:"start",value:function(e){var t=this;this.timerHandle=setTimeout((function(){return t.handleDelayElapsed()}),e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new W(H.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget((function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then((function(t){return e.deferred.resolve(t)}))):Promise.resolve()}))}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}))}],[{key:"createAndSchedule",value:function(t,n,r,i,a){var u=new e(t,n,Date.now()+r,i,a);return u.start(r),u}}]),e}();function ec(e,t){if(U("AsyncQueue","".concat(t,": ").concat(e)),Ve(e))return new W(H.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}var tc,nc,rc=function(){function e(t){(0,y.Z)(this,e),this.comparator=t?function(e,n){return t(e,n)||me.comparator(e.key,n.key)}:function(e,t){return me.comparator(e.key,t.key)},this.keyedMap=Tr(),this.sortedSet=new Dt(this.comparator)}return(0,m.Z)(e,[{key:"has",value:function(e){return null!=this.keyedMap.get(e)}},{key:"get",value:function(e){return this.keyedMap.get(e)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:"size",get:function(){return this.sortedSet.size}},{key:"forEach",value:function(e){this.sortedSet.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"add",value:function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:"delete",value:function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}},{key:"copy",value:function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}],[{key:"emptySet",value:function(t){return new e(t.comparator)}}]),e}(),ic=function(){function e(){(0,y.Z)(this,e),this.W_=new Dt(me.comparator)}return(0,m.Z)(e,[{key:"track",value:function(e){var t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):j():this.W_=this.W_.insert(t,e)}},{key:"G_",value:function(){var e=[];return this.W_.inorderTraversal((function(t,n){e.push(n)})),e}}]),e}(),ac=function(){function e(t,n,r,i,a,u,o,s,c){(0,y.Z)(this,e),this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=u,this.syncStateChanged=o,this.excludesMetadataChanges=s,this.hasCachedResults=c}return(0,m.Z)(e,[{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&vr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function(t,n,r,i,a){var u=[];return n.forEach((function(e){u.push({type:0,doc:e})})),new e(t,n,rc.emptySet(n),u,r,i,!0,!1,a)}}]),e}(),uc=function(){function e(){(0,y.Z)(this,e),this.z_=void 0,this.j_=[]}return(0,m.Z)(e,[{key:"H_",value:function(){return this.j_.some((function(e){return e.J_()}))}}]),e}(),oc=function(){function e(){(0,y.Z)(this,e),this.queries=sc(),this.onlineState="Unknown",this.Y_=new Set}return(0,m.Z)(e,[{key:"terminate",value:function(){!function(e,t){var n=Q(e),r=n.queries;n.queries=sc(),r.forEach((function(e,n){var r,i=(0,l.Z)(n.j_);try{for(i.s();!(r=i.n()).done;){r.value.onError(t)}}catch(a){i.e(a)}finally{i.f()}}))}(this,new W(H.ABORTED,"Firestore shutting down"))}}]),e}();function sc(){return new br((function(e){return pr(e)}),vr)}function cc(e,t){return lc.apply(this,arguments)}function lc(){return(lc=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i,a,u,o;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Q(t),i=3,a=n.query,(u=r.queries.get(a))?!u.H_()&&n.J_()&&(i=2):(u=new uc,i=n.J_()?0:1),e.prev=5,e.t0=i,e.next=0===e.t0?9:1===e.t0?13:2===e.t0?17:19;break;case 9:return e.next=11,r.onListen(a,!0);case 11:return u.z_=e.sent,e.abrupt("break",19);case 13:return e.next=15,r.onListen(a,!1);case 15:return u.z_=e.sent,e.abrupt("break",19);case 17:return e.next=19,r.onFirstRemoteStoreListen(a);case 19:e.next=25;break;case 21:return e.prev=21,e.t1=e.catch(5),o=ec(e.t1,"Initialization of query '".concat(yr(n.query),"' failed")),e.abrupt("return",void n.onError(o));case 25:r.queries.set(a,u),u.j_.push(n),n.Z_(r.onlineState),u.z_&&n.X_(u.z_)&&pc(r);case 26:case"end":return e.stop()}}),e,null,[[5,21]])})))).apply(this,arguments)}function hc(e,t){return fc.apply(this,arguments)}function fc(){return(fc=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i,a,u,o;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Q(t),i=n.query,a=3,(u=r.queries.get(i))&&(o=u.j_.indexOf(n))>=0&&(u.j_.splice(o,1),0===u.j_.length?a=n.J_()?0:1:!u.H_()&&n.J_()&&(a=2)),e.t0=a,e.next=0===e.t0?7:1===e.t0?8:2===e.t0?9:10;break;case 7:return e.abrupt("return",(r.queries.delete(i),r.onUnlisten(i,!0)));case 8:return e.abrupt("return",(r.queries.delete(i),r.onUnlisten(i,!1)));case 9:return e.abrupt("return",r.onLastRemoteStoreUnlisten(i));case 10:return e.abrupt("return");case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dc(e,t){var n,r=Q(e),i=!1,a=(0,l.Z)(t);try{for(a.s();!(n=a.n()).done;){var u=n.value,o=u.query,s=r.queries.get(o);if(s){var c,h=(0,l.Z)(s.j_);try{for(h.s();!(c=h.n()).done;){c.value.X_(u)&&(i=!0)}}catch(f){h.e(f)}finally{h.f()}s.z_=u}}}catch(f){a.e(f)}finally{a.f()}i&&pc(r)}function vc(e,t,n){var r=Q(e),i=r.queries.get(t);if(i){var a,u=(0,l.Z)(i.j_);try{for(u.s();!(a=u.n()).done;){a.value.onError(n)}}catch(o){u.e(o)}finally{u.f()}}r.queries.delete(t)}function pc(e){e.Y_.forEach((function(e){e.next()}))}(nc=tc||(tc={})).ea="default",nc.Cache="cache";var yc=function(){function e(t,n,r){(0,y.Z)(this,e),this.query=t,this.ta=n,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}return(0,m.Z)(e,[{key:"X_",value:function(e){if(!this.options.includeMetadataChanges){var t,n=[],r=(0,l.Z)(e.docChanges);try{for(r.s();!(t=r.n()).done;){var i=t.value;3!==i.type&&n.push(i)}}catch(u){r.e(u)}finally{r.f()}e=new ac(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}var a=!1;return this.na?this.ia(e)&&(this.ta.next(e),a=!0):this.sa(e,this.onlineState)&&(this.oa(e),a=!0),this.ra=e,a}},{key:"onError",value:function(e){this.ta.error(e)}},{key:"Z_",value:function(e){this.onlineState=e;var t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}},{key:"sa",value:function(e,t){if(!e.fromCache)return!0;if(!this.J_())return!0;var n="Offline"!==t;return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}},{key:"ia",value:function(e){if(e.docChanges.length>0)return!0;var t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}},{key:"oa",value:function(e){e=ac.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}},{key:"J_",value:function(){return this.options.source!==tc.Cache}}]),e}(),mc=function(){function e(t,n){(0,y.Z)(this,e),this.aa=t,this.byteLength=n}return(0,m.Z)(e,[{key:"ua",value:function(){return"metadata"in this.aa}}]),e}(),gc=function(){function e(t){(0,y.Z)(this,e),this.serializer=t}return(0,m.Z)(e,[{key:"Es",value:function(e){return Yi(this.serializer,e)}},{key:"ds",value:function(e){return e.metadata.exists?ra(this.serializer,e.document,!1):_n.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}},{key:"As",value:function(e){return Ki(e)}}]),e}(),kc=function(){function e(t,n,r){(0,y.Z)(this,e),this.ca=t,this.localStore=n,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=wc(t)}return(0,m.Z)(e,[{key:"la",value:function(e){this.progress.bytesLoaded+=e.byteLength;var t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;var n=ve.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}},{key:"ha",value:function(e){var t,n=new Map,r=new gc(this.serializer),i=(0,l.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.metadata.queries){var u,o=r.Es(a.metadata.name),s=(0,l.Z)(a.metadata.queries);try{for(s.s();!(u=s.n()).done;){var c=u.value,h=(n.get(c)||Nr()).add(o);n.set(c,h)}}catch(f){s.e(f)}finally{s.f()}}}}catch(f){i.e(f)}finally{i.f()}return n}},{key:"complete",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){var t,n,r,i,a;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,No(this.localStore,new gc(this.serializer),this.documents,this.ca.id);case 2:t=e.sent,n=this.ha(this.documents),r=(0,l.Z)(this.queries),e.prev=5,r.s();case 7:if((i=r.n()).done){e.next=13;break}return a=i.value,e.next=11,Mo(this.localStore,a,n.get(a.name));case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",(this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:t}));case 22:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(){return e.apply(this,arguments)}}()}]),e}();function wc(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}var bc=(0,m.Z)((function e(t){(0,y.Z)(this,e),this.key=t})),xc=(0,m.Z)((function e(t){(0,y.Z)(this,e),this.key=t})),Ic=function(){function e(t,n){(0,y.Z)(this,e),this.query=t,this.Ta=n,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Nr(),this.mutatedKeys=Nr(),this.Aa=kr(t),this.Ra=new rc(this.Aa)}return(0,m.Z)(e,[{key:"Va",get:function(){return this.Ta}},{key:"ma",value:function(e,t){var n=this,r=t?t.fa:new ic,i=t?t.Ra:this.Ra,a=t?t.mutatedKeys:this.mutatedKeys,u=i,o=!1,s="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((function(e,t){var l=i.get(e),h=mr(n.query,t)?t:null,f=!!l&&n.mutatedKeys.has(l.key),d=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),v=!1;l&&h?l.data.isEqual(h.data)?f!==d&&(r.track({type:3,doc:h}),v=!0):n.ga(l,h)||(r.track({type:2,doc:h}),v=!0,(s&&n.Aa(h,s)>0||c&&n.Aa(h,c)<0)&&(o=!0)):!l&&h?(r.track({type:0,doc:h}),v=!0):l&&!h&&(r.track({type:1,doc:l}),v=!0,(s||c)&&(o=!0)),v&&(h?(u=u.add(h),a=d?a.add(e):a.delete(e)):(u=u.delete(e),a=a.delete(e)))})),null!==this.query.limit)for(;u.size>this.query.limit;){var l="F"===this.query.limitType?u.last():u.first();u=u.delete(l.key),a=a.delete(l.key),r.track({type:1,doc:l})}return{Ra:u,fa:r,ns:o,mutatedKeys:a}}},{key:"ga",value:function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:"applyChanges",value:function(e,t,n,r){var i=this,a=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;var u=e.fa.G_();u.sort((function(e,t){return function(e,t){var n=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return j()}};return n(e)-n(t)}(e.type,t.type)||i.Aa(e.doc,t.doc)})),this.pa(n),r=null!=r&&r;var o=t&&!r?this.ya():[],s=0===this.da.size&&this.current&&!r?1:0,c=s!==this.Ea;return this.Ea=s,0!==u.length||c?{snapshot:new ac(this.query,e.Ra,a,u,e.mutatedKeys,0===s,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:o}:{wa:o}}},{key:"Z_",value:function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new ic,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}},{key:"Sa",value:function(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}},{key:"pa",value:function(e){var t=this;e&&(e.addedDocuments.forEach((function(e){return t.Ta=t.Ta.add(e)})),e.modifiedDocuments.forEach((function(e){})),e.removedDocuments.forEach((function(e){return t.Ta=t.Ta.delete(e)})),this.current=e.current)}},{key:"ya",value:function(){var e=this;if(!this.current)return[];var t=this.da;this.da=Nr(),this.Ra.forEach((function(t){e.Sa(t.key)&&(e.da=e.da.add(t.key))}));var n=[];return t.forEach((function(t){e.da.has(t)||n.push(new xc(t))})),this.da.forEach((function(e){t.has(e)||n.push(new bc(e))})),n}},{key:"ba",value:function(e){this.Ta=e.Ts,this.da=Nr();var t=this.ma(e.documents);return this.applyChanges(t,!0)}},{key:"Da",value:function(){return ac.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}]),e}(),_c=(0,m.Z)((function e(t,n,r){(0,y.Z)(this,e),this.query=t,this.targetId=n,this.view=r})),Tc=(0,m.Z)((function e(t){(0,y.Z)(this,e),this.key=t,this.va=!1})),Zc=function(){function e(t,n,r,i,a,u){(0,y.Z)(this,e),this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=u,this.Ca={},this.Fa=new br((function(e){return pr(e)}),vr),this.Ma=new Map,this.xa=new Set,this.Oa=new Dt(me.comparator),this.Na=new Map,this.La=new Wu,this.Ba={},this.ka=new Map,this.qa=Iu.kn(),this.onlineState="Unknown",this.Qa=void 0}return(0,m.Z)(e,[{key:"isPrimaryClient",get:function(){return!0===this.Qa}}]),e}();function Ec(e,t){return Sc.apply(this,arguments)}function Sc(){return Sc=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i,a,u,o=arguments;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(o.length>2&&void 0!==o[2])||o[2],i=Zl(t),!(u=i.Fa.get(n))){e.next=7;break}i.sharedClientState.addLocalQueryTarget(u.targetId),a=u.view.Da(),e.next=10;break;case 7:return e.next=9,Dc(i,n,r,!0);case 9:a=e.sent;case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}}),e)}))),Sc.apply(this,arguments)}function Cc(e,t){return Ac.apply(this,arguments)}function Ac(){return(Ac=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Zl(t),e.next=3,Dc(r,n,!0,!1);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dc(e,t,n,r){return Nc.apply(this,arguments)}function Nc(){return(Nc=(0,f.Z)((0,h.Z)().mark((function e(t,n,r,i){var a,u,o,s;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,To(t.localStore,cr(n));case 2:if(a=e.sent,u=a.targetId,o=t.sharedClientState.addLocalQueryTarget(u,r),e.t0=i,!e.t0){e.next=10;break}return e.next=9,Rc(t,n,u,"current"===o,a.resumeToken);case 9:s=e.sent;case 10:return t.isPrimaryClient&&r&&vs(t.remoteStore,a),e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rc(e,t,n,r,i){return Mc.apply(this,arguments)}function Mc(){return Mc=(0,f.Z)((0,h.Z)().mark((function e(t,n,r,i,a){var u,o,s,c,l,d;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.Ka=function(e,n,r){return function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t,n,r,i){var a,u,o,s;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.view.ma(r),e.t0=a.ns,!e.t0){e.next=6;break}return e.next=5,So(t.localStore,n.query,!1).then((function(e){var t=e.documents;return n.view.ma(t,a)}));case 5:a=e.sent;case 6:return u=i&&i.targetChanges.get(n.targetId),o=i&&null!=i.targetMismatches.get(n.targetId),s=n.view.applyChanges(a,t.isPrimaryClient,u,o),e.abrupt("return",(nl(t,n.targetId,s.wa),s.snapshot));case 8:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()(t,e,n,r)},e.next=3,So(t.localStore,n,!0);case 3:return u=e.sent,o=new Ic(n,u.Ts),s=o.ma(u.documents),c=Ai.createSynthesizedTargetChangeForCurrentChange(r,i&&"Offline"!==t.onlineState,a),l=o.applyChanges(s,t.isPrimaryClient,c),nl(t,r,l.wa),d=new _c(n,r,o),e.abrupt("return",(t.Fa.set(n,d),t.Ma.has(r)?t.Ma.get(r).push(n):t.Ma.set(r,[n]),l.snapshot));case 11:case"end":return e.stop()}}),e)}))),Mc.apply(this,arguments)}function Oc(e,t,n){return Pc.apply(this,arguments)}function Pc(){return(Pc=(0,f.Z)((0,h.Z)().mark((function e(t,n,r){var i,a,u;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Q(t),a=i.Fa.get(n),!((u=i.Ma.get(a.targetId)).length>1)){e.next=3;break}return e.abrupt("return",(i.Ma.set(a.targetId,u.filter((function(e){return!vr(e,n)}))),void i.Fa.delete(n)));case 3:if(!i.isPrimaryClient){e.next=11;break}if(i.sharedClientState.removeLocalQueryTarget(a.targetId),e.t0=i.sharedClientState.isActiveQueryTarget(a.targetId),e.t0){e.next=9;break}return e.next=9,Zo(i.localStore,a.targetId,!1).then((function(){i.sharedClientState.clearQueryState(a.targetId),r&&ps(i.remoteStore,a.targetId),el(i,a.targetId)})).catch(De);case 9:e.next=14;break;case 11:return el(i,a.targetId),e.next=14,Zo(i.localStore,a.targetId,!0);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fc(e,t){return Lc.apply(this,arguments)}function Lc(){return(Lc=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i,a;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Q(t),i=r.Fa.get(n),a=r.Ma.get(i.targetId),r.isPrimaryClient&&1===a.length&&(r.sharedClientState.removeLocalQueryTarget(i.targetId),ps(r.remoteStore,i.targetId));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Vc(e,t,n){return qc.apply(this,arguments)}function qc(){return(qc=(0,f.Z)((0,h.Z)().mark((function e(t,n,r){var i,a,u;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=El(t),e.prev=1,e.next=4,function(e,t){var n,r,i=Q(e),a=he.now(),u=t.reduce((function(e,t){return e.add(t.key)}),Nr());return i.persistence.runTransaction("Locally write mutations","readwrite",(function(e){var o=Ir(),s=Nr();return i.cs.getEntries(e,u).next((function(e){(o=e).forEach((function(e,t){t.isValidDocument()||(s=s.add(e))}))})).next((function(){return i.localDocuments.getOverlayedDocuments(e,o)})).next((function(r){n=r;var u,o=[],s=(0,l.Z)(t);try{for(s.s();!(u=s.n()).done;){var c=u.value,h=ii(c,n.get(c.key).overlayedDocument);null!=h&&o.push(new oi(c.key,h,In(h.value.mapValue),Xr.exists(!0)))}}catch(f){s.e(f)}finally{s.f()}return i.mutationQueue.addMutationBatch(e,a,o,t)})).next((function(t){r=t;var a=t.applyToLocalDocumentSet(n,s);return i.documentOverlayCache.saveOverlays(e,t.batchId,a)}))})).then((function(){return{batchId:r.batchId,changes:Zr(n)}}))}(i.localStore,n);case 4:return a=e.sent,i.sharedClientState.addPendingMutation(a.batchId),function(e,t,n){var r=e.Ba[e.currentUser.toKey()];r||(r=new Dt(se)),r=r.insert(t,n),e.Ba[e.currentUser.toKey()]=r}(i,a.batchId,r),e.next=9,al(i,a.changes);case 9:return e.next=11,Rs(i.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),u=ec(e.t0,"Failed to persist write"),r.reject(u);case 17:case"end":return e.stop()}}),e,null,[[1,13]])})))).apply(this,arguments)}function Uc(e,t){return Bc.apply(this,arguments)}function Bc(){return(Bc=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),e.prev=1,e.next=4,xo(r.localStore,n);case 4:return i=e.sent,n.targetChanges.forEach((function(e,t){var n=r.Na.get(t);n&&(G(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.va=!0:e.modifiedDocuments.size>0?G(n.va):e.removedDocuments.size>0&&(G(n.va),n.va=!1))})),e.next=8,al(r,i,n);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,De(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})))).apply(this,arguments)}function zc(e,t,n){var r=Q(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Fa.forEach((function(e,n){var r=n.view.Z_(t);r.snapshot&&i.push(r.snapshot)})),function(e,t){var n=Q(e);n.onlineState=t;var r=!1;n.queries.forEach((function(e,n){var i,a=(0,l.Z)(n.j_);try{for(a.s();!(i=a.n()).done;){i.value.Z_(t)&&(r=!0)}}catch(u){a.e(u)}finally{a.f()}})),r&&pc(n)}(r.eventManager,t),i.length&&r.Ca.d_(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function jc(e,t,n){return Gc.apply(this,arguments)}function Gc(){return(Gc=(0,f.Z)((0,h.Z)().mark((function e(t,n,r){var i,a,u,o,s,c;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=Q(t)).sharedClientState.updateQueryState(n,"rejected",r),a=i.Na.get(n),!(u=a&&a.key)){e.next=14;break}return o=(o=new Dt(me.comparator)).insert(u,_n.newNoDocument(u,fe.min())),s=Nr().add(u),c=new Ci(fe.min(),new Map,new Dt(se),o,s),e.next=9,Uc(i,c);case 9:i.Oa=i.Oa.remove(u),i.Na.delete(n),il(i),e.next=16;break;case 14:return e.next=16,Zo(i.localStore,n,!1).then((function(){return el(i,n,r)})).catch(De);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Kc(e,t){return Qc.apply(this,arguments)}function Qc(){return(Qc=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i,a;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),i=n.batch.batchId,e.prev=1,e.next=4,wo(r.localStore,n);case 4:return a=e.sent,$c(r,i,null),Xc(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),e.next=10,al(r,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,De(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}function Hc(e,t,n){return Wc.apply(this,arguments)}function Wc(){return(Wc=(0,f.Z)((0,h.Z)().mark((function e(t,n,r){var i,a;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Q(t),e.prev=1,e.next=4,function(e,t){var n=Q(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(e){var r;return n.mutationQueue.lookupMutationBatch(e,t).next((function(t){return G(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)})).next((function(){return n.mutationQueue.performConsistencyCheck(e)})).next((function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)})).next((function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)})).next((function(){return n.localDocuments.getDocuments(e,r)}))}))}(i.localStore,n);case 4:return a=e.sent,$c(i,n,r),Xc(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),e.next=10,al(i,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,De(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}function Jc(e,t){return Yc.apply(this,arguments)}function Yc(){return(Yc=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i,a,u;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ws((r=Q(t)).remoteStore)||q("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.prev=2,e.next=5,function(e){var t=Q(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(e){return t.mutationQueue.getHighestUnacknowledgedBatchId(e)}))}(r.localStore);case 5:if(-1!==(i=e.sent)){e.next=8;break}return e.abrupt("return",void n.resolve());case 8:(a=r.ka.get(i)||[]).push(n),r.ka.set(i,a),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),u=ec(e.t0,"Initialization of waitForPendingWrites() operation failed"),n.reject(u);case 16:case"end":return e.stop()}}),e,null,[[2,12]])})))).apply(this,arguments)}function Xc(e,t){(e.ka.get(t)||[]).forEach((function(e){e.resolve()})),e.ka.delete(t)}function $c(e,t,n){var r=Q(e),i=r.Ba[r.currentUser.toKey()];if(i){var a=i.get(t);a&&(n?a.reject(n):a.resolve(),i=i.remove(t)),r.Ba[r.currentUser.toKey()]=i}}function el(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var r,i=(0,l.Z)(e.Ma.get(t));try{for(i.s();!(r=i.n()).done;){var a=r.value;e.Fa.delete(a),n&&e.Ca.$a(a,n)}}catch(u){i.e(u)}finally{i.f()}e.Ma.delete(t),e.isPrimaryClient&&e.La.gr(t).forEach((function(t){e.La.containsKey(t)||tl(e,t)}))}function tl(e,t){e.xa.delete(t.path.canonicalString());var n=e.Oa.get(t);null!==n&&(ps(e.remoteStore,n),e.Oa=e.Oa.remove(t),e.Na.delete(n),il(e))}function nl(e,t,n){var r,i=(0,l.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;a instanceof bc?(e.La.addReference(a.key,t),rl(e,a)):a instanceof xc?(q("SyncEngine","Document no longer in limbo: "+a.key),e.La.removeReference(a.key,t),e.La.containsKey(a.key)||tl(e,a.key)):j()}}catch(u){i.e(u)}finally{i.f()}}function rl(e,t){var n=t.key,r=n.path.canonicalString();e.Oa.get(n)||e.xa.has(r)||(q("SyncEngine","New document in limbo: "+n),e.xa.add(r),il(e))}function il(e){for(;e.xa.size>0&&e.Oa.size<e.maxConcurrentLimboResolutions;){var t=e.xa.values().next().value;e.xa.delete(t);var n=new me(ve.fromString(t)),r=e.qa.next();e.Na.set(r,new Tc(n)),e.Oa=e.Oa.insert(n,r),vs(e.remoteStore,new wa(cr(ar(n.path)),r,"TargetPurposeLimboResolution",Ke.oe))}}function al(e,t,n){return ul.apply(this,arguments)}function ul(){return ul=(0,f.Z)((0,h.Z)().mark((function e(t,n,r){var i,a,u,o;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Q(t),a=[],u=[],o=[],e.t0=i.Fa.isEmpty(),e.t0){e.next=9;break}return i.Fa.forEach((function(e,t){o.push(i.Ka(t,n,r).then((function(e){var n;if((e||r)&&i.isPrimaryClient){var o=e?!e.fromCache:null===(n=null==r?void 0:r.targetChanges.get(t.targetId))||void 0===n?void 0:n.current;i.sharedClientState.updateQueryState(t.targetId,o?"current":"not-current")}if(e){a.push(e);var s=fo.Wi(t.targetId,e);u.push(s)}})))})),e.next=6,Promise.all(o);case 6:return i.Ca.d_(a),e.next=9,function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i,a,u,o,s,c,f;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),e.prev=1,e.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(e){return Re.forEach(n,(function(t){return Re.forEach(t.$i,(function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)})).next((function(){return Re.forEach(t.Ui,(function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)}))}))}))}));case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),Ve(e.t0)){e.next=10;break}throw e.t0;case 10:q("LocalStore","Failed to update sequence numbers: "+e.t0);case 11:i=(0,l.Z)(n);try{for(i.s();!(a=i.n()).done;)u=a.value,o=u.targetId,u.fromCache||(s=r.os.get(o),c=s.snapshotVersion,f=s.withLastLimboFreeSnapshotVersion(c),r.os=r.os.insert(o,f))}catch(h){i.e(h)}finally{i.f()}case 13:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}()(i.localStore,u);case 9:case"end":return e.stop()}}),e)}))),ul.apply(this,arguments)}function ol(e,t){return sl.apply(this,arguments)}function sl(){return(sl=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=Q(t)).currentUser.isEqual(n)){e.next=11;break}return q("SyncEngine","User change. New user:",n.toKey()),e.next=5,go(r.localStore,n);case 5:return i=e.sent,r.currentUser=n,function(e,t){e.ka.forEach((function(e){e.forEach((function(e){e.reject(new W(H.CANCELLED,t))}))})),e.ka.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),e.next=11,al(r,i.hs);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cl(e,t){var n=Q(e),r=n.Na.get(t);if(r&&r.va)return Nr().add(r.key);var i=Nr(),a=n.Ma.get(t);if(!a)return i;var u,o=(0,l.Z)(a);try{for(o.s();!(u=o.n()).done;){var s=u.value,c=n.Fa.get(s);i=i.unionWith(c.view.Va)}}catch(h){o.e(h)}finally{o.f()}return i}function ll(e,t){return hl.apply(this,arguments)}function hl(){return(hl=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i,a;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),e.next=3,So(r.localStore,n.query,!0);case 3:return i=e.sent,a=n.view.ba(i),e.abrupt("return",(r.isPrimaryClient&&nl(r,n.targetId,a.wa),a));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fl(e,t){return dl.apply(this,arguments)}function dl(){return(dl=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),e.abrupt("return",Ao(r.localStore,n).then((function(e){return al(r,e)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vl(e,t,n,r){return pl.apply(this,arguments)}function pl(){return(pl=(0,f.Z)((0,h.Z)().mark((function e(t,n,r,i){var a,u;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Q(t),e.next=3,function(e,t){var n=Q(e),r=Q(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(e){return r.Mn(e,t).next((function(t){return t?n.localDocuments.getDocuments(e,t):Re.resolve(null)}))}))}(a.localStore,n);case 3:if(null===(u=e.sent)){e.next=15;break}if("pending"!==r){e.next=10;break}return e.next=8,Rs(a.remoteStore);case 8:e.next=11;break;case 10:"acknowledged"===r||"rejected"===r?($c(a,n,i||null),Xc(a,n),function(e,t){Q(Q(e).mutationQueue).On(t)}(a.localStore,n)):j();case 11:return e.next=13,al(a,u);case 13:e.next=16;break;case 15:q("SyncEngine","Cannot apply mutation batch with id: "+n);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yl(e,t){return ml.apply(this,arguments)}function ml(){return(ml=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i,a,u,o,s,c,f;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Zl(r=Q(t)),El(r),!0!==n||!0===r.Qa){e.next=13;break}return i=r.sharedClientState.getAllActiveQueryTargets(),e.next=5,gl(r,i.toArray());case 5:return a=e.sent,r.Qa=!0,e.next=9,Ws(r.remoteStore,!0);case 9:u=(0,l.Z)(a);try{for(u.s();!(o=u.n()).done;)s=o.value,vs(r.remoteStore,s)}catch(h){u.e(h)}finally{u.f()}e.next=25;break;case 13:if(!1!==n||!1===r.Qa){e.next=25;break}return c=[],f=Promise.resolve(),r.Ma.forEach((function(e,t){r.sharedClientState.isLocalQueryTarget(t)?c.push(t):f=f.then((function(){return el(r,t),Zo(r.localStore,t,!0)})),ps(r.remoteStore,t)})),e.next=19,f;case 19:return e.next=21,gl(r,c);case 21:return function(e){var t=Q(e);t.Na.forEach((function(e,n){ps(t.remoteStore,n)})),t.La.pr(),t.Na=new Map,t.Oa=new Dt(me.comparator)}(r),r.Qa=!1,e.next=25,Ws(r.remoteStore,!1);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gl(e,t,n){return kl.apply(this,arguments)}function kl(){return(kl=(0,f.Z)((0,h.Z)().mark((function e(t,n,r){var i,a,u,o,s,c,f,d,v,p,y,m,g,k;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Q(t),a=[],u=[],o=(0,l.Z)(n),e.prev=2,o.s();case 4:if((s=o.n()).done){e.next=45;break}if(c=s.value,f=void 0,!(d=i.Ma.get(c))||0===d.length){e.next=34;break}return e.next=11,To(i.localStore,cr(d[0]));case 11:f=e.sent,v=(0,l.Z)(d),e.prev=13,v.s();case 15:if((p=v.n()).done){e.next=24;break}return y=p.value,m=i.Fa.get(y),e.next=20,ll(i,m);case 20:(g=e.sent).snapshot&&u.push(g.snapshot);case 22:e.next=15;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),v.e(e.t0);case 29:return e.prev=29,v.f(),e.finish(29);case 32:e.next=42;break;case 34:return e.next=36,Co(i.localStore,c);case 36:return k=e.sent,e.next=39,To(i.localStore,k);case 39:return f=e.sent,e.next=42,Rc(i,wl(k),c,!1,f.resumeToken);case 42:a.push(f);case 43:e.next=4;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(2),o.e(e.t1);case 50:return e.prev=50,o.f(),e.finish(50);case 53:return e.abrupt("return",(i.Ca.d_(u),a));case 54:case"end":return e.stop()}}),e,null,[[2,47,50,53],[13,26,29,32]])})))).apply(this,arguments)}function wl(e){return ir(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function bl(e){return function(e){return Q(Q(e).persistence).Qi()}(Q(e).localStore)}function xl(e,t,n,r){return Il.apply(this,arguments)}function Il(){return(Il=(0,f.Z)((0,h.Z)().mark((function e(t,n,r,i){var a,u,o,s;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=Q(t)).Qa){e.next=3;break}return e.abrupt("return",void q("SyncEngine","Ignoring unexpected query state notification."));case 3:if(!((u=a.Ma.get(n))&&u.length>0)){e.next=20;break}e.t0=r,e.next="current"===e.t0||"not-current"===e.t0?8:"rejected"===e.t0?15:19;break;case 8:return e.next=10,Ao(a.localStore,gr(u[0]));case 10:return o=e.sent,s=Ci.createSynthesizedRemoteEventForCurrentChange(n,"current"===r,qt.EMPTY_BYTE_STRING),e.next=14,al(a,o,s);case 14:return e.abrupt("break",20);case 15:return e.next=17,Zo(a.localStore,n,!0);case 17:return el(a,n,i),e.abrupt("break",20);case 19:j();case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _l(e,t,n){return Tl.apply(this,arguments)}function Tl(){return(Tl=(0,f.Z)((0,h.Z)().mark((function e(t,n,r){var i,a,u,o,s,c,f,d,v;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=Zl(t)).Qa){e.next=45;break}a=(0,l.Z)(n),e.prev=3,a.s();case 5:if((u=a.n()).done){e.next=21;break}if(o=u.value,!i.Ma.has(o)||!i.sharedClientState.isActiveQueryTarget(o)){e.next=10;break}return q("SyncEngine","Adding an already active target "+o),e.abrupt("continue",19);case 10:return e.next=12,Co(i.localStore,o);case 12:return s=e.sent,e.next=15,To(i.localStore,s);case 15:return c=e.sent,e.next=18,Rc(i,wl(s),c.targetId,!1,c.resumeToken);case 18:vs(i.remoteStore,c);case 19:e.next=5;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),a.e(e.t0);case 26:return e.prev=26,a.f(),e.finish(26);case 29:f=(0,l.Z)(r),e.prev=30,v=(0,h.Z)().mark((function e(){var t;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=d.value,e.t0=i.Ma.has(t),!e.t0){e.next=5;break}return e.next=5,Zo(i.localStore,t,!1).then((function(){ps(i.remoteStore,t),el(i,t)})).catch(De);case 5:case"end":return e.stop()}}),e)})),f.s();case 33:if((d=f.n()).done){e.next=37;break}return e.delegateYield(v(),"t1",35);case 35:e.next=33;break;case 37:e.next=42;break;case 39:e.prev=39,e.t2=e.catch(30),f.e(e.t2);case 42:return e.prev=42,f.f(),e.finish(42);case 45:case"end":return e.stop()}}),e,null,[[3,23,26,29],[30,39,42,45]])})))).apply(this,arguments)}function Zl(e){var t=Q(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Uc.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=cl.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=jc.bind(null,t),t.Ca.d_=dc.bind(null,t.eventManager),t.Ca.$a=vc.bind(null,t.eventManager),t}function El(e){var t=Q(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Kc.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Hc.bind(null,t),t}function Sl(e,t,n){var r=Q(e);(function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t,n,r){var i,a,u,o,s;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getMetadata();case 3:return i=e.sent,e.next=6,function(e,t){var n=Q(e),r=Ki(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(function(e){return n.Gr.getBundleMetadata(e,t.id)})).then((function(e){return!!e&&e.createTime.compareTo(r)>=0}))}(t.localStore,i);case 6:if(!e.sent){e.next=11;break}return e.next=9,n.close();case 9:return r._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(i)),e.abrupt("return",Promise.resolve(new Set));case 11:return r._updateProgress(wc(i)),a=new kc(i,t.localStore,n.serializer),e.next=15,n.Ua();case 15:u=e.sent;case 16:if(!u){e.next=26;break}return e.next=19,a.la(u);case 19:return(o=e.sent)&&r._updateProgress(o),e.next=23,n.Ua();case 23:u=e.sent;case 24:e.next=16;break;case 26:return e.next=28,a.complete();case 28:return s=e.sent,e.next=31,al(t,s.Ia,void 0);case 31:return e.next=33,function(e,t){var n=Q(e);return n.persistence.runTransaction("Save bundle","readwrite",(function(e){return n.Gr.saveBundleMetadata(e,t)}))}(t.localStore,i);case 33:return r._completeWith(s.progress),e.abrupt("return",Promise.resolve(s.Pa));case 37:return e.prev=37,e.t0=e.catch(0),e.abrupt("return",(B("SyncEngine","Loading bundle failed with ".concat(e.t0)),r._failWith(e.t0),Promise.resolve(new Set)));case 40:case"end":return e.stop()}}),e,null,[[0,37]])})));return function(t,n,r){return e.apply(this,arguments)}})()(r,t,n).then((function(e){r.sharedClientState.notifyBundleLoaded(e)}))}var Cl=function(){function e(){(0,y.Z)(this,e),this.kind="memory",this.synchronizeTabs=!1}return(0,m.Z)(e,[{key:"initialize",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.serializer=ns(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),e.next=5,this.persistence.start();case 5:this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"ja",value:function(e,t){return null}},{key:"Ha",value:function(e,t){return null}},{key:"za",value:function(e){return mo(this.persistence,new po,e.initialUser,this.serializer)}},{key:"Ga",value:function(e){return new to(ro.Zr,this.serializer)}},{key:"Wa",value:function(e){return new Go}},{key:"terminate",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){var t,n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(n=this.indexBackfillerScheduler)||void 0===n||n.stop(),this.sharedClientState.shutdown(),e.next=5,this.persistence.shutdown();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();Cl.provider={build:function(){return new Cl}};var Al=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).cacheSizeBytes=e,r}return(0,m.Z)(n,[{key:"ja",value:function(e,t){G(this.persistence.referenceDelegate instanceof io);var n=this.persistence.referenceDelegate.garbageCollector;return new Au(n,e.asyncQueue,t)}},{key:"Ga",value:function(e){var t=void 0!==this.cacheSizeBytes?pu.withCacheSize(this.cacheSizeBytes):pu.DEFAULT;return new to((function(e){return io.Zr(e,t)}),this.serializer)}}]),n}(Cl),Dl=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i){var a;return(0,y.Z)(this,n),(a=t.call(this)).Ja=e,a.cacheSizeBytes=r,a.forceOwnership=i,a.kind="persistent",a.synchronizeTabs=!1,a}return(0,m.Z)(n,[{key:"initialize",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t){var r=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.Z)((0,o.Z)(n.prototype),"initialize",this).call(this,t);case 2:return e.next=4,this.Ja.initialize(this,t);case 4:return e.next=6,El(this.Ja.syncEngine);case 6:return e.next=8,Rs(this.Ja.remoteStore);case 8:return e.next=10,this.persistence.yi((function(){return r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"za",value:function(e){return mo(this.persistence,new po,e.initialUser,this.serializer)}},{key:"ja",value:function(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new Au(n,e.asyncQueue,t)}},{key:"Ha",value:function(e,t){var n=new Ge(t,this.persistence);return new je(e.asyncQueue,n)}},{key:"Ga",value:function(e){var t=ho(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?pu.withCacheSize(this.cacheSizeBytes):pu.DEFAULT;return new so(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,es(),ts(),this.serializer,this.sharedClientState,!!this.forceOwnership)}},{key:"Wa",value:function(e){return new Go}}]),n}(Cl),Nl=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this,e,r,!1)).Ja=e,i.cacheSizeBytes=r,i.synchronizeTabs=!0,i}return(0,m.Z)(n,[{key:"initialize",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t){var r,i=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.Z)((0,o.Z)(n.prototype),"initialize",this).call(this,t);case 2:if(r=this.Ja.syncEngine,e.t0=this.sharedClientState instanceof jo,!e.t0){e.next=8;break}return this.sharedClientState.syncEngine={no:vl.bind(null,r),ro:xl.bind(null,r),io:_l.bind(null,r),Qi:bl.bind(null,r),eo:fl.bind(null,r)},e.next=8,this.sharedClientState.start();case 8:return e.next=10,this.persistence.yi(function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yl(i.Ja.syncEngine,t);case 2:i.gcScheduler&&(t&&!i.gcScheduler.started?i.gcScheduler.start():t||i.gcScheduler.stop()),i.indexBackfillerScheduler&&(t&&!i.indexBackfillerScheduler.started?i.indexBackfillerScheduler.start():t||i.indexBackfillerScheduler.stop());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"Wa",value:function(e){var t=es();if(!jo.D(t))throw new W(H.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=ho(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new jo(t,e.asyncQueue,n,e.clientId,e.initialUser)}}]),n}(Dl),Rl=function(){function e(){(0,y.Z)(this,e)}return(0,m.Z)(e,[{key:"initialize",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.localStore,e.t0){e.next=12;break}return this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return zc(r.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=ol.bind(null,this.syncEngine),e.next=12,Ws(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createEventManager",value:function(e){return new oc}},{key:"createDatastore",value:function(e){var t=ns(e.databaseInfo.databaseId),n=function(e){return new $o(e)}(e.databaseInfo);return function(e,t,n,r){return new os(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}},{key:"createRemoteStore",value:function(e){var t=this;return function(e,t,n,r,i){return new cs(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(function(e){return zc(t.syncEngine,e,0)}),Qo.D()?new Qo:new Ko)}},{key:"createSyncEngine",value:function(e,t){return function(e,t,n,r,i,a,u){var o=new Zc(e,t,n,r,i,a);return u&&(o.Qa=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}},{key:"terminate",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){var t,n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t){var n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Q(t),q("RemoteStore","RemoteStore shutting down."),n.L_.add(5),e.next=5,fs(n);case 5:n.k_.shutdown(),n.q_.set("Unknown");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(this.remoteStore);case 2:null===(t=this.datastore)||void 0===t||t.terminate(),null===(n=this.eventManager)||void 0===n||n.terminate();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function Ml(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10240,n=0;return{read:function(){return(0,f.Z)((0,h.Z)().mark((function r(){var i;return(0,h.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n<e.byteLength)){r.next=3;break}return i={value:e.slice(n,n+t),done:!1},r.abrupt("return",(n+=t,i));case 3:return r.abrupt("return",{done:!0});case 4:case"end":return r.stop()}}),r)})))()},cancel:function(){return(0,f.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},releaseLock:function(){},closed:Promise.resolve()}}Rl.provider={build:function(){return new Rl}};var Ol=function(){function e(t){(0,y.Z)(this,e),this.observer=t,this.muted=!1}return(0,m.Z)(e,[{key:"next",value:function(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}},{key:"error",value:function(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):U("Uncaught Error in snapshot listener:",e.toString()))}},{key:"Za",value:function(){this.muted=!0}},{key:"Ya",value:function(e,t){var n=this;setTimeout((function(){n.muted||e(t)}),0)}}]),e}(),Pl=function(){function e(t,n){var r=this;(0,y.Z)(this,e),this.Xa=t,this.serializer=n,this.metadata=new J,this.buffer=new Uint8Array,this.eu=new TextDecoder("utf-8"),this.tu().then((function(e){e&&e.ua()?r.metadata.resolve(e.aa.metadata):r.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             ".concat(JSON.stringify(null==e?void 0:e.aa))))}),(function(e){return r.metadata.reject(e)}))}return(0,m.Z)(e,[{key:"close",value:function(){return this.Xa.cancel()}},{key:"getMetadata",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.metadata.promise);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Ua",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadata();case 2:return e.abrupt("return",this.tu());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"tu",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){var t,n,r,i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.nu();case 2:if(null!==(t=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:return n=this.eu.decode(t),r=Number(n),isNaN(r)&&this.ru("length string (".concat(n,") is not valid number")),e.next=9,this.iu(r);case 9:return i=e.sent,e.abrupt("return",new mc(JSON.parse(i),t.length+r));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"su",value:function(){return this.buffer.findIndex((function(e){return e==="{".charCodeAt(0)}))}},{key:"nu",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){var t,n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.su()<0)){e.next=7;break}return e.next=3,this.ou();case 3:if(!e.sent){e.next=5;break}return e.abrupt("break",7);case 5:e.next=0;break;case 7:if(0!==this.buffer.length){e.next=9;break}return e.abrupt("return",null);case 9:return(t=this.su())<0&&this.ru("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,t),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"iu",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t){var n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.buffer.length<t)){e.next=8;break}return e.next=3,this.ou();case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}this.ru("Reached the end of bundle when more is expected.");case 6:e.next=0;break;case 8:return n=this.eu.decode(this.buffer.slice(0,t)),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"ru",value:function(e){throw this.Xa.cancel(),new Error("Invalid bundle format: ".concat(e))}},{key:"ou",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){var t,n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Xa.read();case 2:return(t=e.sent).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),e.abrupt("return",t.done);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),Fl=function(){function e(t){(0,y.Z)(this,e),this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}return(0,m.Z)(e,[{key:"lookup",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t){var n,r=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!(this.mutations.length>0)){e.next=2;break}throw this.lastTransactionError=new W(H.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;case 2:return e.next=4,function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i,a,u,o;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),i={documents:n.map((function(e){return Ji(r.serializer,e)}))},e.next=4,r.Lo("BatchGetDocuments",r.serializer.databaseId,ve.emptyPath(),i,n.length);case 4:return a=e.sent,u=new Map,a.forEach((function(e){var t=ia(r.serializer,e);u.set(t.key.toString(),t)})),o=[],e.abrupt("return",(n.forEach((function(e){var t=u.get(e.toString());G(!!t),o.push(t)})),o));case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,t);case 4:return n=e.sent,e.abrupt("return",(n.forEach((function(e){return r.recordVersion(e)})),n));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"update",value:function(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}},{key:"delete",value:function(e){this.write(new di(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"commit",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){var t,n=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!this.lastTransactionError){e.next=2;break}throw this.lastTransactionError;case 2:return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(e,t){var r=me.fromPath(t);n.mutations.push(new vi(r,n.precondition(r)))})),e.next=7,function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),i={writes:n.map((function(e){return aa(r.serializer,e)}))},e.next=3,r.Mo("Commit",r.serializer.databaseId,ve.emptyPath(),i);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,this.mutations);case 7:this.committed=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"recordVersion",value:function(e){var t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw j();t=fe.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new W(H.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}},{key:"precondition",value:function(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(fe.min())?Xr.exists(!1):Xr.updateTime(t):Xr.none()}},{key:"preconditionForUpdate",value:function(e){var t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(fe.min()))throw new W(H.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Xr.updateTime(t)}return Xr.exists(!0)}},{key:"write",value:function(e){this.ensureCommitNotCalled(),this.mutations.push(e)}},{key:"ensureCommitNotCalled",value:function(){}}]),e}(),Ll=function(){function e(t,n,r,i,a){(0,y.Z)(this,e),this.asyncQueue=t,this.datastore=n,this.options=r,this.updateFunction=i,this.deferred=a,this._u=r.maxAttempts,this.t_=new rs(this.asyncQueue,"transaction_retry")}return(0,m.Z)(e,[{key:"au",value:function(){this._u-=1,this.uu()}},{key:"uu",value:function(){var e=this;this.t_.Go((0,f.Z)((0,h.Z)().mark((function t(){var n,r;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=new Fl(e.datastore),(r=e.cu(n))&&r.then((function(t){e.asyncQueue.enqueueAndForget((function(){return n.commit().then((function(){e.deferred.resolve(t)})).catch((function(t){e.lu(t)}))}))})).catch((function(t){e.lu(t)}));case 2:case"end":return t.stop()}}),t)}))))}},{key:"cu",value:function(e){try{var t=this.updateFunction(e);return!Qe(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}},{key:"lu",value:function(e){var t=this;this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget((function(){return t.uu(),Promise.resolve()}))):this.deferred.reject(e)}},{key:"hu",value:function(e){if("FirebaseError"===e.name){var t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!wi(t)}return!1}}]),e}(),Vl=function(){function e(t,n,r,i,a){var u=this;(0,y.Z)(this,e),this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=O.UNAUTHENTICATED,this.clientId=oe.newId(),this.authCredentialListener=function(){return Promise.resolve()},this.appCheckCredentialListener=function(){return Promise.resolve()},this._uninitializedComponentsProvider=a,this.authCredentials.start(r,function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q("FirestoreClient","Received user=",t.uid),e.next=3,u.authCredentialListener(t);case 3:u.user=t;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(r,(function(e){return q("FirestoreClient","Received new app check token=",e),u.appCheckCredentialListener(e,u.user)}))}return(0,m.Z)(e,[{key:"configuration",get:function(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}},{key:"setCredentialChangeListener",value:function(e){this.authCredentialListener=e}},{key:"setAppCheckTokenChangeListener",value:function(e){this.appCheckCredentialListener=e}},{key:"terminate",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new J;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,f.Z)((0,h.Z)().mark((function n(){var r;return(0,h.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=e._onlineComponents,!n.t0){n.next=5;break}return n.next=5,e._onlineComponents.terminate();case 5:if(n.t1=e._offlineComponents,!n.t1){n.next=9;break}return n.next=9,e._offlineComponents.terminate();case 9:e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve(),n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),r=ec(n.t2,"Failed to shutdown persistence"),t.reject(r);case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))),t.promise}}]),e}();function ql(e,t){return Ul.apply(this,arguments)}function Ul(){return Ul=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),q("FirestoreClient","Initializing OfflineComponentProvider"),r=t.configuration,e.next=4,n.initialize(r);case 4:i=r.initialUser,t.setCredentialChangeListener(function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.isEqual(t),e.t0){e.next=5;break}return e.next=4,go(n.localStore,t);case 4:i=t;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t._offlineComponents=n;case 6:case"end":return e.stop()}}),e)}))),Ul.apply(this,arguments)}function Bl(e,t){return zl.apply(this,arguments)}function zl(){return(zl=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),e.next=3,jl(t);case 3:return r=e.sent,q("FirestoreClient","Initializing OnlineComponentProvider"),e.next=7,n.initialize(r,t.configuration);case 7:t.setCredentialChangeListener((function(e){return Qs(n.remoteStore,e)})),t.setAppCheckTokenChangeListener((function(e,t){return Qs(n.remoteStore,t)})),t._onlineComponents=n;case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jl(e){return Gl.apply(this,arguments)}function Gl(){return(Gl=(0,f.Z)((0,h.Z)().mark((function e(t){var n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t._offlineComponents){e.next=21;break}if(!t._uninitializedComponentsProvider){e.next=18;break}return q("FirestoreClient","Using user provided OfflineComponentProvider"),e.prev=3,e.next=6,ql(t,t._uninitializedComponentsProvider._offline);case 6:e.next=16;break;case 8:if(e.prev=8,e.t0=e.catch(3),function(e){return"FirebaseError"===e.name?e.code===H.FAILED_PRECONDITION||e.code===H.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n=e.t0)){e.next=13;break}throw n;case 13:return B("Error using user provided cache. Falling back to memory cache: "+n),e.next=16,ql(t,new Cl);case 16:e.next=21;break;case 18:return q("FirestoreClient","Using default OfflineComponentProvider"),e.next=21,ql(t,new Al(void 0));case 21:return e.abrupt("return",t._offlineComponents);case 22:case"end":return e.stop()}}),e,null,[[3,8]])})))).apply(this,arguments)}function Kl(e){return Ql.apply(this,arguments)}function Ql(){return(Ql=(0,f.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t._onlineComponents,e.t0){e.next=11;break}if(!t._uninitializedComponentsProvider){e.next=8;break}return q("FirestoreClient","Using user provided OnlineComponentProvider"),e.next=6,Bl(t,t._uninitializedComponentsProvider._online);case 6:e.next=11;break;case 8:return q("FirestoreClient","Using default OnlineComponentProvider"),e.next=11,Bl(t,new Rl);case 11:return e.abrupt("return",t._onlineComponents);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Hl(e){return jl(e).then((function(e){return e.persistence}))}function Wl(e){return jl(e).then((function(e){return e.localStore}))}function Jl(e){return Kl(e).then((function(e){return e.remoteStore}))}function Yl(e){return Kl(e).then((function(e){return e.syncEngine}))}function Xl(e){return Kl(e).then((function(e){return e.datastore}))}function $l(e){return eh.apply(this,arguments)}function eh(){return(eh=(0,f.Z)((0,h.Z)().mark((function e(t){var n,r;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Kl(t);case 2:return n=e.sent,r=n.eventManager,e.abrupt("return",(r.onListen=Ec.bind(null,n.syncEngine),r.onUnlisten=Oc.bind(null,n.syncEngine),r.onFirstRemoteStoreListen=Cc.bind(null,n.syncEngine),r.onLastRemoteStoreUnlisten=Fc.bind(null,n.syncEngine),r));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function th(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new J;return e.asyncQueue.enqueueAndForget((0,f.Z)((0,h.Z)().mark((function i(){return(0,h.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new Ol({next:function(o){a.Za(),t.enqueueAndForget((function(){return hc(e,u)}));var s=o.docs.has(n);!s&&o.fromCache?i.reject(new W(H.UNAVAILABLE,"Failed to get document because the client is offline.")):s&&o.fromCache&&r&&"server"===r.source?i.reject(new W(H.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(e){return i.reject(e)}}),u=new yc(ar(n.path),a,{includeMetadataChanges:!0,_a:!0});return cc(e,u)},i.next=3,$l(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}function nh(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new J;return e.asyncQueue.enqueueAndForget((0,f.Z)((0,h.Z)().mark((function i(){return(0,h.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new Ol({next:function(n){a.Za(),t.enqueueAndForget((function(){return hc(e,u)})),n.fromCache&&"server"===r.source?i.reject(new W(H.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(e){return i.reject(e)}}),u=new yc(n,a,{includeMetadataChanges:!0,_a:!0});return cc(e,u)},i.next=3,$l(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}function rh(e){var t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}var ih=new Map;function ah(e,t,n){if(!n)throw new W(H.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function uh(e,t,n,r){if(!0===t&&!0===r)throw new W(H.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))}function oh(e){if(!me.isDocumentKey(e))throw new W(H.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function sh(e){if(me.isDocumentKey(e))throw new W(H.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function ch(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}return"function"==typeof e?"a function":j()}function lh(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new W(H.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=ch(e);throw new W(H.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}return e}function hh(e,t){if(t<=0)throw new W(H.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}var fh=function(){function e(t){var n,r;if((0,y.Z)(this,e),void 0===t.host){if(void 0!==t.ssl)throw new W(H.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(n=t.ssl)||void 0===n||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new W(H.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}uh("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=rh(null!==(r=t.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new W(H.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new W(H.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new W(H.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}return(0,m.Z)(e,[{key:"isEqual",value:function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]),e}(),dh=function(){function e(t,n,r,i){(0,y.Z)(this,e),this._authCredentials=t,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new fh({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}return(0,m.Z)(e,[{key:"app",get:function(){if(!this._app)throw new W(H.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return"notTerminated"!==this._terminateTask}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new W(H.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new fh(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new X;switch(e.type){case"firstParty":return new ne(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new W(H.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}},{key:"_restart",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("notTerminated"!==this._terminateTask){e.next=5;break}return e.next=3,this._terminate();case 3:e.next=6;break;case 5:this._terminateTask="notTerminated";case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return function(e){var t=ih.get(e);t&&(q("ComponentProvider","Removing Datastore"),ih.delete(e),t.terminate())}(this),Promise.resolve()}}]),e}();function vh(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=(e=lh(e,dh))._getSettings(),u="".concat(t,":").concat(n);if("firestore.googleapis.com"!==a.host&&a.host!==u&&B("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},a),{host:u,ssl:!1})),i.mockUserToken){var o,s;if("string"==typeof i.mockUserToken)o=i.mockUserToken,s=O.MOCK_USER;else{o=(0,b.Sg)(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);var c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new W(H.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");s=new O(c)}e._authCredentials=new $(new Y(o,s))}}var ph=function(){function e(t,n,r){(0,y.Z)(this,e),this.converter=n,this._query=r,this.type="query",this.firestore=t}return(0,m.Z)(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._query)}}]),e}(),yh=function(){function e(t,n,r){(0,y.Z)(this,e),this.converter=n,this._key=r,this.type="document",this.firestore=t}return(0,m.Z)(e,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new mh(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(t){return new e(this.firestore,t,this._key)}}]),e}(),mh=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i){var a;return(0,y.Z)(this,n),(a=t.call(this,e,r,ar(i)))._path=i,a.type="collection",a}return(0,m.Z)(n,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new yh(this.firestore,null,new me(e))}},{key:"withConverter",value:function(e){return new n(this.firestore,e,this._path)}}]),n}(ph);function gh(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,b.m9)(e),ah("collection","path",t),e instanceof dh){var a=ve.fromString.apply(ve,[t].concat(r));return sh(a),new mh(e,null,a)}if(!(e instanceof yh||e instanceof mh))throw new W(H.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var u=e._path.child(ve.fromString.apply(ve,[t].concat(r)));return sh(u),new mh(e.firestore,null,u)}function kh(e,t){if(e=lh(e,dh),ah("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new W(H.INVALID_ARGUMENT,"Invalid collection ID '".concat(t,"' passed to function collectionGroup(). Collection IDs must not contain '/'."));return new ph(e,null,function(e){return new rr(ve.emptyPath(),e)}(t))}function wh(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,b.m9)(e),1===arguments.length&&(t=oe.newId()),ah("doc","path",t),e instanceof dh){var a=ve.fromString.apply(ve,[t].concat(r));return oh(a),new yh(e,null,new me(a))}if(!(e instanceof yh||e instanceof mh))throw new W(H.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var u=e._path.child(ve.fromString.apply(ve,[t].concat(r)));return oh(u),new yh(e.firestore,e instanceof mh?e.converter:null,new me(u))}function bh(e,t){return e=(0,b.m9)(e),t=(0,b.m9)(t),(e instanceof yh||e instanceof mh)&&(t instanceof yh||t instanceof mh)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function xh(e,t){return e=(0,b.m9)(e),t=(0,b.m9)(t),e instanceof ph&&t instanceof ph&&e.firestore===t.firestore&&vr(e._query,t._query)&&e.converter===t.converter}var Ih=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();(0,y.Z)(this,e),this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new rs(this,"async_queue_retry"),this.Vu=function(){var e=ts();e&&q("AsyncQueue","Visibility state changed to "+e.visibilityState),t.t_.jo()},this.mu=n;var r=ts();r&&"function"==typeof r.addEventListener&&r.addEventListener("visibilitychange",this.Vu)}return(0,m.Z)(e,[{key:"isShuttingDown",get:function(){return this.Iu}},{key:"enqueueAndForget",value:function(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(e){this.fu(),this.gu(e)}},{key:"enterRestrictedMode",value:function(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;var t=ts();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vu)}}},{key:"enqueue",value:function(e){var t=this;if(this.fu(),this.Iu)return new Promise((function(){}));var n=new J;return this.gu((function(){return t.Iu&&t.Au?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))}},{key:"enqueueRetryable",value:function(e){var t=this;this.enqueueAndForget((function(){return t.Pu.push(e),t.pu()}))}},{key:"pu",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){var t=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.Pu.length){e.next=14;break}return e.prev=1,e.next=4,this.Pu[0]();case 4:this.Pu.shift(),this.t_.reset(),e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),Ve(e.t0)){e.next=12;break}throw e.t0;case 12:q("AsyncQueue","Operation failed with retryable error: "+e.t0);case 13:this.Pu.length>0&&this.t_.Go((function(){return t.pu()}));case 14:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"gu",value:function(e){var t=this,n=this.mu.then((function(){return t.du=!0,e().catch((function(e){t.Eu=e,t.du=!1;var n=function(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw U("INTERNAL UNHANDLED ERROR: ",n),e})).then((function(e){return t.du=!1,e}))}));return this.mu=n,n}},{key:"enqueueAfterDelay",value:function(e,t,n){var r=this;this.fu(),this.Ru.indexOf(e)>-1&&(t=0);var i=$s.createAndSchedule(this,e,t,n,(function(e){return r.yu(e)}));return this.Tu.push(i),i}},{key:"fu",value:function(){this.Eu&&j()}},{key:"verifyOperationInProgress",value:function(){}},{key:"wu",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){var t;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.mu,e.next=3,t;case 3:if(t!==this.mu){e.next=0;break}case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Su",value:function(e){var t,n=(0,l.Z)(this.Tu);try{for(n.s();!(t=n.n()).done;){if(t.value.timerId===e)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"bu",value:function(e){var t=this;return this.wu().then((function(){t.Tu.sort((function(e,t){return e.targetTimeMs-t.targetTimeMs}));var n,r=(0,l.Z)(t.Tu);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),"all"!==e&&i.timerId===e)break}}catch(a){r.e(a)}finally{r.f()}return t.wu()}))}},{key:"Du",value:function(e){this.Ru.push(e)}},{key:"yu",value:function(e){var t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}]),e}();function _h(e){return function(e,t){if("object"!=typeof e||null===e)return!1;var n,r=e,i=(0,l.Z)(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in r&&"function"==typeof r[a])return!0}}catch(u){i.e(u)}finally{i.f()}return!1}(e,["next","error","complete"])}var Th=function(){function e(){(0,y.Z)(this,e),this._progressObserver={},this._taskCompletionResolver=new J,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return(0,m.Z)(e,[{key:"onProgress",value:function(e,t,n){this._progressObserver={next:e,error:t,complete:n}}},{key:"catch",value:function(e){return this._taskCompletionResolver.promise.catch(e)}},{key:"then",value:function(e,t){return this._taskCompletionResolver.promise.then(e,t)}},{key:"_completeWith",value:function(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}},{key:"_failWith",value:function(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}},{key:"_updateProgress",value:function(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}]),e}(),Zh=-1,Eh=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i,a){var u;return(0,y.Z)(this,n),(u=t.call(this,e,r,i,a)).type="firestore",u._queue=new Ih,u._persistenceKey=(null==a?void 0:a.name)||"[DEFAULT]",u}return(0,m.Z)(n,[{key:"_terminate",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(){var t;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._firestoreClient){e.next=6;break}return t=this._firestoreClient.terminate(),this._queue=new Ih(t),this._firestoreClient=void 0,e.next=6,t;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(dh);function Sh(e,t,n){n||(n="(default)");var r=(0,g.qX)(e,"firestore");if(r.isInitialized(n)){var i=r.getImmediate({identifier:n}),a=r.getOptions(n);if((0,b.vZ)(a,t))return i;throw new W(H.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new W(H.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new W(H.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:t,instanceIdentifier:n})}function Ch(e,t){var n="object"==typeof e?e:(0,g.Mq)(),r="string"==typeof e?e:t||"(default)",i=(0,g.qX)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){var a=(0,b.P0)("firestore");a&&vh.apply(void 0,[i].concat((0,p.Z)(a)))}return i}function Ah(e){if(e._terminated)throw new W(H.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||Dh(e),e._firestoreClient}function Dh(e){var t,n,r,i=e._freezeSettings(),a=function(e,t,n,r){return new Ht(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,rh(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new Vl(e._authCredentials,e._appCheckCredentials,e._queue,a,e._componentsProvider&&function(e){var t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}function Nh(e,t){B("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");var n=e._freezeSettings();return Oh(e,Rl.provider,{build:function(e){return new Dl(e,n.cacheSizeBytes,null==t?void 0:t.forceOwnership)}}),Promise.resolve()}function Rh(e){return Mh.apply(this,arguments)}function Mh(){return(Mh=(0,f.Z)((0,h.Z)().mark((function e(t){var n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead."),n=t._freezeSettings(),Oh(t,Rl.provider,{build:function(e){return new Nl(e,n.cacheSizeBytes)}});case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oh(e,t,n){if((e=lh(e,Eh))._firestoreClient||e._terminated)throw new W(H.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new W(H.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},Dh(e)}function Ph(e){if(e._initialized&&!e._terminated)throw new W(H.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var t=new J;return e._queue.enqueueAndForgetEvenWhileRestricted((0,f.Z)((0,h.Z)().mark((function n(){return(0,h.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t){var n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Oe.D()){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return n=t+"main",e.next=5,Oe.delete(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(ho(e._databaseId,e._persistenceKey));case 3:t.resolve(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t.reject(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})))),t.promise}function Fh(e){return function(e){var t=new J;return e.asyncQueue.enqueueAndForget((0,f.Z)((0,h.Z)().mark((function n(){return(0,h.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=Jc,n.next=3,Yl(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)})))),t.promise}(Ah(e=lh(e,Eh)))}function Lh(e){return function(e){return e.asyncQueue.enqueue((0,f.Z)((0,h.Z)().mark((function t(){var n,r;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Hl(e);case 2:return n=t.sent,t.next=5,Jl(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!0),function(e){var t=Q(e);return t.L_.delete(0),ls(t)}(r)));case 7:case"end":return t.stop()}}),t)}))))}(Ah(e=lh(e,Eh)))}function Vh(e){return function(e){return e.asyncQueue.enqueue((0,f.Z)((0,h.Z)().mark((function t(){var n,r;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Hl(e);case 2:return n=t.sent,t.next=5,Jl(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!1),function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t){var n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=Q(t)).L_.add(0),e.next=4,fs(n);case 4:n.q_.set("Offline");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(r)));case 7:case"end":return t.stop()}}),t)}))))}(Ah(e=lh(e,Eh)))}function qh(e){return(0,g.wN)(e.app,"firestore",e._databaseId.database),e._delete()}function Uh(e,t){var n=Ah(e=lh(e,Eh)),r=new Th;return function(e,t,n,r){var i=function(e,t){return function(e,t){return new Pl(e,t)}(function(e,t){if(e instanceof Uint8Array)return Ml(e,t);if(e instanceof ArrayBuffer)return Ml(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?Ii().encode(e):e),t)}(n,ns(t));e.asyncQueue.enqueueAndForget((0,f.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Sl,t.next=3,Yl(e);case 3:t.t1=t.sent,t.t2=i,t.t3=r,(0,t.t0)(t.t1,t.t2,t.t3);case 7:case"end":return t.stop()}}),t)}))))}(n,e._databaseId,t,r),r}function Bh(e,t){return function(e,t){return e.asyncQueue.enqueue((0,f.Z)((0,h.Z)().mark((function n(){return(0,h.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=function(e,t){var n=Q(e);return n.persistence.runTransaction("Get named query","readonly",(function(e){return n.Gr.getNamedQuery(e,t)}))},n.next=3,Wl(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)}))))}(Ah(e=lh(e,Eh)),t).then((function(t){return t?new ph(e,null,t.query):null}))}var zh=(0,m.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"count",n=arguments.length>1?arguments[1]:void 0;(0,y.Z)(this,e),this._internalFieldPath=n,this.type="AggregateField",this.aggregateType=t})),jh=function(){function e(t,n,r){(0,y.Z)(this,e),this._userDataWriter=n,this._data=r,this.type="AggregateQuerySnapshot",this.query=t}return(0,m.Z)(e,[{key:"data",value:function(){return this._userDataWriter.convertObjectMap(this._data)}}]),e}(),Gh=function(){function e(t){(0,y.Z)(this,e),this._byteString=t}return(0,m.Z)(e,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(t){try{return new e(qt.fromBase64String(t))}catch(t){throw new W(H.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}},{key:"fromUint8Array",value:function(t){return new e(qt.fromUint8Array(t))}}]),e}(),Kh=function(){function e(){(0,y.Z)(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;++i)if(0===n[i].length)throw new W(H.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ye(n)}return(0,m.Z)(e,[{key:"isEqual",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}();function Qh(){return new Kh("__name__")}var Hh=(0,m.Z)((function e(t){(0,y.Z)(this,e),this._methodName=t})),Wh=function(){function e(t,n){if((0,y.Z)(this,e),!isFinite(t)||t<-90||t>90)throw new W(H.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new W(H.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return(0,m.Z)(e,[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(e){return se(this._lat,e._lat)||se(this._long,e._long)}}]),e}(),Jh=function(){function e(t){(0,y.Z)(this,e),this._values=(t||[]).map((function(e){return e}))}return(0,m.Z)(e,[{key:"toArray",value:function(){return this._values.map((function(e){return e}))}},{key:"isEqual",value:function(e){return function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}]),e}(),Yh=/^__.*__$/,Xh=function(){function e(t,n,r){(0,y.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,m.Z)(e,[{key:"toMutation",value:function(e,t){return null!==this.fieldMask?new oi(e,this.data,this.fieldMask,t,this.fieldTransforms):new ui(e,this.data,t,this.fieldTransforms)}}]),e}(),$h=function(){function e(t,n,r){(0,y.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,m.Z)(e,[{key:"toMutation",value:function(e,t){return new oi(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]),e}();function ef(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw j()}}var tf=function(){function e(t,n,r,i,a,u){(0,y.Z)(this,e),this.settings=t,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===a&&this.vu(),this.fieldTransforms=a||[],this.fieldMask=u||[]}return(0,m.Z)(e,[{key:"path",get:function(){return this.settings.path}},{key:"Cu",get:function(){return this.settings.Cu}},{key:"Fu",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"Mu",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.Ou(e),r}},{key:"Nu",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.vu(),r}},{key:"Lu",value:function(e){return this.Fu({path:void 0,xu:!0})}},{key:"Bu",value:function(e){return xf(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}},{key:"contains",value:function(e){return void 0!==this.fieldMask.find((function(t){return e.isPrefixOf(t)}))||void 0!==this.fieldTransforms.find((function(t){return e.isPrefixOf(t.field)}))}},{key:"vu",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}},{key:"Ou",value:function(e){if(0===e.length)throw this.Bu("Document fields must not be empty");if(ef(this.Cu)&&Yh.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}]),e}(),nf=function(){function e(t,n,r){(0,y.Z)(this,e),this.databaseId=t,this.ignoreUndefinedProperties=n,this.serializer=r||ns(t)}return(0,m.Z)(e,[{key:"Qu",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new tf({Cu:e,methodName:t,qu:n,path:ye.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}]),e}();function rf(e){var t=e._freezeSettings(),n=ns(e._databaseId);return new nf(e._databaseId,!!t.ignoreUndefinedProperties,n)}function af(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},u=e.Qu(a.merge||a.mergeFields?2:0,t,n,i);gf("Data must be an object, but it was:",u,r);var o,s,c=yf(r,u);if(a.merge)o=new Ft(u.fieldMask),s=u.fieldTransforms;else if(a.mergeFields){var h,f=[],d=(0,l.Z)(a.mergeFields);try{for(d.s();!(h=d.n()).done;){var v=kf(t,h.value,n);if(!u.contains(v))throw new W(H.INVALID_ARGUMENT,"Field '".concat(v,"' is specified in your field mask but missing from your input data."));If(f,v)||f.push(v)}}catch(p){d.e(p)}finally{d.f()}o=new Ft(f),s=u.fieldTransforms.filter((function(e){return o.covers(e.field)}))}else o=null,s=u.fieldTransforms;return new Xh(new xn(c),o,s)}var uf=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"_toFieldTransform",value:function(e){if(2!==e.Cu)throw 1===e.Cu?e.Bu("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Bu("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(Hh);function of(e,t,n){return new tf({Cu:3,qu:t.settings.qu,methodName:e._methodName,xu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var sf=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"_toFieldTransform",value:function(e){return new Jr(e.path,new Br)}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(Hh),cf=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this,e)).Ku=r,i}return(0,m.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=of(this,e,!0),n=this.Ku.map((function(e){return pf(e,t)})),r=new zr(n);return new Jr(e.path,r)}},{key:"isEqual",value:function(e){return e instanceof n&&(0,b.vZ)(this.Ku,e.Ku)}}]),n}(Hh),lf=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this,e)).Ku=r,i}return(0,m.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=of(this,e,!0),n=this.Ku.map((function(e){return pf(e,t)})),r=new Gr(n);return new Jr(e.path,r)}},{key:"isEqual",value:function(e){return e instanceof n&&(0,b.vZ)(this.Ku,e.Ku)}}]),n}(Hh),hf=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this,e)).$u=r,i}return(0,m.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=new Qr(e.serializer,Fr(e.serializer,this.$u));return new Jr(e.path,t)}},{key:"isEqual",value:function(e){return e instanceof n&&this.$u===e.$u}}]),n}(Hh);function ff(e,t,n,r){var i=e.Qu(1,t,n);gf("Data must be an object, but it was:",i,r);var a=[],u=xn.empty();St(r,(function(e,r){var o=bf(t,e,n);r=(0,b.m9)(r);var s=i.Nu(o);if(r instanceof uf)a.push(o);else{var c=pf(r,s);null!=c&&(a.push(o),u.set(o,c))}}));var o=new Ft(a);return new $h(u,o,i.fieldTransforms)}function df(e,t,n,r,i,a){var u=e.Qu(1,t,n),o=[kf(t,r,n)],s=[i];if(a.length%2!=0)throw new W(H.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var c=0;c<a.length;c+=2)o.push(kf(t,a[c])),s.push(a[c+1]);for(var l=[],h=xn.empty(),f=o.length-1;f>=0;--f)if(!If(l,o[f])){var d=o[f],v=s[f];v=(0,b.m9)(v);var p=u.Nu(d);if(v instanceof uf)l.push(d);else{var y=pf(v,p);null!=y&&(l.push(d),h.set(d,y))}}var m=new Ft(l);return new $h(h,m,u.fieldTransforms)}function vf(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return pf(n,e.Qu(r?4:3,t))}function pf(e,t){if(mf(e=(0,b.m9)(e)))return gf("Unsupported field value:",t,e),yf(e,t);if(e instanceof Hh)return function(e,t){if(!ef(t.Cu))throw t.Bu("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Bu("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.xu&&4!==t.Cu)throw t.Bu("Nested arrays are not supported");return function(e,t){var n,r=[],i=0,a=(0,l.Z)(e);try{for(a.s();!(n=a.n()).done;){var u=pf(n.value,t.Lu(i));null==u&&(u={nullValue:"NULL_VALUE"}),r.push(u),i++}}catch(o){a.e(o)}finally{a.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=(0,b.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Fr(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=he.fromDate(e);return{timestampValue:zi(t.serializer,n)}}if(e instanceof he){var r=new he(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:zi(t.serializer,r)}}if(e instanceof Wh)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Gh)return{bytesValue:ji(t.serializer,e._byteString)};if(e instanceof yh){var i=t.databaseId,a=e.firestore._databaseId;if(!a.isEqual(i))throw t.Bu("Document reference is for database ".concat(a.projectId,"/").concat(a.database," but should be for database ").concat(i.projectId,"/").concat(i.database));return{referenceValue:Qi(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Jh)return function(e,t){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:e.toArray().map((function(e){if("number"!=typeof e)throw t.Bu("VectorValues must only contain numeric values.");return Or(t.serializer,e)}))}}}}}}(e,t);throw t.Bu("Unsupported field value: ".concat(ch(e)))}(e,t)}function yf(e,t){var n={};return At(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):St(e,(function(e,r){var i=pf(r,t.Mu(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function mf(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof he||e instanceof Wh||e instanceof Gh||e instanceof yh||e instanceof Hh||e instanceof Jh)}function gf(e,t,n){if(!mf(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var r=ch(n);throw"an object"===r?t.Bu(e+" a custom object"):t.Bu(e+" "+r)}}function kf(e,t,n){if((t=(0,b.m9)(t))instanceof Kh)return t._internalPath;if("string"==typeof t)return bf(e,t);throw xf("Field path arguments must be of type string or ",e,!1,void 0,n)}var wf=new RegExp("[~\\*/\\[\\]]");function bf(e,t,n){if(t.search(wf)>=0)throw xf("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return(0,a.Z)(Kh,(0,p.Z)(t.split(".")))._internalPath}catch(r){throw xf("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function xf(e,t,n,r,i){var a=r&&!r.isEmpty(),u=void 0!==i,o="Function ".concat(t,"() called with invalid data");n&&(o+=" (via `toFirestore()`)"),o+=". ";var s="";return(a||u)&&(s+=" (found",a&&(s+=" in field ".concat(r)),u&&(s+=" in document ".concat(i)),s+=")"),new W(H.INVALID_ARGUMENT,o+e+s)}function If(e,t){return e.some((function(e){return e.isEqual(t)}))}var _f=function(){function e(t,n,r,i,a){(0,y.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=a}return(0,m.Z)(e,[{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new yh(this._firestore,this._converter,this._key)}},{key:"exists",value:function(){return null!==this._document}},{key:"data",value:function(){if(this._document){if(this._converter){var e=new Tf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(e){if(this._document){var t=this._document.data.field(Zf("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]),e}(),Tf=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"data",value:function(){return(0,u.Z)((0,o.Z)(n.prototype),"data",this).call(this)}}]),n}(_f);function Zf(e,t){return"string"==typeof t?bf(e,t):t instanceof Kh?t._internalPath:t._delegate._internalPath}function Ef(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new W(H.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Sf=(0,m.Z)((function e(){(0,y.Z)(this,e)})),Cf=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n)}(Sf);function Af(e,t){for(var n=[],r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];t instanceof Sf&&n.push(t),function(e){var t=e.filter((function(e){return e instanceof Rf})).length,n=e.filter((function(e){return e instanceof Df})).length;if(t>1||t>0&&n>0)throw new W(H.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(i));var u,o=(0,l.Z)(n);try{for(o.s();!(u=o.n()).done;){e=u.value._apply(e)}}catch(s){o.e(s)}finally{o.f()}return e}var Df=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i){var a;return(0,y.Z)(this,n),(a=t.call(this))._field=e,a._op=r,a._value=i,a.type="where",a}return(0,m.Z)(n,[{key:"_apply",value:function(e){var t=this._parse(e);return Jf(e._query,t),new ph(e.firestore,e.converter,fr(e._query,t))}},{key:"_parse",value:function(e){var t=rf(e.firestore),n=function(e,t,n,r,i,a,u){var o;if(i.isKeyField()){if("array-contains"===a||"array-contains-any"===a)throw new W(H.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(a,"' queries on documentId()."));if("in"===a||"not-in"===a){Wf(u,a);var s,c=[],h=(0,l.Z)(u);try{for(h.s();!(s=h.n()).done;){var f=s.value;c.push(Hf(r,e,f))}}catch(d){h.e(d)}finally{h.f()}o={arrayValue:{values:c}}}else o=Hf(r,e,u)}else"in"!==a&&"not-in"!==a&&"array-contains-any"!==a||Wf(u,a),o=vf(n,t,u,"in"===a||"not-in"===a);return Dn.create(i,a,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}],[{key:"_create",value:function(e,t,r){return new n(e,t,r)}}]),n}(Cf);function Nf(e,t,n){var r=t,i=Zf("where",e);return Df._create(i,r,n)}var Rf=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this)).type=e,i._queryConstraints=r,i}return(0,m.Z)(n,[{key:"_parse",value:function(e){var t=this._queryConstraints.map((function(t){return t._parse(e)})).filter((function(e){return e.getFilters().length>0}));return 1===t.length?t[0]:Nn.create(t,this._getOperator())}},{key:"_apply",value:function(e){var t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){var n,r=e,i=t.getFlattenedFilters(),a=(0,l.Z)(i);try{for(a.s();!(n=a.n()).done;){var u=n.value;Jf(r,u),r=fr(r,u)}}catch(o){a.e(o)}finally{a.f()}}(e._query,t),new ph(e.firestore,e.converter,fr(e._query,t)))}},{key:"_getQueryConstraints",value:function(){return this._queryConstraints}},{key:"_getOperator",value:function(){return"and"===this.type?"and":"or"}}],[{key:"_create",value:function(e,t){return new n(e,t)}}]),n}(Sf);function Mf(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.forEach((function(e){return Yf("or",e)})),Rf._create("or",t)}function Of(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.forEach((function(e){return Yf("and",e)})),Rf._create("and",t)}var Pf=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this))._field=e,i._direction=r,i.type="orderBy",i}return(0,m.Z)(n,[{key:"_apply",value:function(e){var t=function(e,t,n){if(null!==e.startAt)throw new W(H.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new W(H.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Sn(t,n)}(e._query,this._field,this._direction);return new ph(e.firestore,e.converter,function(e,t){var n=e.explicitOrderBy.concat([t]);return new rr(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}],[{key:"_create",value:function(e,t){return new n(e,t)}}]),n}(Cf);function Ff(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=Zf("orderBy",e);return Pf._create(n,t)}var Lf=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i){var a;return(0,y.Z)(this,n),(a=t.call(this)).type=e,a._limit=r,a._limitType=i,a}return(0,m.Z)(n,[{key:"_apply",value:function(e){return new ph(e.firestore,e.converter,dr(e._query,this._limit,this._limitType))}}],[{key:"_create",value:function(e,t,r){return new n(e,t,r)}}]),n}(Cf);function Vf(e){return hh("limit",e),Lf._create("limit",e,"F")}function qf(e){return hh("limitToLast",e),Lf._create("limitToLast",e,"L")}var Uf=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i){var a;return(0,y.Z)(this,n),(a=t.call(this)).type=e,a._docOrFields=r,a._inclusive=i,a}return(0,m.Z)(n,[{key:"_apply",value:function(e){var t=Qf(e,this.type,this._docOrFields,this._inclusive);return new ph(e.firestore,e.converter,function(e,t){return new rr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}],[{key:"_create",value:function(e,t,r){return new n(e,t,r)}}]),n}(Cf);function Bf(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Uf._create("startAt",t,!0)}function zf(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Uf._create("startAfter",t,!1)}var jf=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i){var a;return(0,y.Z)(this,n),(a=t.call(this)).type=e,a._docOrFields=r,a._inclusive=i,a}return(0,m.Z)(n,[{key:"_apply",value:function(e){var t=Qf(e,this.type,this._docOrFields,this._inclusive);return new ph(e.firestore,e.converter,function(e,t){return new rr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}],[{key:"_create",value:function(e,t,r){return new n(e,t,r)}}]),n}(Cf);function Gf(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return jf._create("endBefore",t,!1)}function Kf(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return jf._create("endAt",t,!0)}function Qf(e,t,n,r){if(n[0]=(0,b.m9)(n[0]),n[0]instanceof _f)return function(e,t,n,r,i){if(!r)throw new W(H.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for ".concat(n,"()."));var a,u=[],o=(0,l.Z)(sr(e));try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.field.isKeyField())u.push(sn(t,r.key));else{var c=r.data.field(s.field);if(Gt(c))throw new W(H.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=s.field.canonicalString();throw new W(H.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '".concat(h,"' (used as the orderBy) does not exist."))}u.push(c)}}}catch(f){o.e(f)}finally{o.f()}return new Tn(u,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=rf(e.firestore);return function(e,t,n,r,i,a){var u=e.explicitOrderBy;if(i.length>u.length)throw new W(H.INVALID_ARGUMENT,"Too many arguments provided to ".concat(r,"(). The number of arguments must be less than or equal to the number of orderBy() clauses"));for(var o=[],s=0;s<i.length;s++){var c=i[s];if(u[s].field.isKeyField()){if("string"!=typeof c)throw new W(H.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in ".concat(r,"(), but got a ").concat(typeof c));if(!or(e)&&-1!==c.indexOf("/"))throw new W(H.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by documentId(), the value passed to ".concat(r,"() must be a plain document ID, but '").concat(c,"' contains a slash."));var l=e.path.child(ve.fromString(c));if(!me.isDocumentKey(l))throw new W(H.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by documentId(), the value passed to ".concat(r,"() must result in a valid document path, but '").concat(l,"' is not because it contains an odd number of segments."));var h=new me(l);o.push(sn(t,h))}else{var f=vf(n,r,c);o.push(f)}}return new Tn(o,a)}(e._query,e.firestore._databaseId,i,t,n,r)}function Hf(e,t,n){if("string"==typeof(n=(0,b.m9)(n))){if(""===n)throw new W(H.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!or(t)&&-1!==n.indexOf("/"))throw new W(H.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));var r=t.path.child(ve.fromString(n));if(!me.isDocumentKey(r))throw new W(H.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return sn(e,new me(r))}if(n instanceof yh)return sn(e,n._key);throw new W(H.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(ch(n),"."))}function Wf(e,t){if(!Array.isArray(e)||0===e.length)throw new W(H.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function Jf(e,t){var n=function(e,t){var n,r=(0,l.Z)(e);try{for(r.s();!(n=r.n()).done;){var i,a=n.value,u=(0,l.Z)(a.getFlattenedFilters());try{for(u.s();!(i=u.n()).done;){var o=i.value;if(t.indexOf(o.op)>=0)return o.op}}catch(s){u.e(s)}finally{u.f()}}}catch(s){r.e(s)}finally{r.f()}return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new W(H.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new W(H.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}function Yf(e,t){if(!(t instanceof Df||t instanceof Rf))throw new W(H.INVALID_ARGUMENT,"Function ".concat(e,"() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'."))}var Xf=function(){function e(){(0,y.Z)(this,e)}return(0,m.Z)(e,[{key:"convertValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Xt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return zt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(jt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw j()}}},{key:"convertObject",value:function(e,t){return this.convertObjectMap(e.fields,t)}},{key:"convertObjectMap",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",r={};return St(e,(function(e,i){r[e]=t.convertValue(i,n)})),r}},{key:"convertVectorValue",value:function(e){var t,n,r,i=null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map((function(e){return zt(e.doubleValue)}));return new Jh(i)}},{key:"convertGeoPoint",value:function(e){return new Wh(zt(e.latitude),zt(e.longitude))}},{key:"convertArray",value:function(e,t){var n=this;return(e.values||[]).map((function(e){return n.convertValue(e,t)}))}},{key:"convertServerTimestamp",value:function(e,t){switch(t){case"previous":var n=Kt(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Qt(e));default:return null}}},{key:"convertTimestamp",value:function(e){var t=Bt(e);return new he(t.seconds,t.nanos)}},{key:"convertDocumentKey",value:function(e,t){var n=ve.fromString(e);G(ka(n));var r=new Wt(n.get(1),n.get(3)),i=new me(n.popFirst(5));return r.isEqual(t)||U("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}]),e}();function $f(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var ed=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,m.Z)(n,[{key:"convertBytes",value:function(e){return new Gh(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new yh(this.firestore,null,t)}}]),n}(Xf);function td(e){return new zh("sum",kf("sum",e))}function nd(e){return new zh("avg",kf("average",e))}function rd(){return new zh("count")}function id(e,t){var n,r;return e instanceof zh&&t instanceof zh&&e.aggregateType===t.aggregateType&&(null===(n=e._internalFieldPath)||void 0===n?void 0:n.canonicalString())===(null===(r=t._internalFieldPath)||void 0===r?void 0:r.canonicalString())}function ad(e,t){return xh(e.query,t.query)&&(0,b.vZ)(e.data(),t.data())}var ud=function(){function e(t,n){(0,y.Z)(this,e),this.hasPendingWrites=t,this.fromCache=n}return(0,m.Z)(e,[{key:"isEqual",value:function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]),e}(),od=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i,a,u,o){var s;return(0,y.Z)(this,n),(s=t.call(this,e,r,i,a,o))._firestore=e,s._firestoreImpl=e,s.metadata=u,s}return(0,m.Z)(n,[{key:"exists",value:function(){return(0,u.Z)((0,o.Z)(n.prototype),"exists",this).call(this)}},{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var t=new sd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(Zf("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]),n}(_f),sd=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,u.Z)((0,o.Z)(n.prototype),"data",this).call(this,e)}}]),n}(od),cd=function(){function e(t,n,r,i){(0,y.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new ud(i.hasPendingWrites,i.fromCache),this.query=r}return(0,m.Z)(e,[{key:"docs",get:function(){var e=[];return this.forEach((function(t){return e.push(t)})),e}},{key:"size",get:function(){return this._snapshot.docs.size}},{key:"empty",get:function(){return 0===this.size}},{key:"forEach",value:function(e,t){var n=this;this._snapshot.docs.forEach((function(r){e.call(t,new sd(n._firestore,n._userDataWriter,r.key,r,new ud(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))}},{key:"docChanges",value:function(){var e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new W(H.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map((function(t){var r=new sd(e._firestore,e._userDataWriter,t.doc.key,t.doc,new ud(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);return t.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((function(e){return t||3!==e.type})).map((function(t){var n=new sd(e._firestore,e._userDataWriter,t.doc.key,t.doc,new ud(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(a=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:ld(t.type),doc:n,oldIndex:i,newIndex:a}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}]),e}();function ld(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return j()}}function hd(e,t){return e instanceof od&&t instanceof od?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof cd&&t instanceof cd&&e._firestore===t._firestore&&xh(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function fd(e){e=lh(e,yh);var t=lh(e.firestore,Eh);return th(Ah(t),e._key).then((function(n){return Zd(t,e,n)}))}var dd=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,m.Z)(n,[{key:"convertBytes",value:function(e){return new Gh(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new yh(this.firestore,null,t)}}]),n}(Xf);function vd(e){e=lh(e,yh);var t=lh(e.firestore,Eh),n=Ah(t),r=new dd(t);return function(e,t){var n=new J;return e.asyncQueue.enqueueAndForget((0,f.Z)((0,h.Z)().mark((function r(){return(0,h.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t,n,r){var i,a;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,function(e,t){var n=Q(e);return n.persistence.runTransaction("read document","readonly",(function(e){return n.localDocuments.getDocument(e,t)}))}(t,n);case 3:(i=e.sent).isFoundDocument()?r.resolve(i):i.isNoDocument()?r.resolve(null):r.reject(new W(H.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),a=ec(e.t0,"Failed to get document '".concat(n," from cache")),r.reject(a);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Wl(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._key).then((function(n){return new od(t,r,e._key,n,new ud(null!==n&&n.hasLocalMutations,!0),e.converter)}))}function pd(e){e=lh(e,yh);var t=lh(e.firestore,Eh);return th(Ah(t),e._key,{source:"server"}).then((function(n){return Zd(t,e,n)}))}function yd(e){e=lh(e,ph);var t=lh(e.firestore,Eh),n=Ah(t),r=new dd(t);return Ef(e._query),nh(n,e._query).then((function(n){return new cd(t,r,e,n)}))}function md(e){e=lh(e,ph);var t=lh(e.firestore,Eh),n=Ah(t),r=new dd(t);return function(e,t){var n=new J;return e.asyncQueue.enqueueAndForget((0,f.Z)((0,h.Z)().mark((function r(){return(0,h.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t,n,r){var i,a,u,o,s;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,So(t,n,!0);case 3:i=e.sent,a=new Ic(n,i.Ts),u=a.ma(i.documents),o=a.applyChanges(u,!1),r.resolve(o.snapshot),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),s=ec(e.t0,"Failed to execute query '".concat(n," against cache")),r.reject(s);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Wl(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._query).then((function(n){return new cd(t,r,e,n)}))}function gd(e){e=lh(e,ph);var t=lh(e.firestore,Eh),n=Ah(t),r=new dd(t);return nh(n,e._query,{source:"server"}).then((function(n){return new cd(t,r,e,n)}))}function kd(e,t,n){e=lh(e,yh);var r=lh(e.firestore,Eh),i=$f(e.converter,t,n);return Td(r,[af(rf(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Xr.none())])}function wd(e,t,n){e=lh(e,yh);for(var r=lh(e.firestore,Eh),i=rf(r),a=arguments.length,u=new Array(a>3?a-3:0),o=3;o<a;o++)u[o-3]=arguments[o];return Td(r,[("string"==typeof(t=(0,b.m9)(t))||t instanceof Kh?df(i,"updateDoc",e._key,t,n,u):ff(i,"updateDoc",e._key,t)).toMutation(e._key,Xr.exists(!0))])}function bd(e){return Td(lh(e.firestore,Eh),[new di(e._key,Xr.none())])}function xd(e,t){var n=lh(e.firestore,Eh),r=wh(e),i=$f(e.converter,t);return Td(n,[af(rf(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Xr.exists(!1))]).then((function(){return r}))}function Id(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,a,u;e=(0,b.m9)(e);var o={includeMetadataChanges:!1,source:"default"},s=0;"object"!=typeof n[s]||_h(n[s])||(o=n[s],s++);var c,l,d,v={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(_h(n[s])){var p=n[s];n[s]=null===(i=p.next)||void 0===i?void 0:i.bind(p),n[s+1]=null===(a=p.error)||void 0===a?void 0:a.bind(p),n[s+2]=null===(u=p.complete)||void 0===u?void 0:u.bind(p)}if(e instanceof yh)l=lh(e.firestore,Eh),d=ar(e._key.path),c={next:function(t){n[s]&&n[s](Zd(l,e,t))},error:n[s+1],complete:n[s+2]};else{var y=lh(e,ph);l=lh(y.firestore,Eh),d=y._query;var m=new dd(l);c={next:function(e){n[s]&&n[s](new cd(l,m,y,e))},error:n[s+1],complete:n[s+2]},Ef(e._query)}return function(e,t,n,r){var i=new Ol(r),a=new yc(t,i,n);return e.asyncQueue.enqueueAndForget((0,f.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=cc,t.next=3,$l(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){i.Za(),e.asyncQueue.enqueueAndForget((0,f.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=hc,t.next=3,$l(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(Ah(l),d,v,c)}function _d(e,t){return function(e,t){var n=new Ol(t);return e.asyncQueue.enqueueAndForget((0,f.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){Q(e).Y_.add(t),t.next()},t.next=3,$l(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){n.Za(),e.asyncQueue.enqueueAndForget((0,f.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){Q(e).Y_.delete(t)},t.next=3,$l(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(Ah(e=lh(e,Eh)),_h(t)?t:{next:t})}function Td(e,t){return function(e,t){var n=new J;return e.asyncQueue.enqueueAndForget((0,f.Z)((0,h.Z)().mark((function r(){return(0,h.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=Vc,r.next=3,Yl(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(Ah(e),t)}function Zd(e,t,n){var r=n.docs.get(t._key),i=new dd(e);return new od(e,i,t._key,r,new ud(n.hasPendingWrites,n.fromCache),t.converter)}function Ed(e){return Sd(e,{count:rd()})}function Sd(e,t){var n=lh(e.firestore,Eh),r=Ah(n),i=Ct(t,(function(e,t){return new gi(t,e.aggregateType,e._internalFieldPath)}));return function(e,t,n){var r=new J;return e.asyncQueue.enqueueAndForget((0,f.Z)((0,h.Z)().mark((function i(){var a;return(0,h.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,Xl(e);case 3:a=i.sent,r.resolve(function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t,n,r){var i,a,u,o,s,c,l,f;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Q(t),u=ca(a.serializer,lr(n),r),o=u.request,s=u.ut,c=u.parent,a.connection.Fo||delete o.parent,e.next=4,a.Lo("RunAggregationQuery",a.serializer.databaseId,c,o,1);case 4:return l=e.sent.filter((function(e){return!!e.result})),G(1===l.length),f=null===(i=l[0].result)||void 0===i?void 0:i.aggregateFields,e.abrupt("return",Object.keys(f).reduce((function(e,t){return e[s[t]]=f[t],e}),{}));case 8:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()(a,t,n)),i.next=10;break;case 7:i.prev=7,i.t0=i.catch(0),r.reject(i.t0);case 10:case"end":return i.stop()}}),i,null,[[0,7]])})))),r.promise}(r,e._query,i).then((function(t){return function(e,t,n){var r=new dd(e);return new jh(t,r,n)}(n,e,t)}))}var Cd=function(){function e(t){(0,y.Z)(this,e),this.kind="memory",this._onlineComponentProvider=Rl.provider,(null==t?void 0:t.garbageCollector)?this._offlineComponentProvider=t.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:function(){return new Al(void 0)}}}return(0,m.Z)(e,[{key:"toJSON",value:function(){return{kind:this.kind}}}]),e}(),Ad=function(){function e(t){var n;(0,y.Z)(this,e),this.kind="persistent",(null==t?void 0:t.tabManager)?(t.tabManager._initialize(t),n=t.tabManager):(n=Vd(void 0))._initialize(t),this._onlineComponentProvider=n._onlineComponentProvider,this._offlineComponentProvider=n._offlineComponentProvider}return(0,m.Z)(e,[{key:"toJSON",value:function(){return{kind:this.kind}}}]),e}(),Dd=function(){function e(){(0,y.Z)(this,e),this.kind="memoryEager",this._offlineComponentProvider=Cl.provider}return(0,m.Z)(e,[{key:"toJSON",value:function(){return{kind:this.kind}}}]),e}(),Nd=function(){function e(t){(0,y.Z)(this,e),this.kind="memoryLru",this._offlineComponentProvider={build:function(){return new Al(t)}}}return(0,m.Z)(e,[{key:"toJSON",value:function(){return{kind:this.kind}}}]),e}();function Rd(){return new Dd}function Md(e){return new Nd(null==e?void 0:e.cacheSizeBytes)}function Od(e){return new Cd(e)}function Pd(e){return new Ad(e)}var Fd=function(){function e(t){(0,y.Z)(this,e),this.forceOwnership=t,this.kind="persistentSingleTab"}return(0,m.Z)(e,[{key:"toJSON",value:function(){return{kind:this.kind}}},{key:"_initialize",value:function(e){var t=this;this._onlineComponentProvider=Rl.provider,this._offlineComponentProvider={build:function(n){return new Dl(n,null==e?void 0:e.cacheSizeBytes,t.forceOwnership)}}}}]),e}(),Ld=function(){function e(){(0,y.Z)(this,e),this.kind="PersistentMultipleTab"}return(0,m.Z)(e,[{key:"toJSON",value:function(){return{kind:this.kind}}},{key:"_initialize",value:function(e){this._onlineComponentProvider=Rl.provider,this._offlineComponentProvider={build:function(t){return new Nl(t,null==e?void 0:e.cacheSizeBytes)}}}}]),e}();function Vd(e){return new Fd(null==e?void 0:e.forceOwnership)}function qd(){return new Ld}var Ud={maxAttempts:5},Bd=function(){function e(t,n){(0,y.Z)(this,e),this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=rf(t)}return(0,m.Z)(e,[{key:"set",value:function(e,t,n){this._verifyNotCommitted();var r=zd(e,this._firestore),i=$f(r.converter,t,n),a=af(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(a.toMutation(r._key,Xr.none())),this}},{key:"update",value:function(e,t,n){this._verifyNotCommitted();for(var r,i=zd(e,this._firestore),a=arguments.length,u=new Array(a>3?a-3:0),o=3;o<a;o++)u[o-3]=arguments[o];return r="string"==typeof(t=(0,b.m9)(t))||t instanceof Kh?df(this._dataReader,"WriteBatch.update",i._key,t,n,u):ff(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(r.toMutation(i._key,Xr.exists(!0))),this}},{key:"delete",value:function(e){this._verifyNotCommitted();var t=zd(e,this._firestore);return this._mutations=this._mutations.concat(new di(t._key,Xr.none())),this}},{key:"commit",value:function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}},{key:"_verifyNotCommitted",value:function(){if(this._committed)throw new W(H.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}]),e}();function zd(e,t){if((e=(0,b.m9)(e)).firestore!==t)throw new W(H.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}var jd=function(e){(0,d.Z)(n,e);var t=(0,v.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this,e,r))._firestore=e,i}return(0,m.Z)(n,[{key:"get",value:function(e){var t=this,r=zd(e,this._firestore),i=new dd(this._firestore);return(0,u.Z)((0,o.Z)(n.prototype),"get",this).call(this,e).then((function(e){return new od(t._firestore,i,r._key,e._document,new ud(!1,!1),r.converter)}))}}]),n}(function(){function e(t,n){(0,y.Z)(this,e),this._firestore=t,this._transaction=n,this._dataReader=rf(t)}return(0,m.Z)(e,[{key:"get",value:function(e){var t=this,n=zd(e,this._firestore),r=new ed(this._firestore);return this._transaction.lookup([n._key]).then((function(e){if(!e||1!==e.length)return j();var i=e[0];if(i.isFoundDocument())return new _f(t._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new _f(t._firestore,r,n._key,null,n.converter);throw j()}))}},{key:"set",value:function(e,t,n){var r=zd(e,this._firestore),i=$f(r.converter,t,n),a=af(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,a),this}},{key:"update",value:function(e,t,n){for(var r,i=zd(e,this._firestore),a=arguments.length,u=new Array(a>3?a-3:0),o=3;o<a;o++)u[o-3]=arguments[o];return r="string"==typeof(t=(0,b.m9)(t))||t instanceof Kh?df(this._dataReader,"Transaction.update",i._key,t,n,u):ff(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,r),this}},{key:"delete",value:function(e){var t=zd(e,this._firestore);return this._transaction.delete(t._key),this}}]),e}());function Gd(e,t,n){e=lh(e,Eh);var r=Object.assign(Object.assign({},Ud),n);return function(e){if(e.maxAttempts<1)throw new W(H.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){var r=new J;return e.asyncQueue.enqueueAndForget((0,f.Z)((0,h.Z)().mark((function i(){var a;return(0,h.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Xl(e);case 2:a=i.sent,new Ll(e.asyncQueue,a,n,t,r).au();case 4:case"end":return i.stop()}}),i)})))),r.promise}(Ah(e),(function(n){return t(new jd(e,n))}),r)}function Kd(){return new uf("deleteField")}function Qd(){return new sf("serverTimestamp")}function Hd(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new cf("arrayUnion",t)}function Wd(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new lf("arrayRemove",t)}function Jd(e){return new hf("increment",e)}function Yd(e){return new Jh(e)}function Xd(e){return Ah(e=lh(e,Eh)),new Bd(e,(function(t){return Td(e,t)}))}function $d(e,t){var n=Ah(e=lh(e,Eh));if(!n._uninitializedComponentsProvider||"memory"===n._uninitializedComponentsProvider._offline.kind)return B("Cannot enable indexes when persistence is disabled"),Promise.resolve();var r=function(e){var t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new W(H.INVALID_ARGUMENT,"Failed to parse JSON: "+(null==e?void 0:e.message))}}(e):e,n=[];if(Array.isArray(t.indexes)){var r,i=(0,l.Z)(t.indexes);try{for(i.s();!(r=i.n()).done;){var a=r.value,u=ev(a,"collectionGroup"),o=[];if(Array.isArray(a.fields)){var s,c=(0,l.Z)(a.fields);try{for(c.s();!(s=c.n()).done;){var h=s.value,f=bf("setIndexConfiguration",ev(h,"fieldPath"));"CONTAINS"===h.arrayConfig?o.push(new xe(f,2)):"ASCENDING"===h.order?o.push(new xe(f,0)):"DESCENDING"===h.order&&o.push(new xe(f,1))}}catch(d){c.e(d)}finally{c.f()}}n.push(new ge(ge.UNKNOWN_ID,u,o,_e.empty()))}}catch(d){i.e(d)}finally{i.f()}}return n}(t);return function(e,t){return e.asyncQueue.enqueue((0,f.Z)((0,h.Z)().mark((function n(){return(0,h.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t,n){var r,i,a;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),i=r.indexManager,a=[],e.abrupt("return",r.persistence.runTransaction("Configure indexes","readwrite",(function(e){return i.getFieldIndexes(e).next((function(t){return function(e,t,n,r,i){e=(0,p.Z)(e),t=(0,p.Z)(t),e.sort(n),t.sort(n);for(var a=e.length,u=t.length,o=0,s=0;o<u&&s<a;){var c=n(e[s],t[o]);c<0?i(e[s++]):c>0?r(t[o++]):(o++,s++)}for(;o<u;)r(t[o++]);for(;s<a;)i(e[s++])}(t,n,be,(function(t){a.push(i.addFieldIndex(e,t))}),(function(t){a.push(i.deleteFieldIndex(e,t))}))})).next((function(){return Re.waitFor(a)}))})));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n.next=3,Wl(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)}))))}(n,r)}function ev(e,t){if("string"!=typeof e[t])throw new W(H.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}var tv=(0,m.Z)((function e(t){(0,y.Z)(this,e),this._firestore=t,this.type="PersistentCacheIndexManager"}));function nv(e){var t;e=lh(e,Eh);var n=ov.get(e);if(n)return n;if("persistent"!==(null===(t=Ah(e)._uninitializedComponentsProvider)||void 0===t?void 0:t._offline.kind))return null;var r=new tv(e);return ov.set(e,r),r}function rv(e){uv(e,!0)}function iv(e){uv(e,!1)}function av(e){(function(e){return e.asyncQueue.enqueue((0,f.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e){var t=Q(e),n=t.indexManager;return t.persistence.runTransaction("Delete All Indexes","readwrite",(function(e){return n.deleteAllFieldIndexes(e)}))},t.next=3,Wl(e);case 3:return t.t1=t.sent,t.abrupt("return",(0,t.t0)(t.t1));case 5:case"end":return t.stop()}}),t)}))))})(Ah(e._firestore)).then((function(e){return q("deleting all persistent cache indexes succeeded")})).catch((function(e){return B("deleting all persistent cache indexes failed",e)}))}function uv(e,t){(function(e,t){return e.asyncQueue.enqueue((0,f.Z)((0,h.Z)().mark((function n(){return(0,h.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=function(e,t){Q(e).ss.zi=t},n.next=3,Wl(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)}))))})(Ah(e._firestore),t).then((function(e){return q("setting persistent cache index auto creation isEnabled=".concat(t," succeeded"))})).catch((function(e){return B("setting persistent cache index auto creation isEnabled=".concat(t," failed"),e)}))}var ov=new WeakMap;function sv(e){var t,n=null===(t=Ah(lh(e.firestore,Eh))._onlineComponents)||void 0===t?void 0:t.datastore.serializer;return void 0===n?null:sa(n,cr(e._query))._t}function cv(e,t){var n,r=Ct(t,(function(e,t){return new gi(t,e.aggregateType,e._internalFieldPath)})),i=null===(n=Ah(lh(e.firestore,Eh))._onlineComponents)||void 0===n?void 0:n.datastore.serializer;return void 0===i?null:ca(i,lr(e._query),r,!0).request}var lv=function(){function e(){throw(0,y.Z)(this,e),new Error("instances of this class should not be created")}return(0,m.Z)(e,null,[{key:"onExistenceFilterMismatch",value:function(e){return hv.instance.onExistenceFilterMismatch(e)}}]),e}(),hv=function(){function e(){(0,y.Z)(this,e),this.Uu=new Map}return(0,m.Z)(e,[{key:"et",value:function(e){this.Uu.forEach((function(t){return t(e)}))}},{key:"onExistenceFilterMismatch",value:function(e){var t=Symbol(),n=this.Uu;return n.set(t,e),function(){return n.delete(t)}}}],[{key:"instance",get:function(){return fv||function(e){if(xi)throw new Error("a TestingHooksSpi instance is already set");xi=e}(fv=new e),fv}}]),e}(),fv=null;!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){P=e}(g.Jn),(0,g.Xd)(new k.wA("firestore",(function(e,n){var r=n.instanceIdentifier,i=n.options,a=e.getProvider("app").getImmediate(),u=new Eh(new ee(e.getProvider("auth-internal")),new ie(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new W(H.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Wt(e.options.projectId,t)}(a,r),a);return i=Object.assign({useFetchStreams:t},i),u._setSettings(i),u}),"PUBLIC").setMultipleInstances(!0)),(0,g.KN)(M,"4.7.4",e),(0,g.KN)(M,"4.7.4","esm2017")}()}}]);
//# sourceMappingURL=631.02e97a9f.chunk.js.map